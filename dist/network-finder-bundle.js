"use strict";(()=>{var Hs=Object.defineProperty;var uo=(n,e,t)=>e in n?Hs(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ee=(n,e)=>()=>(n&&(e=n(n=0)),e);var ho=(n,e)=>{for(var t in e)Hs(n,t,{get:e[t],enumerable:!0})};var P=(n,e,t)=>uo(n,typeof e!="symbol"?e+"":e,t);var Re,Ys=ee(()=>{Re=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});function fe(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Nt(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function H(n,...e){if(!fe(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function kt(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Gs(n,e){H(n);let t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Ye(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function rt(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function Se(n){if(H(n),Ks)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=lo[n[t]];return e}function Vs(n){if(n>=de._0&&n<=de._9)return n-de._0;if(n>=de.A&&n<=de.F)return n-(de.A-10);if(n>=de.a&&n<=de.f)return n-(de.a-10)}function it(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(Ks)return Uint8Array.fromHex(n);let e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let s=new Uint8Array(t);for(let o=0,r=0;o<t;o++,r+=2){let a=Vs(n.charCodeAt(r)),d=Vs(n.charCodeAt(r+1));if(a===void 0||d===void 0){let c=n[r]+n[r+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+r)}s[o]=a*16+d}return s}function ue(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}function qt(n){return typeof n=="string"&&(n=ue(n)),H(n),n}function j(...n){let e=0;for(let s=0;s<n.length;s++){let o=n[s];H(o),e+=o.length}let t=new Uint8Array(e);for(let s=0,o=0;s<n.length;s++){let r=n[s];t.set(r,o),o+=r.length}return t}function Zs(n){let e=s=>n().update(qt(s)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Ve(n=32){if(Re&&typeof Re.getRandomValues=="function")return Re.getRandomValues(new Uint8Array(n));if(Re&&typeof Re.randomBytes=="function")return Uint8Array.from(Re.randomBytes(n));throw new Error("crypto.getRandomValues must be defined")}var Ks,lo,de,ot,_e=ee(()=>{Ys();Ks=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",lo=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));de={_0:48,_9:57,A:65,F:70,a:97,f:102};ot=class{}});function po(n,e,t,s){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,s);let o=BigInt(32),r=BigInt(4294967295),a=Number(t>>o&r),d=Number(t&r),c=s?4:0,h=s?0:4;n.setUint32(e+c,a,s),n.setUint32(e+h,d,s)}var at,Z,$s=ee(()=>{_e();at=class extends ot{constructor(e,t,s,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=o,this.buffer=new Uint8Array(e),this.view=rt(this.buffer)}update(e){kt(this),e=qt(e),H(e);let{view:t,buffer:s,blockLen:o}=this,r=e.length;for(let a=0;a<r;){let d=Math.min(o-this.pos,r-a);if(d===o){let c=rt(e);for(;o<=r-a;a+=o)this.process(c,a);continue}s.set(e.subarray(a,a+d),this.pos),this.pos+=d,a+=d,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){kt(this),Gs(e,this),this.finished=!0;let{buffer:t,view:s,blockLen:o,isLE:r}=this,{pos:a}=this;t[a++]=128,Ye(this.buffer.subarray(a)),this.padOffset>o-a&&(this.process(s,0),a=0);for(let l=a;l<o;l++)t[l]=0;po(s,o-8,BigInt(this.length*8),r),this.process(s,0);let d=rt(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let h=c/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<h;l++)d.setUint32(4*l,u[l],r)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:s,length:o,finished:r,destroyed:a,pos:d}=this;return e.destroyed=a,e.finished=r,e.length=o,e.pos=d,o%t&&e.buffer.set(s),e}clone(){return this._cloneInto()}},Z=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209])});function mo(n,e=!1){return e?{h:Number(n&ct),l:Number(n>>zs&ct)}:{h:Number(n>>zs&ct)|0,l:Number(n&ct)|0}}function Xs(n,e=!1){let t=n.length,s=new Uint32Array(t),o=new Uint32Array(t);for(let r=0;r<t;r++){let{h:a,l:d}=mo(n[r],e);[s[r],o[r]]=[a,d]}return[s,o]}function ae(n,e,t,s){let o=(e>>>0)+(s>>>0);return{h:n+t+(o/2**32|0)|0,l:o|0}}var ct,zs,Ht,Ft,Te,Pe,Ge,Ke,Ws,Qs,js,Js,en,tn,sn=ee(()=>{ct=BigInt(4294967295),zs=BigInt(32);Ht=(n,e,t)=>n>>>t,Ft=(n,e,t)=>n<<32-t|e>>>t,Te=(n,e,t)=>n>>>t|e<<32-t,Pe=(n,e,t)=>n<<32-t|e>>>t,Ge=(n,e,t)=>n<<64-t|e>>>t-32,Ke=(n,e,t)=>n>>>t-32|e<<64-t;Ws=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),Qs=(n,e,t,s)=>e+t+s+(n/2**32|0)|0,js=(n,e,t,s)=>(n>>>0)+(e>>>0)+(t>>>0)+(s>>>0),Js=(n,e,t,s,o)=>e+t+s+o+(n/2**32|0)|0,en=(n,e,t,s,o)=>(n>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(o>>>0),tn=(n,e,t,s,o,r)=>e+t+s+o+r+(n/2**32|0)|0});var nn,go,wo,Ce,Ee,Yt,Oe,on=ee(()=>{$s();sn();_e();nn=Xs(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),go=nn[0],wo=nn[1],Ce=new Uint32Array(80),Ee=new Uint32Array(80),Yt=class extends at{constructor(e=64){super(128,e,16,!1),this.Ah=Z[0]|0,this.Al=Z[1]|0,this.Bh=Z[2]|0,this.Bl=Z[3]|0,this.Ch=Z[4]|0,this.Cl=Z[5]|0,this.Dh=Z[6]|0,this.Dl=Z[7]|0,this.Eh=Z[8]|0,this.El=Z[9]|0,this.Fh=Z[10]|0,this.Fl=Z[11]|0,this.Gh=Z[12]|0,this.Gl=Z[13]|0,this.Hh=Z[14]|0,this.Hl=Z[15]|0}get(){let{Ah:e,Al:t,Bh:s,Bl:o,Ch:r,Cl:a,Dh:d,Dl:c,Eh:h,El:u,Fh:l,Fl:f,Gh:p,Gl:y,Hh:x,Hl:C}=this;return[e,t,s,o,r,a,d,c,h,u,l,f,p,y,x,C]}set(e,t,s,o,r,a,d,c,h,u,l,f,p,y,x,C){this.Ah=e|0,this.Al=t|0,this.Bh=s|0,this.Bl=o|0,this.Ch=r|0,this.Cl=a|0,this.Dh=d|0,this.Dl=c|0,this.Eh=h|0,this.El=u|0,this.Fh=l|0,this.Fl=f|0,this.Gh=p|0,this.Gl=y|0,this.Hh=x|0,this.Hl=C|0}process(e,t){for(let g=0;g<16;g++,t+=4)Ce[g]=e.getUint32(t),Ee[g]=e.getUint32(t+=4);for(let g=16;g<80;g++){let A=Ce[g-15]|0,I=Ee[g-15]|0,O=Te(A,I,1)^Te(A,I,8)^Ht(A,I,7),U=Pe(A,I,1)^Pe(A,I,8)^Ft(A,I,7),_=Ce[g-2]|0,E=Ee[g-2]|0,B=Te(_,E,19)^Ge(_,E,61)^Ht(_,E,6),L=Pe(_,E,19)^Ke(_,E,61)^Ft(_,E,6),M=js(U,L,Ee[g-7],Ee[g-16]),R=Js(M,O,B,Ce[g-7],Ce[g-16]);Ce[g]=R|0,Ee[g]=M|0}let{Ah:s,Al:o,Bh:r,Bl:a,Ch:d,Cl:c,Dh:h,Dl:u,Eh:l,El:f,Fh:p,Fl:y,Gh:x,Gl:C,Hh:m,Hl:b}=this;for(let g=0;g<80;g++){let A=Te(l,f,14)^Te(l,f,18)^Ge(l,f,41),I=Pe(l,f,14)^Pe(l,f,18)^Ke(l,f,41),O=l&p^~l&x,U=f&y^~f&C,_=en(b,I,U,wo[g],Ee[g]),E=tn(_,m,A,O,go[g],Ce[g]),B=_|0,L=Te(s,o,28)^Ge(s,o,34)^Ge(s,o,39),M=Pe(s,o,28)^Ke(s,o,34)^Ke(s,o,39),R=s&r^s&d^r&d,T=o&a^o&c^a&c;m=x|0,b=C|0,x=p|0,C=y|0,p=l|0,y=f|0,{h:l,l:f}=ae(h|0,u|0,E|0,B|0),h=d|0,u=c|0,d=r|0,c=a|0,r=s|0,a=o|0;let D=Ws(B,M,T);s=Qs(D,E,L,R),o=D|0}({h:s,l:o}=ae(this.Ah|0,this.Al|0,s|0,o|0)),{h:r,l:a}=ae(this.Bh|0,this.Bl|0,r|0,a|0),{h:d,l:c}=ae(this.Ch|0,this.Cl|0,d|0,c|0),{h,l:u}=ae(this.Dh|0,this.Dl|0,h|0,u|0),{h:l,l:f}=ae(this.Eh|0,this.El|0,l|0,f|0),{h:p,l:y}=ae(this.Fh|0,this.Fl|0,p|0,y|0),{h:x,l:C}=ae(this.Gh|0,this.Gl|0,x|0,C|0),{h:m,l:b}=ae(this.Hh|0,this.Hl|0,m|0,b|0),this.set(s,o,r,a,d,c,h,u,l,f,p,y,x,C,m,b)}roundClean(){Ye(Ce,Ee)}destroy(){Ye(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Oe=Zs(()=>new Yt)});function dt(n,e=""){if(typeof n!="boolean"){let t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof n)}return n}function Ze(n,e,t=""){let s=fe(n),o=n?.length,r=e!==void 0;if(!s||r&&o!==e){let a=t&&`"${t}" `,d=r?` of length ${e}`:"",c=s?`length=${o}`:`type=${typeof n}`;throw new Error(a+"expected Uint8Array"+d+", got "+c)}return n}function rn(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?Kt:BigInt("0x"+n)}function ft(n){return rn(Se(n))}function te(n){return H(n),rn(Se(Uint8Array.from(n).reverse()))}function Zt(n,e){return it(n.toString(16).padStart(e*2,"0"))}function ut(n,e){return Zt(n,e).reverse()}function F(n,e,t){let s;if(typeof e=="string")try{s=it(e)}catch(r){throw new Error(n+" must be hex string or Uint8Array, cause: "+r)}else if(fe(e))s=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");let o=s.length;if(typeof t=="number"&&o!==t)throw new Error(n+" of length "+t+" expected, got "+o);return s}function an(n,e){if(n.length!==e.length)return!1;let t=0;for(let s=0;s<n.length;s++)t|=n[s]^e[s];return t===0}function $t(n){return Uint8Array.from(n)}function Co(n,e,t){return Vt(n)&&Vt(e)&&Vt(t)&&e<=n&&n<t}function Me(n,e,t,s){if(!Co(e,t,s))throw new Error("expected valid "+n+": "+t+" <= n < "+s+", got "+e)}function cn(n){let e;for(e=0;n>Kt;n>>=Gt,e+=1);return e}function dn(n){return typeof n=="function"&&Number.isSafeInteger(n.outputLen)}function he(n,e,t={}){if(!n||typeof n!="object")throw new Error("expected valid options object");function s(o,r,a){let d=n[o];if(a&&d===void 0)return;let c=typeof d;if(c!==r||d===null)throw new Error(`param "${o}" is invalid: expected ${r}, got ${c}`)}Object.entries(e).forEach(([o,r])=>s(o,r,!1)),Object.entries(t).forEach(([o,r])=>s(o,r,!0))}function Xt(n){let e=new WeakMap;return(t,...s)=>{let o=e.get(t);if(o!==void 0)return o;let r=n(t,...s);return e.set(t,r),r}}var Kt,Gt,Vt,$e,zt,ve=ee(()=>{_e();_e();Kt=BigInt(0),Gt=BigInt(1);Vt=n=>typeof n=="bigint"&&Kt<=n;$e=n=>(Gt<<BigInt(n))-Gt;zt=()=>{throw new Error("not implemented")}});function N(n,e){let t=n%e;return t>=W?t:e+t}function se(n,e,t){let s=n;for(;e-- >W;)s*=s,s%=t;return s}function fn(n,e){if(n===W)throw new Error("invert: expected non-zero number");if(e<=W)throw new Error("invert: expected positive modulus, got "+e);let t=N(n,e),s=e,o=W,r=X,a=X,d=W;for(;t!==W;){let h=s/t,u=s%t,l=o-a*h,f=r-d*h;s=t,t=u,o=a,r=d,a=l,d=f}if(s!==X)throw new Error("invert: does not exist");return N(o,e)}function Wt(n,e,t){if(!n.eql(n.sqr(e),t))throw new Error("Cannot find square root")}function gn(n,e){let t=(n.ORDER+X)/ln,s=n.pow(e,t);return Wt(n,s,e),s}function bo(n,e){let t=(n.ORDER-pn)/mn,s=n.mul(e,Ae),o=n.pow(s,t),r=n.mul(e,o),a=n.mul(n.mul(r,Ae),o),d=n.mul(r,n.sub(a,n.ONE));return Wt(n,d,e),d}function Bo(n){let e=pe(n),t=wn(n),s=t(e,e.neg(e.ONE)),o=t(e,s),r=t(e,e.neg(s)),a=(n+Eo)/yn;return(d,c)=>{let h=d.pow(c,a),u=d.mul(h,s),l=d.mul(h,o),f=d.mul(h,r),p=d.eql(d.sqr(u),c),y=d.eql(d.sqr(l),c);h=d.cmov(h,u,p),u=d.cmov(f,l,y);let x=d.eql(d.sqr(u),c),C=d.cmov(h,u,x);return Wt(d,C,c),C}}function wn(n){if(n<hn)throw new Error("sqrt is not defined for small field");let e=n-X,t=0;for(;e%Ae===W;)e/=Ae,t++;let s=Ae,o=pe(n);for(;un(o,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return gn;let r=o.pow(s,e),a=(e+X)/Ae;return function(c,h){if(c.is0(h))return h;if(un(c,h)!==1)throw new Error("Cannot find square root");let u=t,l=c.mul(c.ONE,r),f=c.pow(h,e),p=c.pow(h,a);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let y=1,x=c.sqr(f);for(;!c.eql(x,c.ONE);)if(y++,x=c.sqr(x),y===u)throw new Error("Cannot find square root");let C=X<<BigInt(u-y-1),m=c.pow(l,C);u=y,l=c.sqr(m),f=c.mul(f,l),p=c.mul(p,m)}return p}}function Ro(n){return n%ln===hn?gn:n%mn===pn?bo:n%yn===xo?Bo(n):wn(n)}function Cn(n){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=So.reduce((s,o)=>(s[o]="function",s),e);return he(n,t),n}function To(n,e,t){if(t<W)throw new Error("invalid exponent, negatives unsupported");if(t===W)return n.ONE;if(t===X)return e;let s=n.ONE,o=e;for(;t>W;)t&X&&(s=n.mul(s,o)),o=n.sqr(o),t>>=X;return s}function De(n,e,t=!1){let s=new Array(e.length).fill(t?n.ZERO:void 0),o=e.reduce((a,d,c)=>n.is0(d)?a:(s[c]=a,n.mul(a,d)),n.ONE),r=n.inv(o);return e.reduceRight((a,d,c)=>n.is0(d)?a:(s[c]=n.mul(a,s[c]),n.mul(a,d)),r),s}function un(n,e){let t=(n.ORDER-X)/Ae,s=n.pow(e,t),o=n.eql(s,n.ONE),r=n.eql(s,n.ZERO),a=n.eql(s,n.neg(n.ONE));if(!o&&!r&&!a)throw new Error("invalid Legendre symbol result");return o?1:r?0:-1}function En(n,e){e!==void 0&&Nt(e);let t=e!==void 0?e:n.toString(2).length,s=Math.ceil(t/8);return{nBitLength:t,nByteLength:s}}function pe(n,e,t=!1,s={}){if(n<=W)throw new Error("invalid field: expected ORDER > 0, got "+n);let o,r,a=!1,d;if(typeof e=="object"&&e!=null){if(s.sqrt||t)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(o=f.BITS),f.sqrt&&(r=f.sqrt),typeof f.isLE=="boolean"&&(t=f.isLE),typeof f.modFromBytes=="boolean"&&(a=f.modFromBytes),d=f.allowedLengths}else typeof e=="number"&&(o=e),s.sqrt&&(r=s.sqrt);let{nBitLength:c,nByteLength:h}=En(n,o);if(h>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u,l=Object.freeze({ORDER:n,isLE:t,BITS:c,BYTES:h,MASK:$e(c),ZERO:W,ONE:X,allowedLengths:d,create:f=>N(f,n),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return W<=f&&f<n},is0:f=>f===W,isValidNot0:f=>!l.is0(f)&&l.isValid(f),isOdd:f=>(f&X)===X,neg:f=>N(-f,n),eql:(f,p)=>f===p,sqr:f=>N(f*f,n),add:(f,p)=>N(f+p,n),sub:(f,p)=>N(f-p,n),mul:(f,p)=>N(f*p,n),pow:(f,p)=>To(l,f,p),div:(f,p)=>N(f*fn(p,n),n),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>fn(f,n),sqrt:r||(f=>(u||(u=Ro(n)),u(l,f))),toBytes:f=>t?ut(f,h):Zt(f,h),fromBytes:(f,p=!0)=>{if(d){if(!d.includes(f.length)||f.length>h)throw new Error("Field.fromBytes: expected "+d+" bytes, got "+f.length);let x=new Uint8Array(h);x.set(f,t?0:x.length-f.length),f=x}if(f.length!==h)throw new Error("Field.fromBytes: expected "+h+" bytes, got "+f.length);let y=t?te(f):ft(f);if(a&&(y=N(y,n)),!p&&!l.isValid(y))throw new Error("invalid field element: outside of range 0..ORDER");return y},invertBatch:f=>De(l,f),cmov:(f,p,y)=>y?p:f});return Object.freeze(l)}function xn(n,e){if(!n.isOdd)throw new Error("Field doesn't have isOdd");let t=n.sqrt(e);return n.isOdd(t)?n.neg(t):t}var W,X,Ae,hn,ln,pn,Eo,mn,xo,yn,le,So,Ue=ee(()=>{ve();W=BigInt(0),X=BigInt(1),Ae=BigInt(2),hn=BigInt(3),ln=BigInt(4),pn=BigInt(5),Eo=BigInt(7),mn=BigInt(8),xo=BigInt(9),yn=BigInt(16);le=(n,e)=>(N(n,e)&X)===X,So=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"]});function bn(n,e){let t=e.negate();return n?t:e}function ze(n,e){let t=De(n.Fp,e.map(s=>s.Z));return e.map((s,o)=>n.fromAffine(s.toAffine(t[o])))}function Tn(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function Qt(n,e){Tn(n,e);let t=Math.ceil(e/n)+1,s=2**(n-1),o=2**n,r=$e(n),a=BigInt(n);return{windows:t,windowSize:s,mask:r,maxNumber:o,shiftBy:a}}function Bn(n,e,t){let{windowSize:s,mask:o,maxNumber:r,shiftBy:a}=t,d=Number(n&o),c=n>>a;d>s&&(d-=r,c+=es);let h=e*s,u=h+Math.abs(d)-1,l=d===0,f=d<0,p=e%2!==0;return{nextN:c,offset:u,isZero:l,isNeg:f,isNegF:p,offsetF:h}}function Po(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,s)=>{if(!(t instanceof e))throw new Error("invalid point at index "+s)})}function vo(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,s)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+s)})}function Jt(n){return Pn.get(n)||1}function Rn(n){if(n!==ht)throw new Error("invalid wNAF")}function pt(n,e,t,s){Po(t,n),vo(s,e);let o=t.length,r=s.length;if(o!==r)throw new Error("arrays of points and scalars must have equal length");let a=n.ZERO,d=cn(BigInt(o)),c=1;d>12?c=d-3:d>4?c=d-2:d>0&&(c=2);let h=$e(c),u=new Array(Number(h)+1).fill(a),l=Math.floor((e.BITS-1)/c)*c,f=a;for(let p=l;p>=0;p-=c){u.fill(a);for(let x=0;x<r;x++){let C=s[x],m=Number(C>>BigInt(p)&h);u[m]=u[m].add(t[x])}let y=a;for(let x=u.length-1,C=a;x>0;x--)C=C.add(u[x]),y=y.add(C);if(f=f.add(y),p!==0)for(let x=0;x<c;x++)f=f.double()}return f}function Sn(n,e,t){if(e){if(e.ORDER!==n)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Cn(e),e}else return pe(n,{isLE:t})}function vn(n,e,t={},s){if(s===void 0&&(s=n==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${n} CURVE object`);for(let c of["p","n","h"]){let h=e[c];if(!(typeof h=="bigint"&&h>ht))throw new Error(`CURVE.${c} must be positive bigint`)}let o=Sn(e.p,t.Fp,s),r=Sn(e.n,t.Fn,s),d=["Gx","Gy","a",n==="weierstrass"?"b":"d"];for(let c of d)if(!o.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:r}}var ht,es,jt,Pn,lt,ts=ee(()=>{ve();Ue();ht=BigInt(0),es=BigInt(1);jt=new WeakMap,Pn=new WeakMap;lt=class{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,s=this.ZERO){let o=e;for(;t>ht;)t&es&&(s=s.add(o)),o=o.double(),t>>=es;return s}precomputeWindow(e,t){let{windows:s,windowSize:o}=Qt(t,this.bits),r=[],a=e,d=a;for(let c=0;c<s;c++){d=a,r.push(d);for(let h=1;h<o;h++)d=d.add(a),r.push(d);a=d.double()}return r}wNAF(e,t,s){if(!this.Fn.isValid(s))throw new Error("invalid scalar");let o=this.ZERO,r=this.BASE,a=Qt(e,this.bits);for(let d=0;d<a.windows;d++){let{nextN:c,offset:h,isZero:u,isNeg:l,isNegF:f,offsetF:p}=Bn(s,d,a);s=c,u?r=r.add(bn(f,t[p])):o=o.add(bn(l,t[h]))}return Rn(s),{p:o,f:r}}wNAFUnsafe(e,t,s,o=this.ZERO){let r=Qt(e,this.bits);for(let a=0;a<r.windows&&s!==ht;a++){let{nextN:d,offset:c,isZero:h,isNeg:u}=Bn(s,a,r);if(s=d,!h){let l=t[c];o=o.add(u?l.negate():l)}}return Rn(s),o}getPrecomputes(e,t,s){let o=jt.get(t);return o||(o=this.precomputeWindow(t,e),e!==1&&(typeof s=="function"&&(o=s(o)),jt.set(t,o))),o}cached(e,t,s){let o=Jt(e);return this.wNAF(o,this.getPrecomputes(o,e,s),t)}unsafe(e,t,s,o){let r=Jt(e);return r===1?this._unsafeLadder(e,t,o):this.wNAFUnsafe(r,this.getPrecomputes(r,e,s),t,o)}createCache(e,t){Tn(t,this.bits),Pn.set(e,t),jt.delete(e)}hasCache(e){return Jt(e)!==1}}});function Lo(n,e,t,s){let o=n.sqr(t),r=n.sqr(s),a=n.add(n.mul(e.a,o),r),d=n.add(n.ONE,n.mul(e.d,n.mul(o,r)));return n.eql(a,d)}function Io(n,e={}){let t=vn("edwards",n,e,e.FpFnLE),{Fp:s,Fn:o}=t,r=t.CURVE,{h:a}=r;he(e,{},{uvRatio:"function"});let d=ss<<BigInt(o.BYTES*8)-Y,c=C=>s.create(C),h=e.uvRatio||((C,m)=>{try{return{isValid:!0,value:s.sqrt(s.div(C,m))}}catch{return{isValid:!1,value:xe}}});if(!Lo(s,r,r.Gx,r.Gy))throw new Error("bad curve params: generator point");function u(C,m,b=!1){let g=b?Y:xe;return Me("coordinate "+C,m,g,d),m}function l(C){if(!(C instanceof y))throw new Error("ExtendedPoint expected")}let f=Xt((C,m)=>{let{X:b,Y:g,Z:A}=C,I=C.is0();m==null&&(m=I?Ao:s.inv(A));let O=c(b*m),U=c(g*m),_=s.mul(A,m);if(I)return{x:xe,y:Y};if(_!==Y)throw new Error("invZ was invalid");return{x:O,y:U}}),p=Xt(C=>{let{a:m,d:b}=r;if(C.is0())throw new Error("bad point: ZERO");let{X:g,Y:A,Z:I,T:O}=C,U=c(g*g),_=c(A*A),E=c(I*I),B=c(E*E),L=c(U*m),M=c(E*c(L+_)),R=c(B+c(b*c(U*_)));if(M!==R)throw new Error("bad point: equation left != right (1)");let T=c(g*A),D=c(I*O);if(T!==D)throw new Error("bad point: equation left != right (2)");return!0});class y{constructor(m,b,g,A){this.X=u("x",m),this.Y=u("y",b),this.Z=u("z",g,!0),this.T=u("t",A),Object.freeze(this)}static CURVE(){return r}static fromAffine(m){if(m instanceof y)throw new Error("extended point not allowed");let{x:b,y:g}=m||{};return u("x",b),u("y",g),new y(b,g,Y,c(b*g))}static fromBytes(m,b=!1){let g=s.BYTES,{a:A,d:I}=r;m=$t(Ze(m,g,"point")),dt(b,"zip215");let O=$t(m),U=m[g-1];O[g-1]=U&-129;let _=te(O),E=b?d:s.ORDER;Me("point.y",_,xe,E);let B=c(_*_),L=c(B-Y),M=c(I*B-A),{isValid:R,value:T}=h(L,M);if(!R)throw new Error("bad point: invalid y coordinate");let D=(T&Y)===Y,q=(U&128)!==0;if(!b&&T===xe&&q)throw new Error("bad point: x=0 and x_0=1");return q!==D&&(T=c(-T)),y.fromAffine({x:T,y:_})}static fromHex(m,b=!1){return y.fromBytes(F("point",m),b)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,b=!0){return x.createCache(this,m),b||this.multiply(ss),this}assertValidity(){p(this)}equals(m){l(m);let{X:b,Y:g,Z:A}=this,{X:I,Y:O,Z:U}=m,_=c(b*U),E=c(I*A),B=c(g*U),L=c(O*A);return _===E&&B===L}is0(){return this.equals(y.ZERO)}negate(){return new y(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:m}=r,{X:b,Y:g,Z:A}=this,I=c(b*b),O=c(g*g),U=c(ss*c(A*A)),_=c(m*I),E=b+g,B=c(c(E*E)-I-O),L=_+O,M=L-U,R=_-O,T=c(B*M),D=c(L*R),q=c(B*R),G=c(M*L);return new y(T,D,G,q)}add(m){l(m);let{a:b,d:g}=r,{X:A,Y:I,Z:O,T:U}=this,{X:_,Y:E,Z:B,T:L}=m,M=c(A*_),R=c(I*E),T=c(U*g*L),D=c(O*B),q=c((A+I)*(_+E)-M-R),G=D-T,z=D+T,K=c(R-b*M),J=c(q*G),ne=c(z*K),Fe=c(q*K),Ie=c(G*z);return new y(J,ne,Ie,Fe)}subtract(m){return this.add(m.negate())}multiply(m){if(!o.isValidNot0(m))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:b,f:g}=x.cached(this,m,A=>ze(y,A));return ze(y,[b,g])[0]}multiplyUnsafe(m,b=y.ZERO){if(!o.isValid(m))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return m===xe?y.ZERO:this.is0()||m===Y?this:x.unsafe(this,m,g=>ze(y,g),b)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return x.unsafe(this,r.n).is0()}toAffine(m){return f(this,m)}clearCofactor(){return a===Y?this:this.multiplyUnsafe(a)}toBytes(){let{x:m,y:b}=this.toAffine(),g=s.toBytes(b);return g[g.length-1]|=m&Y?128:0,g}toHex(){return Se(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(m){return ze(y,m)}static msm(m,b){return pt(y,o,m,b)}_setWindowSize(m){this.precompute(m)}toRawBytes(){return this.toBytes()}}y.BASE=new y(r.Gx,r.Gy,Y,c(r.Gx*r.Gy)),y.ZERO=new y(xe,Y,Y,xe),y.Fp=s,y.Fn=o;let x=new lt(y,o.BITS);return y.BASE.precompute(8),y}function _o(n,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');he(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:s}=t,{BASE:o,Fp:r,Fn:a}=n,d=t.randomBytes||Ve,c=t.adjustScalarBytes||(E=>E),h=t.domain||((E,B,L)=>{if(dt(L,"phflag"),B.length||L)throw new Error("Contexts/pre-hash are not supported");return E});function u(E){return a.create(te(E))}function l(E){let B=g.secretKey;E=F("private key",E,B);let L=F("hashed private key",e(E),2*B),M=c(L.slice(0,B)),R=L.slice(B,2*B),T=u(M);return{head:M,prefix:R,scalar:T}}function f(E){let{head:B,prefix:L,scalar:M}=l(E),R=o.multiply(M),T=R.toBytes();return{head:B,prefix:L,scalar:M,point:R,pointBytes:T}}function p(E){return f(E).pointBytes}function y(E=Uint8Array.of(),...B){let L=j(...B);return u(e(h(L,F("context",E),!!s)))}function x(E,B,L={}){E=F("message",E),s&&(E=s(E));let{prefix:M,scalar:R,pointBytes:T}=f(B),D=y(L.context,M,E),q=o.multiply(D).toBytes(),G=y(L.context,q,T,E),z=a.create(D+G*R);if(!a.isValid(z))throw new Error("sign failed: invalid s");let K=j(q,a.toBytes(z));return Ze(K,g.signature,"result")}let C={zip215:!0};function m(E,B,L,M=C){let{context:R,zip215:T}=M,D=g.signature;E=F("signature",E,D),B=F("message",B),L=F("publicKey",L,g.publicKey),T!==void 0&&dt(T,"zip215"),s&&(B=s(B));let q=D/2,G=E.subarray(0,q),z=te(E.subarray(q,D)),K,J,ne;try{K=n.fromBytes(L,T),J=n.fromBytes(G,T),ne=o.multiplyUnsafe(z)}catch{return!1}if(!T&&K.isSmallOrder())return!1;let Fe=y(R,J.toBytes(),K.toBytes(),B);return J.add(K.multiplyUnsafe(Fe)).subtract(ne).clearCofactor().is0()}let b=r.BYTES,g={secretKey:b,publicKey:b,signature:2*b,seed:b};function A(E=d(g.seed)){return Ze(E,g.seed,"seed")}function I(E){let B=_.randomSecretKey(E);return{secretKey:B,publicKey:p(B)}}function O(E){return fe(E)&&E.length===a.BYTES}function U(E,B){try{return!!n.fromBytes(E,B)}catch{return!1}}let _={getExtendedPublicKey:f,randomSecretKey:A,isValidSecretKey:O,isValidPublicKey:U,toMontgomery(E){let{y:B}=n.fromBytes(E),L=g.publicKey,M=L===32;if(!M&&L!==57)throw new Error("only defined for 25519 and 448");let R=M?r.div(Y+B,Y-B):r.div(B-Y,B+Y);return r.toBytes(R)},toMontgomerySecret(E){let B=g.secretKey;Ze(E,B);let L=e(E.subarray(0,B));return c(L).subarray(0,B)},randomPrivateKey:A,precompute(E=8,B=n.BASE){return B.precompute(E,!1)}};return Object.freeze({keygen:I,getPublicKey:p,sign:x,verify:m,utils:_,Point:n,lengths:g})}function Oo(n){let e={a:n.a,d:n.d,p:n.Fp.ORDER,n:n.n,h:n.h,Gx:n.Gx,Gy:n.Gy},t=n.Fp,s=pe(e.n,n.nBitLength,!0),o={Fp:t,Fn:s,uvRatio:n.uvRatio},r={randomBytes:n.randomBytes,adjustScalarBytes:n.adjustScalarBytes,domain:n.domain,prehash:n.prehash,mapToCurve:n.mapToCurve};return{CURVE:e,curveOpts:o,hash:n.hash,eddsaOpts:r}}function Mo(n,e){let t=e.Point;return Object.assign({},e,{ExtendedPoint:t,CURVE:n,nBitLength:t.Fn.BITS,nByteLength:t.Fn.BYTES})}function yt(n){let{CURVE:e,curveOpts:t,hash:s,eddsaOpts:o}=Oo(n),r=Io(e,t),a=_o(r,s,o);return Mo(n,a)}var xe,Y,ss,Ao,mt,An=ee(()=>{ve();ts();Ue();xe=BigInt(0),Y=BigInt(1),ss=BigInt(2),Ao=BigInt(8);mt=class{constructor(e){this.ep=e}static fromBytes(e){zt()}static fromHex(e){zt()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(e){return this.ep.toAffine(e)}toHex(){return Se(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(e){return this.assertSame(e),this.init(this.ep.add(e.ep))}subtract(e){return this.assertSame(e),this.init(this.ep.subtract(e.ep))}multiply(e){return this.init(this.ep.multiply(e))}multiplyUnsafe(e){return this.init(this.ep.multiplyUnsafe(e))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(e,t){return this.init(this.ep.precompute(e,t))}toRawBytes(){return this.toBytes()}}});function be(n,e){if(Xe(n),Xe(e),n<0||n>=1<<8*e)throw new Error("invalid I2OSP input: "+n);let t=Array.from({length:e}).fill(0);for(let s=e-1;s>=0;s--)t[s]=n&255,n>>>=8;return new Uint8Array(t)}function Uo(n,e){let t=new Uint8Array(n.length);for(let s=0;s<n.length;s++)t[s]=n[s]^e[s];return t}function Xe(n){if(!Number.isSafeInteger(n))throw new Error("number expected")}function Ln(n){if(!fe(n)&&typeof n!="string")throw new Error("DST must be Uint8Array or string");return typeof n=="string"?ue(n):n}function gt(n,e,t,s){H(n),Xe(t),e=Ln(e),e.length>255&&(e=s(j(ue("H2C-OVERSIZE-DST-"),e)));let{outputLen:o,blockLen:r}=s,a=Math.ceil(t/o);if(t>65535||a>255)throw new Error("expand_message_xmd: invalid lenInBytes");let d=j(e,be(e.length,1)),c=be(0,r),h=be(t,2),u=new Array(a),l=s(j(c,n,h,be(0,1),d));u[0]=s(j(l,be(1,1),d));for(let p=1;p<=a;p++){let y=[Uo(l,u[p-1]),be(p+1,1),d];u[p]=s(j(...y))}return j(...u).slice(0,t)}function No(n,e,t,s,o){if(H(n),Xe(t),e=Ln(e),e.length>255){let r=Math.ceil(2*s/8);e=o.create({dkLen:r}).update(ue("H2C-OVERSIZE-DST-")).update(e).digest()}if(t>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return o.create({dkLen:t}).update(n).update(be(t,2)).update(e).update(be(e.length,1)).digest()}function ns(n,e,t){he(t,{p:"bigint",m:"number",k:"number",hash:"function"});let{p:s,k:o,m:r,hash:a,expand:d,DST:c}=t;if(!dn(t.hash))throw new Error("expected valid hash");H(n),Xe(e);let h=s.toString(2).length,u=Math.ceil((h+o)/8),l=e*r*u,f;if(d==="xmd")f=gt(n,c,l,a);else if(d==="xof")f=No(n,c,l,o,a);else if(d==="_internal_pass")f=n;else throw new Error('expand must be "xmd" or "xof"');let p=new Array(e);for(let y=0;y<e;y++){let x=new Array(r);for(let C=0;C<r;C++){let m=u*(C+y*r),b=f.subarray(m,m+u);x[C]=N(Do(b),s)}p[y]=x}return p}function In(n,e,t){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function s(r){return n.fromAffine(e(r))}function o(r){let a=r.clearCofactor();return a.equals(n.ZERO)?n.ZERO:(a.assertValidity(),a)}return{defaults:t,hashToCurve(r,a){let d=Object.assign({},t,a),c=ns(r,2,d),h=s(c[0]),u=s(c[1]);return o(h.add(u))},encodeToCurve(r,a){let d=t.encodeDST?{DST:t.encodeDST}:{},c=Object.assign({},t,d,a),h=ns(r,1,c),u=s(h[0]);return o(u)},mapToCurve(r){if(!Array.isArray(r))throw new Error("expected array of bigints");for(let a of r)if(typeof a!="bigint")throw new Error("expected array of bigints");return o(s(r))},hashToScalar(r,a){let d=n.Fn.ORDER,c=Object.assign({},t,{p:d,m:1,DST:os},a);return ns(r,1,c)[0][0]}}}var Do,os,_n=ee(()=>{ve();Ue();Do=ft;os=ue("HashToScalar-")});function ko(n){return he(n,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...n})}function On(n){let e=ko(n),{P:t,type:s,adjustScalarBytes:o,powPminus2:r,randomBytes:a}=e,d=s==="x25519";if(!d&&s!=="x448")throw new Error("invalid type");let c=a||Ve,h=d?255:448,u=d?32:56,l=BigInt(d?9:5),f=BigInt(d?121665:39081),p=d?wt**BigInt(254):wt**BigInt(447),y=d?BigInt(8)*wt**BigInt(251)-Ne:BigInt(4)*wt**BigInt(445)-Ne,x=p+y+Ne,C=R=>N(R,t),m=b(l);function b(R){return ut(C(R),u)}function g(R){let T=F("u coordinate",R,u);return d&&(T[31]&=127),C(te(T))}function A(R){return te(o(F("scalar",R,u)))}function I(R,T){let D=_(g(T),A(R));if(D===We)throw new Error("invalid private or public key received");return b(D)}function O(R){return I(R,m)}function U(R,T,D){let q=C(R*(T-D));return T=C(T-q),D=C(D+q),{x_2:T,x_3:D}}function _(R,T){Me("u",R,We,t),Me("scalar",T,p,x);let D=T,q=R,G=Ne,z=We,K=R,J=Ne,ne=We;for(let Ie=BigInt(h-1);Ie>=We;Ie--){let At=D>>Ie&Ne;ne^=At,{x_2:G,x_3:K}=U(ne,G,K),{x_2:z,x_3:J}=U(ne,z,J),ne=At;let Lt=G+z,It=C(Lt*Lt),_t=G-z,Ms=C(_t*_t),Ds=It-Ms,co=K+J,fo=K-J,Us=C(fo*Lt),Ns=C(co*_t),ks=Us+Ns,qs=Us-Ns;K=C(ks*ks),J=C(q*C(qs*qs)),G=C(It*Ms),z=C(Ds*(It+C(f*Ds)))}({x_2:G,x_3:K}=U(ne,G,K)),{x_2:z,x_3:J}=U(ne,z,J);let Fe=r(z);return C(G*Fe)}let E={secretKey:u,publicKey:u,seed:u},B=(R=c(u))=>(H(R,E.seed),R);function L(R){let T=B(R);return{secretKey:T,publicKey:O(T)}}return{keygen:L,getSharedSecret:(R,T)=>I(R,T),getPublicKey:R=>O(R),scalarMult:I,scalarMultBase:O,utils:{randomSecretKey:B,randomPrivateKey:B},GuBytes:m.slice(),lengths:E}}var We,Ne,wt,Mn=ee(()=>{ve();Ue();We=BigInt(0),Ne=BigInt(1),wt=BigInt(2)});var Zn={};ho(Zn,{ED25519_TORSION_SUBGROUP:()=>er,RistrettoPoint:()=>nr,ed25519:()=>oe,ed25519_hasher:()=>us,ed25519ctx:()=>Ho,ed25519ph:()=>Fo,edwardsToMontgomery:()=>tr,edwardsToMontgomeryPriv:()=>sr,edwardsToMontgomeryPub:()=>Kn,encodeToCurve:()=>rr,hashToCurve:()=>or,hashToRistretto255:()=>ir,hash_to_ristretto255:()=>ar,ristretto255:()=>Jo,ristretto255_hasher:()=>hs,x25519:()=>Yo});function Hn(n){let e=BigInt(10),t=BigInt(20),s=BigInt(40),o=BigInt(80),r=me,d=n*n%r*n%r,c=se(d,Ct,r)*d%r,h=se(c,ce,r)*n%r,u=se(h,qn,r)*h%r,l=se(u,e,r)*u%r,f=se(l,t,r)*l%r,p=se(f,s,r)*f%r,y=se(p,o,r)*p%r,x=se(y,o,r)*p%r,C=se(x,e,r)*u%r;return{pow_p_5_8:se(C,Ct,r)*n%r,b2:d}}function Fn(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function ds(n,e){let t=me,s=N(e*e*e,t),o=N(s*s*e,t),r=Hn(n*o).pow_p_5_8,a=N(n*s*r,t),d=N(e*a*a,t),c=a,h=N(a*rs,t),u=d===n,l=d===N(-n,t),f=d===N(-n*rs,t);return u&&(a=c),(l||f)&&(a=h),le(a,t)&&(a=N(-a,t)),{isValid:u||l,value:a}}function Vn(n,e,t){if(e.length>255)throw new Error("Context is too big");return j(ue("SigEd25519 no Ed25519 collisions"),new Uint8Array([t?1:0,e.length]),e,n)}function Ko(n){let e=(me-qn)/cs,t=BigInt(486662),s=w.sqr(n);s=w.mul(s,Ct);let o=w.add(s,w.ONE),r=w.neg(t),a=w.sqr(o),d=w.mul(a,o),c=w.mul(s,t);c=w.mul(c,r),c=w.add(c,a),c=w.mul(c,r);let h=w.sqr(d);a=w.sqr(h),h=w.mul(h,d),h=w.mul(h,c),a=w.mul(a,h);let u=w.pow(a,e);u=w.mul(u,h);let l=w.mul(u,Dn);a=w.sqr(u),a=w.mul(a,d);let f=w.eql(a,c),p=w.cmov(l,u,f),y=w.mul(r,s),x=w.mul(u,n);x=w.mul(x,Go);let C=w.mul(x,Dn),m=w.mul(c,s);a=w.sqr(x),a=w.mul(a,d);let b=w.eql(a,m),g=w.cmov(C,x,b);a=w.sqr(p),a=w.mul(a,d);let A=w.eql(a,c),I=w.cmov(y,r,A),O=w.cmov(g,p,A),U=w.isOdd(O);return O=w.cmov(O,w.neg(O),A!==U),{xMn:I,xMd:o,yMn:O,yMd:ce}}function $o(n){let{xMn:e,xMd:t,yMn:s,yMd:o}=Ko(n),r=w.mul(e,o);r=w.mul(r,Zo);let a=w.mul(t,s),d=w.sub(e,t),c=w.add(e,t),h=w.mul(a,c),u=w.eql(h,w.ZERO);r=w.cmov(r,w.ZERO,u),a=w.cmov(a,w.ONE,u),d=w.cmov(d,w.ONE,u),c=w.cmov(c,w.ONE,u);let[l,f]=De(w,[a,c],!0);return{x:w.mul(r,l),y:w.mul(d,f)}}function Nn(n){let{d:e}=Qe,t=me,s=m=>w.create(m),o=s(is*n*n),r=s((o+ce)*Wo),a=BigInt(-1),d=s((a-e*o)*s(o+e)),{isValid:c,value:h}=ds(r,d),u=s(h*n);le(u,t)||(u=s(-u)),c||(h=u),c||(a=o);let l=s(a*(o-ce)*Qo-d),f=h*h,p=s((h+h)*d),y=s(l*zo),x=s(ce-f),C=s(ce+f);return new oe.Point(s(p*C),s(x*y),s(y*C),s(p*x))}function Gn(n){H(n,64);let e=as(n.subarray(0,32)),t=Nn(e),s=as(n.subarray(32,64)),o=Nn(s);return new re(t.add(o))}function Kn(n){return oe.utils.toMontgomery(F("pub",n))}function sr(n){return oe.utils.toMontgomerySecret(F("pub",n))}var qo,ce,Ct,kn,qn,cs,me,Qe,rs,w,Yn,fs,oe,Ho,Fo,Yo,Vo,Go,Dn,Zo,us,is,zo,Xo,Wo,Qo,Un,jo,as,re,Jo,hs,er,tr,nr,or,rr,ir,ar,$n=ee(()=>{on();_e();ts();An();_n();Ue();Mn();ve();qo=BigInt(0),ce=BigInt(1),Ct=BigInt(2),kn=BigInt(3),qn=BigInt(5),cs=BigInt(8),me=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Qe={p:me,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:cs,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};rs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");w=pe(Qe.p,{isLE:!0}),Yn=pe(Qe.n,{isLE:!0}),fs={...Qe,Fp:w,hash:Oe,adjustScalarBytes:Fn,uvRatio:ds},oe=yt(fs);Ho=yt({...fs,domain:Vn}),Fo=yt(Object.assign({},fs,{domain:Vn,prehash:Oe})),Yo=(()=>{let n=w.ORDER;return On({P:n,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:s}=Hn(e);return N(se(t,kn,n)*s,n)},adjustScalarBytes:Fn})})(),Vo=(me+kn)/cs,Go=w.pow(Ct,Vo),Dn=w.sqrt(w.neg(w.ONE));Zo=xn(w,w.neg(BigInt(486664)));us=In(oe.Point,n=>$o(n[0]),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:me,m:1,k:128,expand:"xmd",hash:Oe}),is=rs,zo=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Xo=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Wo=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Qo=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Un=n=>ds(ce,n),jo=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),as=n=>oe.Point.Fp.create(te(n)&jo);re=class n extends mt{constructor(e){super(e)}static fromAffine(e){return new n(oe.Point.fromAffine(e))}assertSame(e){if(!(e instanceof n))throw new Error("RistrettoPoint expected")}init(e){return new n(e)}static hashToCurve(e){return Gn(F("ristrettoHash",e,64))}static fromBytes(e){H(e,32);let{a:t,d:s}=Qe,o=me,r=A=>w.create(A),a=as(e);if(!an(w.toBytes(a),e)||le(a,o))throw new Error("invalid ristretto255 encoding 1");let d=r(a*a),c=r(ce+t*d),h=r(ce-t*d),u=r(c*c),l=r(h*h),f=r(t*s*u-l),{isValid:p,value:y}=Un(r(f*l)),x=r(y*h),C=r(y*x*f),m=r((a+a)*x);le(m,o)&&(m=r(-m));let b=r(c*C),g=r(m*b);if(!p||le(g,o)||b===qo)throw new Error("invalid ristretto255 encoding 2");return new n(new oe.Point(m,b,ce,g))}static fromHex(e){return n.fromBytes(F("ristrettoHex",e,32))}static msm(e,t){return pt(n,oe.Point.Fn,e,t)}toBytes(){let{X:e,Y:t,Z:s,T:o}=this.ep,r=me,a=C=>w.create(C),d=a(a(s+t)*a(s-t)),c=a(e*t),h=a(c*c),{value:u}=Un(a(d*h)),l=a(u*d),f=a(u*c),p=a(l*f*o),y;if(le(o*p,r)){let C=a(t*is),m=a(e*is);e=C,t=m,y=a(l*Xo)}else y=f;le(e*p,r)&&(t=a(-t));let x=a((s-t)*y);return le(x,r)&&(x=a(-x)),w.toBytes(x)}equals(e){this.assertSame(e);let{X:t,Y:s}=this.ep,{X:o,Y:r}=e.ep,a=h=>w.create(h),d=a(t*r)===a(s*o),c=a(s*r)===a(t*o);return d||c}is0(){return this.equals(n.ZERO)}};re.BASE=new re(oe.Point.BASE);re.ZERO=new re(oe.Point.ZERO);re.Fp=w;re.Fn=Yn;Jo={Point:re},hs={hashToCurve(n,e){let t=e?.DST||"ristretto255_XMD:SHA-512_R255MAP_RO_",s=gt(n,t,64,Oe);return Gn(s)},hashToScalar(n,e={DST:os}){let t=gt(n,e.DST,64,Oe);return Yn.create(te(t))}},er=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];tr=Kn;nr=re,or=us.hashToCurve,rr=us.encodeToCurve,ir=hs.hashToCurve,ar=hs.hashToCurve});var Ot=class{constructor(){this.buffer=[]}toBytes(){return new Uint8Array(this.buffer)}writeBytes(e){this.buffer=[...this.buffer,...e]}writeByte(e){this.writeBytes([e])}writeUInt16LE(e){let t=new Uint8Array(2);new DataView(t.buffer).setUint16(0,e,!0),this.writeBytes(t)}writeUInt32LE(e){let t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,e,!0),this.writeBytes(t)}writeInt32LE(e){let t=new Uint8Array(4);new DataView(t.buffer).setInt32(0,e,!0),this.writeBytes(t)}writeString(e){this.writeBytes(new TextEncoder().encode(e))}writeCString(e,t){let s=new Uint8Array(new ArrayBuffer(t)),o=new TextEncoder().encode(e);for(var r=0;r<t&&r<o.length;r++)s[r]=o[r];s[s.length-1]=0,this.writeBytes(s)}},v=Ot;var Mt=class{constructor(e){this.pointer=0,this.buffer=new Uint8Array(e)}getRemainingBytesCount(){return this.buffer.length-this.pointer}readByte(){return this.readBytes(1)[0]}readBytes(e){let t=this.buffer.slice(this.pointer,this.pointer+e);return this.pointer+=e,t}readRemainingBytes(){return this.readBytes(this.getRemainingBytesCount())}readString(){return new TextDecoder().decode(this.readRemainingBytes())}readCString(e){let t=[],s=this.readBytes(e);for(let o of s){if(o===0)return new TextDecoder().decode(new Uint8Array(t));t.push(o)}}readInt8(){let e=this.readBytes(1);return new DataView(e.buffer).getInt8(0)}readUInt8(){let e=this.readBytes(1);return new DataView(e.buffer).getUint8(0)}readUInt16LE(){let e=this.readBytes(2);return new DataView(e.buffer).getUint16(0,!0)}readUInt16BE(){let e=this.readBytes(2);return new DataView(e.buffer).getUint16(0,!1)}readUInt32LE(){let e=this.readBytes(4);return new DataView(e.buffer).getUint32(0,!0)}readUInt32BE(){let e=this.readBytes(4);return new DataView(e.buffer).getUint32(0,!1)}readInt16LE(){let e=this.readBytes(2);return new DataView(e.buffer).getInt16(0,!0)}readInt16BE(){let e=this.readBytes(2);return new DataView(e.buffer).getInt16(0,!1)}readInt32LE(){let e=this.readBytes(4);return new DataView(e.buffer).getInt32(0,!0)}readInt24BE(){var e=this.readByte()<<16|this.readByte()<<8|this.readByte();return e&8388608&&(e-=16777216),e}},k=Mt;var Q=class{};P(Q,"SupportedCompanionProtocolVersion",1),P(Q,"SerialFrameTypes",{Incoming:62,Outgoing:60}),P(Q,"Ble",{ServiceUuid:"6E400001-B5A3-F393-E0A9-E50E24DCCA9E",CharacteristicUuidRx:"6E400002-B5A3-F393-E0A9-E50E24DCCA9E",CharacteristicUuidTx:"6E400003-B5A3-F393-E0A9-E50E24DCCA9E"}),P(Q,"CommandCodes",{AppStart:1,SendTxtMsg:2,SendChannelTxtMsg:3,GetContacts:4,GetDeviceTime:5,SetDeviceTime:6,SendSelfAdvert:7,SetAdvertName:8,AddUpdateContact:9,SyncNextMessage:10,SetRadioParams:11,SetTxPower:12,ResetPath:13,SetAdvertLatLon:14,RemoveContact:15,ShareContact:16,ExportContact:17,ImportContact:18,Reboot:19,GetBatteryVoltage:20,SetTuningParams:21,DeviceQuery:22,ExportPrivateKey:23,ImportPrivateKey:24,SendRawData:25,SendLogin:26,SendStatusReq:27,GetChannel:31,SetChannel:32,SignStart:33,SignData:34,SignFinish:35,SendTracePath:36,SetOtherParams:38,SendTelemetryReq:39,SendBinaryReq:50}),P(Q,"ResponseCodes",{Ok:0,Err:1,ContactsStart:2,Contact:3,EndOfContacts:4,SelfInfo:5,Sent:6,ContactMsgRecv:7,ChannelMsgRecv:8,CurrTime:9,NoMoreMessages:10,ExportContact:11,BatteryVoltage:12,DeviceInfo:13,PrivateKey:14,Disabled:15,ChannelInfo:18,SignStart:19,Signature:20}),P(Q,"PushCodes",{Advert:128,PathUpdated:129,SendConfirmed:130,MsgWaiting:131,RawData:132,LoginSuccess:133,LoginFail:134,StatusResponse:135,LogRxData:136,TraceData:137,NewAdvert:138,TelemetryResponse:139,BinaryResponse:140}),P(Q,"ErrorCodes",{UnsupportedCmd:1,NotFound:2,TableFull:3,BadState:4,FileIoError:5,IllegalArg:6}),P(Q,"AdvType",{None:0,Chat:1,Repeater:2,Room:3}),P(Q,"SelfAdvertTypes",{ZeroHop:0,Flood:1}),P(Q,"TxtTypes",{Plain:0,CliData:1,SignedPlain:2}),P(Q,"BinaryRequestTypes",{GetTelemetryData:3,GetAvgMinMax:4,GetAccessList:5,GetNeighbours:6});var i=Q;var Dt=class{constructor(){this.eventListenersMap=new Map}on(e,t){this.eventListenersMap.has(e)||this.eventListenersMap.set(e,[]),this.eventListenersMap.get(e).push(t)}off(e,t){if(this.eventListenersMap.has(e)){let s=this.eventListenersMap.get(e).filter(o=>o!==t);this.eventListenersMap.set(e,s)}}once(e,t){let s=(...o)=>{this.off(e,s),setTimeout(()=>t(...o),0)};this.on(e,s)}emit(e,...t){if(this.eventListenersMap.has(e))for(let s of this.eventListenersMap.get(e))setTimeout(()=>s(...t),0)}},Fs=Dt;var Ut=class{static bytesToHex(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}static hexToBytes(e){return Uint8Array.from(e.match(/.{1,2}/g).map(t=>parseInt(t,16)))}static base64ToBytes(e){return Uint8Array.from(atob(e),t=>t.charCodeAt(0))}static areBuffersEqual(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}},we=Ut;var $=class ${constructor(e,t,s,o){this.publicKey=e,this.timestamp=t,this.signature=s,this.appData=o,this.parsed=this.parseAppData()}static fromBytes(e){let t=new k(e),s=t.readBytes(32),o=t.readUInt32LE(),r=t.readBytes(64),a=t.readRemainingBytes();return new $(s,o,r,a)}getFlags(){return this.appData[0]}getType(){return this.getFlags()&15}getTypeString(){let e=this.getType();return e===$.ADV_TYPE_NONE?"NONE":e===$.ADV_TYPE_CHAT?"CHAT":e===$.ADV_TYPE_REPEATER?"REPEATER":e===$.ADV_TYPE_ROOM?"ROOM":null}async isVerified(){let{ed25519:e}=await Promise.resolve().then(()=>($n(),Zn)),t=new v;return t.writeBytes(this.publicKey),t.writeUInt32LE(this.timestamp),t.writeBytes(this.appData),e.verify(this.signature,t.toBytes(),this.publicKey)}parseAppData(){let e=new k(this.appData),t=e.readByte();var s=null,o=null;t&$.ADV_LATLON_MASK&&(s=e.readInt32LE(),o=e.readInt32LE());var r=null;return t&$.ADV_NAME_MASK&&(r=e.readString()),{type:this.getTypeString(),lat:s,lon:o,name:r}}};P($,"ADV_TYPE_NONE",0),P($,"ADV_TYPE_CHAT",1),P($,"ADV_TYPE_REPEATER",2),P($,"ADV_TYPE_ROOM",3),P($,"ADV_LATLON_MASK",16),P($,"ADV_BATTERY_MASK",32),P($,"ADV_TEMPERATURE_MASK",64),P($,"ADV_NAME_MASK",128);var ls=$,ps=ls;var S=class S{constructor(e,t,s){this.header=e,this.path=t,this.payload=s,this.route_type=this.getRouteType(),this.route_type_string=this.getRouteTypeString(),this.payload_type=this.getPayloadType(),this.payload_type_string=this.getPayloadTypeString(),this.payload_version=this.getPayloadVer(),this.is_marked_do_not_retransmit=this.isMarkedDoNotRetransmit()}static fromBytes(e){let t=new k(e),s=t.readByte(),o=t.readInt8(),r=t.readBytes(o),a=t.readRemainingBytes();return new S(s,r,a)}getRouteType(){return this.header&S.PH_ROUTE_MASK}getRouteTypeString(){switch(this.getRouteType()){case S.ROUTE_TYPE_FLOOD:return"FLOOD";case S.ROUTE_TYPE_DIRECT:return"DIRECT";default:return null}}isRouteFlood(){return this.getRouteType()===S.ROUTE_TYPE_FLOOD}isRouteDirect(){return this.getRouteType()===S.ROUTE_TYPE_DIRECT}getPayloadType(){return this.header>>S.PH_TYPE_SHIFT&S.PH_TYPE_MASK}getPayloadTypeString(){switch(this.getPayloadType()){case S.PAYLOAD_TYPE_REQ:return"REQ";case S.PAYLOAD_TYPE_RESPONSE:return"RESPONSE";case S.PAYLOAD_TYPE_TXT_MSG:return"TXT_MSG";case S.PAYLOAD_TYPE_ACK:return"ACK";case S.PAYLOAD_TYPE_ADVERT:return"ADVERT";case S.PAYLOAD_TYPE_GRP_TXT:return"GRP_TXT";case S.PAYLOAD_TYPE_GRP_DATA:return"GRP_DATA";case S.PAYLOAD_TYPE_ANON_REQ:return"ANON_REQ";case S.PAYLOAD_TYPE_PATH:return"PATH";case S.PAYLOAD_TYPE_TRACE:return"TRACE";case S.PAYLOAD_TYPE_RAW_CUSTOM:return"RAW_CUSTOM";default:return null}}getPayloadVer(){return this.header>>S.PH_VER_SHIFT&S.PH_VER_MASK}markDoNotRetransmit(){this.header=255}isMarkedDoNotRetransmit(){return this.header===255}parsePayload(){switch(this.getPayloadType()){case S.PAYLOAD_TYPE_PATH:return this.parsePayloadTypePath();case S.PAYLOAD_TYPE_REQ:return this.parsePayloadTypeReq();case S.PAYLOAD_TYPE_RESPONSE:return this.parsePayloadTypeResponse();case S.PAYLOAD_TYPE_TXT_MSG:return this.parsePayloadTypeTxtMsg();case S.PAYLOAD_TYPE_ACK:return this.parsePayloadTypeAck();case S.PAYLOAD_TYPE_ADVERT:return this.parsePayloadTypeAdvert();case S.PAYLOAD_TYPE_ANON_REQ:return this.parsePayloadTypeAnonReq();default:return null}}parsePayloadTypePath(){let e=new k(this.payload),t=e.readByte();return{src:e.readByte(),dest:t}}parsePayloadTypeReq(){let e=new k(this.payload),t=e.readByte(),s=e.readByte(),o=e.readRemainingBytes();return{src:s,dest:t,encrypted:o}}parsePayloadTypeResponse(){let e=new k(this.payload),t=e.readByte();return{src:e.readByte(),dest:t}}parsePayloadTypeTxtMsg(){let e=new k(this.payload),t=e.readByte();return{src:e.readByte(),dest:t}}parsePayloadTypeAck(){return{ack_code:this.payload}}parsePayloadTypeAdvert(){let e=ps.fromBytes(this.payload);return{public_key:e.publicKey,timestamp:e.timestamp,app_data:e.parseAppData()}}parsePayloadTypeAnonReq(){let e=new k(this.payload),t=e.readByte();return{src:e.readBytes(32),dest:t}}};P(S,"PH_ROUTE_MASK",3),P(S,"PH_TYPE_SHIFT",2),P(S,"PH_TYPE_MASK",15),P(S,"PH_VER_SHIFT",6),P(S,"PH_VER_MASK",3),P(S,"ROUTE_TYPE_RESERVED1",0),P(S,"ROUTE_TYPE_FLOOD",1),P(S,"ROUTE_TYPE_DIRECT",2),P(S,"ROUTE_TYPE_RESERVED2",3),P(S,"PAYLOAD_TYPE_REQ",0),P(S,"PAYLOAD_TYPE_RESPONSE",1),P(S,"PAYLOAD_TYPE_TXT_MSG",2),P(S,"PAYLOAD_TYPE_ACK",3),P(S,"PAYLOAD_TYPE_ADVERT",4),P(S,"PAYLOAD_TYPE_GRP_TXT",5),P(S,"PAYLOAD_TYPE_GRP_DATA",6),P(S,"PAYLOAD_TYPE_ANON_REQ",7),P(S,"PAYLOAD_TYPE_PATH",8),P(S,"PAYLOAD_TYPE_TRACE",9),P(S,"PAYLOAD_TYPE_RAW_CUSTOM",15);var ms=S,Et=ms;var ys=class{static getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}},gs=ys;var ws=class extends Fs{async onConnected(){try{await this.deviceQuery(i.SupportedCompanionProtocolVersion)}catch{}this.emit("connected")}onDisconnected(){this.emit("disconnected")}async close(){throw new Error("This method must be implemented by the subclass.")}async sendToRadioFrame(e){throw new Error("This method must be implemented by the subclass.")}async sendCommandAppStart(){let e=new v;e.writeByte(i.CommandCodes.AppStart),e.writeByte(1),e.writeBytes(new Uint8Array(6)),e.writeString("test"),await this.sendToRadioFrame(e.toBytes())}async sendCommandSendTxtMsg(e,t,s,o,r){let a=new v;a.writeByte(i.CommandCodes.SendTxtMsg),a.writeByte(e),a.writeByte(t),a.writeUInt32LE(s),a.writeBytes(o.slice(0,6)),a.writeString(r),await this.sendToRadioFrame(a.toBytes())}async sendCommandSendChannelTxtMsg(e,t,s,o){let r=new v;r.writeByte(i.CommandCodes.SendChannelTxtMsg),r.writeByte(e),r.writeByte(t),r.writeUInt32LE(s),r.writeString(o),await this.sendToRadioFrame(r.toBytes())}async sendCommandGetContacts(e){let t=new v;t.writeByte(i.CommandCodes.GetContacts),e&&t.writeUInt32LE(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandGetDeviceTime(){let e=new v;e.writeByte(i.CommandCodes.GetDeviceTime),await this.sendToRadioFrame(e.toBytes())}async sendCommandSetDeviceTime(e){let t=new v;t.writeByte(i.CommandCodes.SetDeviceTime),t.writeUInt32LE(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendSelfAdvert(e){let t=new v;t.writeByte(i.CommandCodes.SendSelfAdvert),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSetAdvertName(e){let t=new v;t.writeByte(i.CommandCodes.SetAdvertName),t.writeString(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandAddUpdateContact(e,t,s,o,r,a,d,c,h){let u=new v;u.writeByte(i.CommandCodes.AddUpdateContact),u.writeBytes(e),u.writeByte(t),u.writeByte(s),u.writeByte(o),u.writeBytes(r),u.writeCString(a,32),u.writeUInt32LE(d),u.writeUInt32LE(c),u.writeUInt32LE(h),await this.sendToRadioFrame(u.toBytes())}async sendCommandSyncNextMessage(){let e=new v;e.writeByte(i.CommandCodes.SyncNextMessage),await this.sendToRadioFrame(e.toBytes())}async sendCommandSetRadioParams(e,t,s,o){let r=new v;r.writeByte(i.CommandCodes.SetRadioParams),r.writeUInt32LE(e),r.writeUInt32LE(t),r.writeByte(s),r.writeByte(o),await this.sendToRadioFrame(r.toBytes())}async sendCommandSetTxPower(e){let t=new v;t.writeByte(i.CommandCodes.SetTxPower),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandResetPath(e){let t=new v;t.writeByte(i.CommandCodes.ResetPath),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSetAdvertLatLon(e,t){let s=new v;s.writeByte(i.CommandCodes.SetAdvertLatLon),s.writeInt32LE(e),s.writeInt32LE(t),await this.sendToRadioFrame(s.toBytes())}async sendCommandRemoveContact(e){let t=new v;t.writeByte(i.CommandCodes.RemoveContact),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandShareContact(e){let t=new v;t.writeByte(i.CommandCodes.ShareContact),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandExportContact(e=null){let t=new v;t.writeByte(i.CommandCodes.ExportContact),e&&t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandImportContact(e){let t=new v;t.writeByte(i.CommandCodes.ImportContact),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandReboot(){let e=new v;e.writeByte(i.CommandCodes.Reboot),e.writeString("reboot"),await this.sendToRadioFrame(e.toBytes())}async sendCommandGetBatteryVoltage(){let e=new v;e.writeByte(i.CommandCodes.GetBatteryVoltage),await this.sendToRadioFrame(e.toBytes())}async sendCommandDeviceQuery(e){let t=new v;t.writeByte(i.CommandCodes.DeviceQuery),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandExportPrivateKey(){let e=new v;e.writeByte(i.CommandCodes.ExportPrivateKey),await this.sendToRadioFrame(e.toBytes())}async sendCommandImportPrivateKey(e){let t=new v;t.writeByte(i.CommandCodes.ImportPrivateKey),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendRawData(e,t){let s=new v;s.writeByte(i.CommandCodes.SendRawData),s.writeByte(e.length),s.writeBytes(e),s.writeBytes(t),await this.sendToRadioFrame(s.toBytes())}async sendCommandSendLogin(e,t){let s=new v;s.writeByte(i.CommandCodes.SendLogin),s.writeBytes(e),s.writeString(t),await this.sendToRadioFrame(s.toBytes())}async sendCommandSendStatusReq(e){let t=new v;t.writeByte(i.CommandCodes.SendStatusReq),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendTelemetryReq(e){let t=new v;t.writeByte(i.CommandCodes.SendTelemetryReq),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendBinaryReq(e,t){let s=new v;s.writeByte(i.CommandCodes.SendBinaryReq),s.writeBytes(e),s.writeBytes(t),await this.sendToRadioFrame(s.toBytes())}async sendCommandGetChannel(e){let t=new v;t.writeByte(i.CommandCodes.GetChannel),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSetChannel(e,t,s){let o=new v;o.writeByte(i.CommandCodes.SetChannel),o.writeByte(e),o.writeCString(t,32),o.writeBytes(s),await this.sendToRadioFrame(o.toBytes())}async sendCommandSignStart(){let e=new v;e.writeByte(i.CommandCodes.SignStart),await this.sendToRadioFrame(e.toBytes())}async sendCommandSignData(e){let t=new v;t.writeByte(i.CommandCodes.SignData),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSignFinish(){let e=new v;e.writeByte(i.CommandCodes.SignFinish),await this.sendToRadioFrame(e.toBytes())}async sendCommandSendTracePath(e,t,s){let o=new v;o.writeByte(i.CommandCodes.SendTracePath),o.writeUInt32LE(e),o.writeUInt32LE(t),o.writeByte(0),o.writeBytes(s),await this.sendToRadioFrame(o.toBytes())}async sendCommandSetOtherParams(e){let t=new v;t.writeByte(i.CommandCodes.SetOtherParams),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}onFrameReceived(e){this.emit("rx",e);let t=new k(e),s=t.readByte();s===i.ResponseCodes.Ok?this.onOkResponse(t):s===i.ResponseCodes.Err?this.onErrResponse(t):s===i.ResponseCodes.SelfInfo?this.onSelfInfoResponse(t):s===i.ResponseCodes.CurrTime?this.onCurrTimeResponse(t):s===i.ResponseCodes.NoMoreMessages?this.onNoMoreMessagesResponse(t):s===i.ResponseCodes.ContactMsgRecv?this.onContactMsgRecvResponse(t):s===i.ResponseCodes.ChannelMsgRecv?this.onChannelMsgRecvResponse(t):s===i.ResponseCodes.ContactsStart?this.onContactsStartResponse(t):s===i.ResponseCodes.Contact?this.onContactResponse(t):s===i.ResponseCodes.EndOfContacts?this.onEndOfContactsResponse(t):s===i.ResponseCodes.Sent?this.onSentResponse(t):s===i.ResponseCodes.ExportContact?this.onExportContactResponse(t):s===i.ResponseCodes.BatteryVoltage?this.onBatteryVoltageResponse(t):s===i.ResponseCodes.DeviceInfo?this.onDeviceInfoResponse(t):s===i.ResponseCodes.PrivateKey?this.onPrivateKeyResponse(t):s===i.ResponseCodes.Disabled?this.onDisabledResponse(t):s===i.ResponseCodes.ChannelInfo?this.onChannelInfoResponse(t):s===i.ResponseCodes.SignStart?this.onSignStartResponse(t):s===i.ResponseCodes.Signature?this.onSignatureResponse(t):s===i.PushCodes.Advert?this.onAdvertPush(t):s===i.PushCodes.PathUpdated?this.onPathUpdatedPush(t):s===i.PushCodes.SendConfirmed?this.onSendConfirmedPush(t):s===i.PushCodes.MsgWaiting?this.onMsgWaitingPush(t):s===i.PushCodes.RawData?this.onRawDataPush(t):s===i.PushCodes.LoginSuccess?this.onLoginSuccessPush(t):s===i.PushCodes.StatusResponse?this.onStatusResponsePush(t):s===i.PushCodes.LogRxData?this.onLogRxDataPush(t):s===i.PushCodes.TelemetryResponse?this.onTelemetryResponsePush(t):s===i.PushCodes.TraceData?this.onTraceDataPush(t):s===i.PushCodes.NewAdvert?this.onNewAdvertPush(t):s===i.PushCodes.BinaryResponse?this.onBinaryResponsePush(t):console.log(`unhandled frame: code=${s}`,e)}onAdvertPush(e){this.emit(i.PushCodes.Advert,{publicKey:e.readBytes(32)})}onPathUpdatedPush(e){this.emit(i.PushCodes.PathUpdated,{publicKey:e.readBytes(32)})}onSendConfirmedPush(e){this.emit(i.PushCodes.SendConfirmed,{ackCode:e.readUInt32LE(),roundTrip:e.readUInt32LE()})}onMsgWaitingPush(e){this.emit(i.PushCodes.MsgWaiting,{})}onRawDataPush(e){this.emit(i.PushCodes.RawData,{lastSnr:e.readInt8()/4,lastRssi:e.readInt8(),reserved:e.readByte(),payload:e.readRemainingBytes()})}onLoginSuccessPush(e){this.emit(i.PushCodes.LoginSuccess,{reserved:e.readByte(),pubKeyPrefix:e.readBytes(6)})}onStatusResponsePush(e){this.emit(i.PushCodes.StatusResponse,{reserved:e.readByte(),pubKeyPrefix:e.readBytes(6),statusData:e.readRemainingBytes()})}onLogRxDataPush(e){this.emit(i.PushCodes.LogRxData,{lastSnr:e.readInt8()/4,lastRssi:e.readInt8(),raw:e.readRemainingBytes()})}onTelemetryResponsePush(e){this.emit(i.PushCodes.TelemetryResponse,{reserved:e.readByte(),pubKeyPrefix:e.readBytes(6),lppSensorData:e.readRemainingBytes()})}onBinaryResponsePush(e){this.emit(i.PushCodes.BinaryResponse,{reserved:e.readByte(),tag:e.readUInt32LE(),responseData:e.readRemainingBytes()})}onTraceDataPush(e){let t=e.readByte(),s=e.readUInt8();this.emit(i.PushCodes.TraceData,{reserved:t,pathLen:s,flags:e.readUInt8(),tag:e.readUInt32LE(),authCode:e.readUInt32LE(),pathHashes:e.readBytes(s),pathSnrs:e.readBytes(s),lastSnr:e.readInt8()/4})}onNewAdvertPush(e){this.emit(i.PushCodes.NewAdvert,{publicKey:e.readBytes(32),type:e.readByte(),flags:e.readByte(),outPathLen:e.readInt8(),outPath:e.readBytes(64),advName:e.readCString(32),lastAdvert:e.readUInt32LE(),advLat:e.readUInt32LE(),advLon:e.readUInt32LE(),lastMod:e.readUInt32LE()})}onOkResponse(e){this.emit(i.ResponseCodes.Ok,{})}onErrResponse(e){let t=e.getRemainingBytesCount()>0?e.readByte():null;this.emit(i.ResponseCodes.Err,{errCode:t})}onContactsStartResponse(e){this.emit(i.ResponseCodes.ContactsStart,{count:e.readUInt32LE()})}onContactResponse(e){this.emit(i.ResponseCodes.Contact,{publicKey:e.readBytes(32),type:e.readByte(),flags:e.readByte(),outPathLen:e.readInt8(),outPath:e.readBytes(64),advName:e.readCString(32),lastAdvert:e.readUInt32LE(),advLat:e.readUInt32LE(),advLon:e.readUInt32LE(),lastMod:e.readUInt32LE()})}onEndOfContactsResponse(e){this.emit(i.ResponseCodes.EndOfContacts,{mostRecentLastmod:e.readUInt32LE()})}onSentResponse(e){this.emit(i.ResponseCodes.Sent,{result:e.readInt8(),expectedAckCrc:e.readUInt32LE(),estTimeout:e.readUInt32LE()})}onExportContactResponse(e){this.emit(i.ResponseCodes.ExportContact,{advertPacketBytes:e.readRemainingBytes()})}onBatteryVoltageResponse(e){this.emit(i.ResponseCodes.BatteryVoltage,{batteryMilliVolts:e.readUInt16LE()})}onDeviceInfoResponse(e){this.emit(i.ResponseCodes.DeviceInfo,{firmwareVer:e.readInt8(),reserved:e.readBytes(6),firmware_build_date:e.readCString(12),manufacturerModel:e.readString()})}onPrivateKeyResponse(e){this.emit(i.ResponseCodes.PrivateKey,{privateKey:e.readBytes(64)})}onDisabledResponse(e){this.emit(i.ResponseCodes.Disabled,{})}onChannelInfoResponse(e){let t=e.readUInt8(),s=e.readCString(32),o=e.getRemainingBytesCount();o===16?this.emit(i.ResponseCodes.ChannelInfo,{channelIdx:t,name:s,secret:e.readBytes(o)}):console.log(`ChannelInfo has unexpected key length: ${o}`)}onSignStartResponse(e){this.emit(i.ResponseCodes.SignStart,{reserved:e.readByte(),maxSignDataLen:e.readUInt32LE()})}onSignatureResponse(e){this.emit(i.ResponseCodes.Signature,{signature:e.readBytes(64)})}onSelfInfoResponse(e){this.emit(i.ResponseCodes.SelfInfo,{type:e.readByte(),txPower:e.readByte(),maxTxPower:e.readByte(),publicKey:e.readBytes(32),advLat:e.readInt32LE(),advLon:e.readInt32LE(),reserved:e.readBytes(3),manualAddContacts:e.readByte(),radioFreq:e.readUInt32LE(),radioBw:e.readUInt32LE(),radioSf:e.readByte(),radioCr:e.readByte(),name:e.readString()})}onCurrTimeResponse(e){this.emit(i.ResponseCodes.CurrTime,{epochSecs:e.readUInt32LE()})}onNoMoreMessagesResponse(e){this.emit(i.ResponseCodes.NoMoreMessages,{})}onContactMsgRecvResponse(e){this.emit(i.ResponseCodes.ContactMsgRecv,{pubKeyPrefix:e.readBytes(6),pathLen:e.readByte(),txtType:e.readByte(),senderTimestamp:e.readUInt32LE(),text:e.readString()})}onChannelMsgRecvResponse(e){this.emit(i.ResponseCodes.ChannelMsgRecv,{channelIdx:e.readInt8(),pathLen:e.readByte(),txtType:e.readByte(),senderTimestamp:e.readUInt32LE(),text:e.readString()})}getSelfInfo(e=null){return new Promise(async(t,s)=>{this.once(i.ResponseCodes.SelfInfo,o=>{t(o)}),e!=null&&setTimeout(s,e),await this.sendCommandAppStart()})}async sendAdvert(e){return new Promise(async(t,s)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSendSelfAdvert(e)}catch(o){s(o)}})}async sendFloodAdvert(){return await this.sendAdvert(i.SelfAdvertTypes.Flood)}async sendZeroHopAdvert(){return await this.sendAdvert(i.SelfAdvertTypes.ZeroHop)}setAdvertName(e){return new Promise(async(t,s)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetAdvertName(e)}catch(o){s(o)}})}setAdvertLatLong(e,t){return new Promise(async(s,o)=>{try{let r=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),s()},a=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),o()};this.once(i.ResponseCodes.Ok,r),this.once(i.ResponseCodes.Err,a),await this.sendCommandSetAdvertLatLon(e,t)}catch(r){o(r)}})}setTxPower(e){return new Promise(async(t,s)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetTxPower(e)}catch(o){s(o)}})}setRadioParams(e,t,s,o){return new Promise(async(r,a)=>{try{let d=()=>{this.off(i.ResponseCodes.Ok,d),this.off(i.ResponseCodes.Err,c),r()},c=()=>{this.off(i.ResponseCodes.Ok,d),this.off(i.ResponseCodes.Err,c),a()};this.once(i.ResponseCodes.Ok,d),this.once(i.ResponseCodes.Err,c),await this.sendCommandSetRadioParams(e,t,s,o)}catch(d){a(d)}})}getContacts(){return new Promise(async(e,t)=>{let s=[],o=r=>{s.push(r)};this.on(i.ResponseCodes.Contact,o),this.once(i.ResponseCodes.EndOfContacts,()=>{this.off(i.ResponseCodes.Contact,o),e(s)}),await this.sendCommandGetContacts()})}async findContactByName(e){return(await this.getContacts()).find(s=>s.advName===e)}async findContactByPublicKeyPrefix(e){return(await this.getContacts()).find(s=>{let o=s.publicKey.subarray(0,e.length);return we.areBuffersEqual(e,o)})}sendTextMessage(e,t,s){return new Promise(async(o,r)=>{try{let a=l=>{this.off(i.ResponseCodes.Sent,a),this.off(i.ResponseCodes.Err,d),o(l)},d=()=>{this.off(i.ResponseCodes.Sent,a),this.off(i.ResponseCodes.Err,d),r()};this.once(i.ResponseCodes.Sent,a),this.once(i.ResponseCodes.Err,d);let c=s??i.TxtTypes.Plain,h=0,u=Math.floor(Date.now()/1e3);await this.sendCommandSendTxtMsg(c,h,u,e,t)}catch(a){r(a)}})}sendChannelTextMessage(e,t){return new Promise(async(s,o)=>{try{let r=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),s()},a=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),o()};this.once(i.ResponseCodes.Ok,r),this.once(i.ResponseCodes.Err,a);let d=i.TxtTypes.Plain,c=Math.floor(Date.now()/1e3);await this.sendCommandSendChannelTxtMsg(d,e,c,t)}catch(r){o(r)}})}syncNextMessage(){return new Promise(async(e,t)=>{let s=a=>{this.off(i.ResponseCodes.ContactMsgRecv,s),this.off(i.ResponseCodes.ChannelMsgRecv,o),this.off(i.ResponseCodes.NoMoreMessages,r),e({contactMessage:a})},o=a=>{this.off(i.ResponseCodes.ContactMsgRecv,s),this.off(i.ResponseCodes.ChannelMsgRecv,o),this.off(i.ResponseCodes.NoMoreMessages,r),e({channelMessage:a})},r=()=>{this.off(i.ResponseCodes.ContactMsgRecv,s),this.off(i.ResponseCodes.ChannelMsgRecv,o),this.off(i.ResponseCodes.NoMoreMessages,r),e(null)};this.once(i.ResponseCodes.ContactMsgRecv,s),this.once(i.ResponseCodes.ChannelMsgRecv,o),this.once(i.ResponseCodes.NoMoreMessages,r),await this.sendCommandSyncNextMessage()})}async getWaitingMessages(){let e=[];for(;;){let t=await this.syncNextMessage();if(!t)break;e.push(t)}return e}getDeviceTime(){return new Promise(async(e,t)=>{try{let s=r=>{this.off(i.ResponseCodes.CurrTime,s),this.off(i.ResponseCodes.Err,o),e(r)},o=()=>{this.off(i.ResponseCodes.CurrTime,s),this.off(i.ResponseCodes.Err,o),t()};this.once(i.ResponseCodes.CurrTime,s),this.once(i.ResponseCodes.Err,o),await this.sendCommandGetDeviceTime()}catch(s){t(s)}})}setDeviceTime(e){return new Promise(async(t,s)=>{try{let o=a=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetDeviceTime(e)}catch(o){s(o)}})}async syncDeviceTime(){await this.setDeviceTime(Math.floor(Date.now()/1e3))}importContact(e){return new Promise(async(t,s)=>{try{let o=a=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandImportContact(e)}catch(o){s(o)}})}exportContact(e=null){return new Promise(async(t,s)=>{try{let o=a=>{this.off(i.ResponseCodes.ExportContact,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.ExportContact,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.ExportContact,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandExportContact(e)}catch(o){s(o)}})}shareContact(e){return new Promise(async(t,s)=>{try{let o=a=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandShareContact(e)}catch(o){s(o)}})}removeContact(e){return new Promise(async(t,s)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandRemoveContact(e)}catch(o){s(o)}})}addOrUpdateContact(e,t,s,o,r,a,d,c,h){return new Promise(async(u,l)=>{try{let f=()=>{this.off(i.ResponseCodes.Ok,f),this.off(i.ResponseCodes.Err,p),u()},p=()=>{this.off(i.ResponseCodes.Ok,f),this.off(i.ResponseCodes.Err,p),l()};this.once(i.ResponseCodes.Ok,f),this.once(i.ResponseCodes.Err,p),await this.sendCommandAddUpdateContact(e,t,s,o,r,a,d,c,h)}catch(f){l(f)}})}setContactPath(e,t){return new Promise(async(s,o)=>{try{let d=new Uint8Array(64);for(var r=0;r<t.length&&r<64;r++)d[r]=t[r];return e.outPathLen=t.length,e.outPath=d,await this.addOrUpdateContact(e.publicKey,e.type,e.flags,e.outPathLen,e.outPath,e.advName,e.lastAdvert,e.advLat,e.advLon)}catch(a){o(a)}})}resetPath(e){return new Promise(async(t,s)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandResetPath(e)}catch(o){s(o)}})}reboot(){return new Promise(async(e,t)=>{try{let s=()=>{this.off(i.ResponseCodes.Err,s),t()};setTimeout(()=>{this.off(i.ResponseCodes.Err,s),e()},1e3),this.once(i.ResponseCodes.Err,s),await this.sendCommandReboot()}catch(s){t(s)}})}getBatteryVoltage(){return new Promise(async(e,t)=>{try{let s=r=>{this.off(i.ResponseCodes.BatteryVoltage,s),this.off(i.ResponseCodes.Err,o),e(r)},o=()=>{this.off(i.ResponseCodes.BatteryVoltage,s),this.off(i.ResponseCodes.Err,o),t()};this.once(i.ResponseCodes.BatteryVoltage,s),this.once(i.ResponseCodes.Err,o),await this.sendCommandGetBatteryVoltage()}catch(s){t(s)}})}deviceQuery(e){return new Promise(async(t,s)=>{try{let o=a=>{this.off(i.ResponseCodes.DeviceInfo,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.DeviceInfo,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.DeviceInfo,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandDeviceQuery(e)}catch(o){s(o)}})}exportPrivateKey(){return new Promise(async(e,t)=>{try{let s=a=>{this.off(i.ResponseCodes.PrivateKey,s),this.off(i.ResponseCodes.Err,o),this.off(i.ResponseCodes.Disabled,r),e(a)},o=()=>{this.off(i.ResponseCodes.PrivateKey,s),this.off(i.ResponseCodes.Err,o),this.off(i.ResponseCodes.Disabled,r),t()},r=()=>{this.off(i.ResponseCodes.PrivateKey,s),this.off(i.ResponseCodes.Err,o),this.off(i.ResponseCodes.Disabled,r),t("disabled")};this.once(i.ResponseCodes.PrivateKey,s),this.once(i.ResponseCodes.Err,o),this.once(i.ResponseCodes.Disabled,r),await this.sendCommandExportPrivateKey()}catch(s){t(s)}})}importPrivateKey(e){return new Promise(async(t,s)=>{try{let o=d=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),this.off(i.ResponseCodes.Disabled,a),t(d)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),this.off(i.ResponseCodes.Disabled,a),s()},a=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),this.off(i.ResponseCodes.Disabled,a),s("disabled")};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),this.once(i.ResponseCodes.Disabled,a),await this.sendCommandImportPrivateKey(e)}catch(o){s(o)}})}login(e,t,s=1e3){return new Promise(async(o,r)=>{try{let d=e.subarray(0,6);var a=null;let c=l=>{this.off(i.ResponseCodes.Err,u);let f=l.estTimeout+s;a=setTimeout(()=>{this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.LoginSuccess,h),r("timeout")},f)},h=l=>{if(!we.areBuffersEqual(d,l.pubKeyPrefix)){console.log("onLoginSuccess is not for this login request, ignoring...");return}clearTimeout(a),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.LoginSuccess,h),o(l)},u=()=>{clearTimeout(a),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.LoginSuccess,h),r()};this.once(i.ResponseCodes.Err,u),this.once(i.ResponseCodes.Sent,c),this.once(i.PushCodes.LoginSuccess,h),await this.sendCommandSendLogin(e,t)}catch(d){r(d)}})}getStatus(e,t=1e3){return new Promise(async(s,o)=>{try{let a=e.subarray(0,6);var r=null;let d=u=>{this.off(i.ResponseCodes.Err,h);let l=u.estTimeout+t;r=setTimeout(()=>{this.off(i.ResponseCodes.Err,h),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.StatusResponse,c),o("timeout")},l)},c=u=>{if(!we.areBuffersEqual(a,u.pubKeyPrefix)){console.log("onStatusResponsePush is not for this status request, ignoring...");return}clearTimeout(r),this.off(i.ResponseCodes.Err,h),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.StatusResponse,c);let l=new k(u.statusData),f={batt_milli_volts:l.readUInt16LE(),curr_tx_queue_len:l.readUInt16LE(),noise_floor:l.readInt16LE(),last_rssi:l.readInt16LE(),n_packets_recv:l.readUInt32LE(),n_packets_sent:l.readUInt32LE(),total_air_time_secs:l.readUInt32LE(),total_up_time_secs:l.readUInt32LE(),n_sent_flood:l.readUInt32LE(),n_sent_direct:l.readUInt32LE(),n_recv_flood:l.readUInt32LE(),n_recv_direct:l.readUInt32LE(),err_events:l.readUInt16LE(),last_snr:l.readInt16LE(),n_direct_dups:l.readUInt16LE(),n_flood_dups:l.readUInt16LE()};s(f)},h=()=>{clearTimeout(r),this.off(i.ResponseCodes.Err,h),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.StatusResponse,c),o()};this.once(i.ResponseCodes.Err,h),this.once(i.ResponseCodes.Sent,d),this.once(i.PushCodes.StatusResponse,c),await this.sendCommandSendStatusReq(e)}catch(a){o(a)}})}getTelemetry(e,t=1e3){return new Promise(async(s,o)=>{try{let a=e.subarray(0,6);var r=null;let d=u=>{this.off(i.ResponseCodes.Err,h);let l=u.estTimeout+t;r=setTimeout(()=>{this.off(i.ResponseCodes.Err,h),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TelemetryResponse,c),o("timeout")},l)},c=u=>{if(!we.areBuffersEqual(a,u.pubKeyPrefix)){console.log("onTelemetryResponsePush is not for this telemetry request, ignoring...");return}clearTimeout(r),this.off(i.ResponseCodes.Err,h),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TelemetryResponse,c),s(u)},h=()=>{clearTimeout(r),this.off(i.ResponseCodes.Err,h),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TelemetryResponse,c),o()};this.once(i.ResponseCodes.Err,h),this.once(i.ResponseCodes.Sent,d),this.once(i.PushCodes.TelemetryResponse,c),await this.sendCommandSendTelemetryReq(e)}catch(a){o(a)}})}sendBinaryRequest(e,t,s=1e3){return new Promise(async(o,r)=>{try{var a=null,d=null;let c=l=>{a=l.expectedAckCrc,this.off(i.ResponseCodes.Err,u);let f=l.estTimeout+s;d=setTimeout(()=>{this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.BinaryResponse,h),r("timeout")},f)},h=l=>{if(a!==l.tag){console.log("onBinaryResponse is not for this request tag, ignoring...");return}clearTimeout(d),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.BinaryResponse,h),o(l.responseData)},u=()=>{clearTimeout(d),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.BinaryResponse,h),r()};this.once(i.ResponseCodes.Err,u),this.once(i.ResponseCodes.Sent,c),this.once(i.PushCodes.BinaryResponse,h),await this.sendCommandSendBinaryReq(e,t)}catch(c){r(c)}})}pingRepeaterZeroHop(e,t){return new Promise(async(s,o)=>{try{let a=new v;a.writeUInt32LE(Date.now()),a.writeBytes([112,105,110,103]),a.writeBytes(e.subarray(0,2));let d=a.toBytes();var r=Date.now();let c=u=>{let f=Date.now()-r,p=Et.fromBytes(u.raw);p.payload_type===Et.PAYLOAD_TYPE_RAW_CUSTOM&&we.areBuffersEqual(p.payload,d)&&(this.off(i.ResponseCodes.Err,h),this.off(i.PushCodes.LogRxData,c),s({rtt:f,snr:u.lastSnr,rssi:u.lastRssi}))},h=()=>{this.off(i.ResponseCodes.Err,h),this.off(i.PushCodes.LogRxData,c),o()};this.once(i.ResponseCodes.Err,h),this.on(i.PushCodes.LogRxData,c),t!=null&&setTimeout(()=>{this.off(i.ResponseCodes.Err,h),this.off(i.PushCodes.LogRxData,c),o("timeout")},t),await this.sendCommandSendRawData([e.subarray(0,1)],d)}catch(a){o(a)}})}getChannel(e){return new Promise(async(t,s)=>{try{let o=a=>{this.off(i.ResponseCodes.ChannelInfo,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.ChannelInfo,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.ChannelInfo,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandGetChannel(e)}catch(o){s(o)}})}setChannel(e,t,s){return new Promise(async(o,r)=>{try{let a=()=>{this.off(i.ResponseCodes.Ok,a),this.off(i.ResponseCodes.Err,d),o()},d=()=>{this.off(i.ResponseCodes.Ok,a),this.off(i.ResponseCodes.Err,d),r()};this.once(i.ResponseCodes.Ok,a),this.once(i.ResponseCodes.Err,d),await this.sendCommandSetChannel(e,t,s)}catch(a){r(a)}})}async deleteChannel(e){return await this.setChannel(e,"",new Uint8Array(16))}getChannels(){return new Promise(async(e,t)=>{var s=0;let o=[];for(;;){try{let r=await this.getChannel(s);o.push(r)}catch{break}s++}return e(o)})}async findChannelByName(e){return(await this.getChannels()).find(s=>s.name===e)}async findChannelBySecret(e){return(await this.getChannels()).find(s=>we.areBuffersEqual(e,s.secret))}async sign(e){return new Promise(async(t,s)=>{try{let r=new k(e),a=async()=>{var l;r.getRemainingBytesCount()>=128?l=r.readBytes(128):l=r.readRemainingBytes(),await this.sendCommandSignData(l)},d=async l=>{if(r.getRemainingBytesCount()>0){await a();return}await this.sendCommandSignFinish()},c=async l=>{if(this.off(i.ResponseCodes.SignStart,c),r.getRemainingBytesCount()>l.maxSignDataLen){this.off(i.ResponseCodes.ok,d),this.off(i.ResponseCodes.err,u),this.off(i.ResponseCodes.SignStart,c),this.off(i.ResponseCodes.Signature,h),s("data_too_long");return}await a()},h=l=>{this.off(i.ResponseCodes.ok,d),this.off(i.ResponseCodes.err,u),this.off(i.ResponseCodes.SignStart,c),this.off(i.ResponseCodes.Signature,h),t(l.signature)},u=l=>{this.off(i.ResponseCodes.ok,d),this.off(i.ResponseCodes.err,u),this.off(i.ResponseCodes.SignStart,c),this.off(i.ResponseCodes.Signature,h),s(l)};this.on(i.ResponseCodes.Ok,d),this.on(i.ResponseCodes.SignStart,c),this.on(i.ResponseCodes.Signature,h),this.once(i.ResponseCodes.Err,u),await this.sendCommandSignStart()}catch(o){s(o)}})}tracePath(e,t=0){return new Promise(async(s,o)=>{try{let a=gs.getRandomInt(0,4294967295);var r=null;let d=u=>{this.off(i.ResponseCodes.Err,h);let l=u.estTimeout+t;r=setTimeout(()=>{this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TraceData,c),this.off(i.ResponseCodes.Err,h),o("timeout")},l)},c=u=>{if(u.tag!==a){console.log("ignoring trace data for a different trace request");return}clearTimeout(r),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TraceData,c),this.off(i.ResponseCodes.Err,h),s(u)},h=()=>{clearTimeout(r),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TraceData,c),this.off(i.ResponseCodes.Err,h),o()};this.once(i.ResponseCodes.Sent,d),this.on(i.PushCodes.TraceData,c),this.once(i.ResponseCodes.Err,h),await this.sendCommandSendTracePath(a,0,e)}catch(a){o(a)}})}setOtherParams(e){return new Promise(async(t,s)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),s()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetOtherParams(e)}catch(o){s(o)}})}async setAutoAddContacts(){return await this.setOtherParams(!1)}async setManualAddContacts(){return await this.setOtherParams(!0)}async getNeighbours(e,t=10,s=0,o=0,r=8){let a=new v;a.writeByte(i.BinaryRequestTypes.GetNeighbours),a.writeByte(0),a.writeByte(t),a.writeUInt16LE(s),a.writeByte(o),a.writeByte(r),a.writeUInt32LE(gs.getRandomInt(0,4294967295));let d=await this.sendBinaryRequest(e,a.toBytes()),c=new k(d),h=c.readUInt16LE(),u=c.readUInt16LE(),l=[];for(var f=0;f<u;f++){let p=c.readBytes(r),y=c.readUInt32LE(),x=c.readInt8()/4;l.push({publicKeyPrefix:p,heardSecondsAgo:y,snr:x})}return{totalNeighboursCount:h,neighbours:l}}},je=ws;var Cs=class n extends je{constructor(){if(super(),this.readBuffer=[],this.constructor===n)throw new Error("SerialConnection is an abstract class and can't be instantiated.")}async write(e){throw new Error("Not Implemented: write must be implemented by SerialConnection sub class.")}async writeFrame(e,t){let s=new v;s.writeByte(e),s.writeUInt16LE(t.length),s.writeBytes(t),await this.write(s.toBytes())}async sendToRadioFrame(e){this.emit("tx",e),await this.writeFrame(60,e)}async onDataReceived(e){this.readBuffer=[...this.readBuffer,...e];let t=3;for(;this.readBuffer.length>=t;)try{let s=new k(this.readBuffer.slice(0,t)),o=s.readByte();if(o!==i.SerialFrameTypes.Incoming&&o!==i.SerialFrameTypes.Outgoing){this.readBuffer=this.readBuffer.slice(1);continue}let r=s.readUInt16LE();if(!r){this.readBuffer=this.readBuffer.slice(1);continue}let a=t+r;if(this.readBuffer.length<a)break;let d=this.readBuffer.slice(t,a);this.readBuffer=this.readBuffer.slice(a),this.onFrameReceived(d)}catch(s){console.error("Failed to process frame",s);break}}},xt=Cs;var Es=class n extends xt{constructor(e){super(),this.serialPort=e,this.reader=e.readable.getReader(),this.writable=e.writable,this.readLoop(),this.serialPort.addEventListener("disconnect",()=>{this.onDisconnected()}),setTimeout(async()=>{await this.onConnected()},0)}static async open(){if(!navigator.serial)return alert("Web Serial is not supported in this browser"),null;let e=await navigator.serial.requestPort({filters:[]});return await e.open({baudRate:115200}),new n(e)}async close(){try{this.reader.releaseLock()}catch{}try{await this.serialPort.close()}catch{}}async write(e){let t=this.writable.getWriter();try{await t.write(new Uint8Array(e))}finally{t.releaseLock()}}async readLoop(){try{for(;;){let{value:e,done:t}=await this.reader.read();if(t)break;await this.onDataReceived(e)}}catch(e){if(e instanceof TypeError)return;console.error("Error reading from serial port: ",e)}finally{this.reader.releaseLock()}}},xs=Es;function cr(n){return Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join("")}var Xn={test:{name:"Test Scan",description:"Quick test with common USA frequencies",frequencies:[{freq:910.525,label:"USA/CAN Recommended"},{freq:927.875,label:"SoCal"}],bandwidths:[62.5,125,250],spreadingFactors:[6,7]},amer:{name:"Americas Scan",description:"Comprehensive scan of Americas frequencies",frequencies:[{freq:907.875,label:"Texas"},{freq:910.525,label:"USA/CAN/TX/CO"},{freq:927.875,label:"SoCal"}],bandwidths:[7.8,10.4,15.6,20.8,31.25,41.7,62.5,125,250,500],spreadingFactors:[5,6,7,8,9,10,11,12]},global:{name:"Global Scan",description:"Full global frequency scan",frequencies:[{freq:869.525,label:"EU/UK Long/Medium, Czech"},{freq:869.618,label:"EU/UK Narrow, Portugal"},{freq:907.875,label:"Texas"},{freq:910.525,label:"USA/CAN/TX/CO"},{freq:915.8,label:"Australia"},{freq:916.575,label:"Australia VIC"},{freq:917.375,label:"NZ/NZ Narrow"},{freq:920.25,label:"Vietnam"},{freq:927.875,label:"SoCal"}],bandwidths:[7.8,10.4,15.6,20.8,31.25,41.7,62.5,125,250,500],spreadingFactors:[5,6,7,8,9,10,11,12]}},dr={test:`<h4>Test Scan</h4>
<ul>
  <li><strong>Frequencies:</strong> 910.525 MHz (USA/CAN), 927.875 MHz (SoCal)</li>
  <li><strong>Bandwidths:</strong> 62.5, 125, 250 kHz</li>
  <li><strong>Spreading Factors:</strong> 6, 7</li>
</ul>`,amer:`<h4>Americas Scan</h4>
<ul>
  <li><strong>Frequencies:</strong> 907.875 (TX), 910.525 (USA/CAN/TX/CO), 927.875 (SoCal) MHz</li>
  <li><strong>Bandwidths:</strong> 7.8, 10.4, 15.6, 20.8, 31.25, 41.7, 62.5, 125, 250, 500 kHz</li>
  <li><strong>Spreading Factors:</strong> 5-12</li>
</ul>`,global:`<h4>Global Scan</h4>
<ul>
  <li><strong>Frequencies:</strong> EU/UK (869.525, 869.618), Americas (907.875, 910.525, 927.875), AUS (915.8, 916.575), NZ (917.375), Vietnam (920.25) MHz</li>
  <li><strong>Bandwidths:</strong> 7.8, 10.4, 15.6, 20.8, 31.25, 41.7, 62.5, 125, 250, 500 kHz</li>
  <li><strong>Spreading Factors:</strong> 5-12</li>
</ul>`};function fr(n){let e=[];for(let t of n.frequencies)for(let s of n.bandwidths)for(let o of n.spreadingFactors)e.push({freq:t.freq,freqLabel:t.label,bw:s,sf:o});return e}function vt(){let n=parseFloat(Rt?.value)||900,e=parseFloat(St?.value)||930,t=parseFloat(Tt?.value)||.25,s=[];for(let c=n;c<=e+1e-4;c+=t){let h=Math.round(c*1e3)/1e3;s.push({freq:h,label:`${h} MHz`})}let r=(Ps?.value||"7.8, 10.4, 15.6, 20.8, 31.25, 41.7, 62.5, 125, 250, 500").split(",").map(c=>parseFloat(c.trim())).filter(c=>!isNaN(c)&&c>0),d=(vs?.value||"5, 6, 7, 8, 9, 10, 11, 12").split(",").map(c=>parseInt(c.trim(),10)).filter(c=>!isNaN(c)&&c>=5&&c<=12);return{name:"Custom Scan",description:"User-defined frequency range and parameters",frequencies:s.length>0?s:[{freq:915,label:"915 MHz"}],bandwidths:r.length>0?r:[125],spreadingFactors:d.length>0?d:[7]}}function ur(){let n=vt();return n.frequencies.length*n.bandwidths.length*n.spreadingFactors.length}function Wn(){if(As){let n=ur();As.textContent=`${n} combinations`}ie==="custom"&&_s()}var qe,et,Je,ge,Le,Qn,Bt,jn,Jn,eo,to,bs,Bs,so,Rs,Ss,Ts,Rt,St,Tt,Ps,vs,As,tt=[],hr=5,V=null,He=!1,Ls=null,ie="test",Be=[],ye=0,Pt=0,st=new Map,nt=null,bt=null;function lr(n,e,t){return`${n}-${e}-${t}`}function pr(n){let e=Math.floor(n/3600),t=Math.floor(n%3600/60),s=Math.floor(n%60);return e>0?`${e}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${t}:${s.toString().padStart(2,"0")}`}function ke(n){switch(Je.className=`connection-status ${n}`,n){case"disconnected":Je.textContent="Disconnected",qe.disabled=!1,et.disabled=!0,ge.disabled=!0;break;case"connecting":Je.textContent="Connecting...",qe.disabled=!0,et.disabled=!0,ge.disabled=!0;break;case"connected":Je.textContent="Connected",qe.disabled=!0,et.disabled=!1,ge.disabled=!1;break}}function _s(){let n=ie==="custom"?vt():Xn[ie],e=n.frequencies.length*n.bandwidths.length*n.spreadingFactors.length,t=parseFloat(Le.value)||1,s=e*t,o;if(s<60)o=`${Math.round(s)} minutes`;else{let r=Math.floor(s/60),a=Math.round(s%60);o=a>0?`${r}h ${a}m`:`${r} hours`}Qn.innerHTML=`Estimated scan time: <strong>${o}</strong>`}function no(){let n=vt(),e=parseFloat(Rt?.value)||900,t=parseFloat(St?.value)||930,s=parseFloat(Tt?.value)||.25;return`<h4>Custom Scan</h4>
<ul>
  <li><strong>Frequencies:</strong> ${e} - ${t} MHz (step ${s} MHz, ${n.frequencies.length} frequencies)</li>
  <li><strong>Bandwidths:</strong> ${n.bandwidths.join(", ")} kHz</li>
  <li><strong>Spreading Factors:</strong> ${n.spreadingFactors.join(", ")}</li>
</ul>`}function zn(){document.querySelectorAll(".scan-type-option").forEach(n=>{n.querySelector("input").value===ie?n.classList.add("selected"):n.classList.remove("selected")}),Ts&&(Ts.style.display=ie==="custom"?"flex":"none"),ie==="custom"?(Bt.innerHTML=no(),Wn()):Bt.innerHTML=dr[ie],_s()}function Is(){if(!Ls)return;let n=Math.floor((Date.now()-Ls.getTime())/1e3);Jn.textContent=pr(n);let e=Be[ye];e&&(eo.textContent=`${e.freq} MHz | BW ${e.bw} | SF${e.sf}`),to.textContent=`${ye+1} / ${Be.length}`;let t=ye/Be.length*100;Pt===0?(bs.style.width=`${t}%`,Bs.textContent=`${Math.round(t)}%`):(bs.style.width="100%",Bs.textContent=`100% [${Math.round(t)}% cycle #${Pt+1}]`)}function oo(){if(so.textContent=String(st.size),st.size===0){Rs.innerHTML='<div class="no-networks">No networks found yet. Start a scan to search for MeshCore traffic.</div>';return}let n=Array.from(st.values()).sort((e,t)=>t.lastSeen.getTime()-e.lastSeen.getTime());Rs.innerHTML=n.map(e=>{let t=e.lastSeen.toLocaleTimeString("en-US",{hour12:!1});return`<div class="network-item">
        <span class="network-config">${e.freq} MHz | BW ${e.bw} kHz | SF${e.sf}</span>
        <span class="network-packets">${e.packetCount} packet${e.packetCount!==1?"s":""}</span>
        <span class="network-time">Last: ${t}</span>
      </div>`}).join("")}function ro(){if(tt.length===0){Ss.innerHTML='<div class="no-packets">No packets received yet.</div>';return}Ss.innerHTML=tt.map(n=>{let e=n.time.toLocaleTimeString("en-US",{hour12:!1}),t=n.hex.length>80?n.hex.substring(0,80)+"...":n.hex,s=`./index.html?packet=${encodeURIComponent(n.hex)}`;return`<div class="packet-item">
        <span class="packet-time">${e}</span>
        <span class="packet-hex" title="${n.hex}">${t}</span>
        <a href="${s}" target="_blank" class="packet-link">Analyze</a>
      </div>`}).join("")}function mr(n){tt.unshift({hex:n,time:new Date}),tt.length>hr&&tt.pop(),ro();let e=Be[ye];if(!e)return;let t=lr(e.freq,e.bw,e.sf),s=st.get(t);s?(s.packetCount++,s.lastSeen=new Date):st.set(t,{freq:e.freq,bw:e.bw,sf:e.sf,packetCount:1,firstSeen:new Date,lastSeen:new Date}),oo()}async function io(n,e,t){if(!V)return!1;try{return await V.sendCommandSetRadioParams(Math.round(n*1e3),Math.round(e*1e3),t,5),new Promise(s=>{let o=setTimeout(()=>{V.off(i.ResponseCodes.Ok,r),s(!1)},3e3),r=()=>{clearTimeout(o),V.off(i.ResponseCodes.Ok,r),s(!0)};V.on(i.ResponseCodes.Ok,r)})}catch{return!1}}async function ao(){if(!He)return;ye++,ye>=Be.length&&(Pt++,ye=0);let n=Be[ye];await io(n.freq,n.bw,n.sf)||console.warn("Failed to set radio params, continuing anyway"),Is();let t=(parseFloat(Le.value)||1)*60*1e3;nt=window.setTimeout(()=>ao(),t)}async function yr(){if(!V||He)return;He=!0,Ls=new Date,ye=0,Pt=0;let n=ie==="custom"?vt():Xn[ie];Be=fr(n),ge.textContent="Stop Scan",ge.classList.add("scanning"),jn.style.display="flex",document.querySelectorAll(".scan-type-option input").forEach(s=>{s.disabled=!0}),Le.disabled=!0;let e=Be[0];await io(e.freq,e.bw,e.sf),Is(),bt=window.setInterval(()=>Is(),1e3);let t=(parseFloat(Le.value)||1)*60*1e3;nt=window.setTimeout(()=>ao(),t)}function Os(){He=!1,nt!==null&&(clearTimeout(nt),nt=null),bt!==null&&(clearInterval(bt),bt=null),ge.textContent="Start Scan",ge.classList.remove("scanning"),document.querySelectorAll(".scan-type-option input").forEach(n=>{n.disabled=!1}),Le.disabled=!1}function gr(n){n.on(i.PushCodes.LogRxData,e=>{if(He){let t=cr(e.raw);mr(t)}}),n.on("disconnected",()=>{Os(),ke("disconnected"),V=null})}async function wr(){try{if(ke("connecting"),V=await xs.open(),!V){ke("disconnected");return}gr(V),await new Promise((n,e)=>{let t=setTimeout(()=>e(new Error("Timeout")),1e4);V.on("connected",async()=>{clearTimeout(t),ke("connected");try{await V.syncDeviceTime()}catch{}n()})})}catch(n){if(console.error("Connection error:",n),ke("disconnected"),V){try{V.close()}catch{}V=null}}}function Cr(){if(Os(),V){try{V.close()}catch{}V=null}ke("disconnected")}document.addEventListener("DOMContentLoaded",()=>{qe=document.getElementById("connect-btn"),et=document.getElementById("disconnect-btn"),Je=document.getElementById("connection-status"),ge=document.getElementById("scan-btn"),Le=document.getElementById("linger-time"),Qn=document.getElementById("estimated-time"),Bt=document.getElementById("scan-info"),jn=document.getElementById("scan-status-bar"),Jn=document.getElementById("time-running"),eo=document.getElementById("current-combo"),to=document.getElementById("combo-progress"),bs=document.getElementById("progress-fill"),Bs=document.getElementById("progress-text"),so=document.getElementById("networks-count"),Rs=document.getElementById("found-networks"),Ss=document.getElementById("packet-list"),Ts=document.getElementById("custom-config"),Rt=document.getElementById("custom-freq-from"),St=document.getElementById("custom-freq-to"),Tt=document.getElementById("custom-freq-step"),Ps=document.getElementById("custom-bandwidths"),vs=document.getElementById("custom-sfs"),As=document.getElementById("custom-combo-count");let n=document.getElementById("serial-not-supported");navigator.serial||(n.style.display="block",qe.disabled=!0),qe.addEventListener("click",wr),et.addEventListener("click",Cr),ge.addEventListener("click",()=>{He?Os():yr()}),document.querySelectorAll(".scan-type-option input").forEach(t=>{t.addEventListener("change",s=>{ie=s.target.value,zn()})}),Le.addEventListener("input",()=>{_s()}),[Rt,St,Tt,Ps,vs].forEach(t=>{t&&t.addEventListener("input",()=>{Wn(),ie==="custom"&&(Bt.innerHTML=no())})}),zn(),oo(),ro()});})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=network-finder-bundle.js.map
