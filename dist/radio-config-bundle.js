"use strict";(()=>{var Kn=Object.defineProperty;var ao=(s,e,t)=>e in s?Kn(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var se=(s,e)=>()=>(s&&(e=s(s=0)),e);var co=(s,e)=>{for(var t in e)Kn(s,t,{get:e[t],enumerable:!0})};var P=(s,e,t)=>ao(s,typeof e!="symbol"?e+"":e,t);var be,$n=se(()=>{be=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});function le(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Zt(s){if(!Number.isSafeInteger(s)||s<0)throw new Error("positive integer expected, got "+s)}function V(s,...e){if(!le(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function Wt(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function Wn(s,e){V(s);let t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function qe(...s){for(let e=0;e<s.length;e++)s[e].fill(0)}function dt(s){return new DataView(s.buffer,s.byteOffset,s.byteLength)}function Se(s){if(V(s),Xn)return s.toHex();let e="";for(let t=0;t<s.length;t++)e+=fo[s[t]];return e}function Zn(s){if(s>=ue._0&&s<=ue._9)return s-ue._0;if(s>=ue.A&&s<=ue.F)return s-(ue.A-10);if(s>=ue.a&&s<=ue.f)return s-(ue.a-10)}function ft(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);if(Xn)return Uint8Array.fromHex(s);let e=s.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(t);for(let o=0,r=0;o<t;o++,r+=2){let a=Zn(s.charCodeAt(r)),d=Zn(s.charCodeAt(r+1));if(a===void 0||d===void 0){let c=s[r]+s[r+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+r)}n[o]=a*16+d}return n}function he(s){if(typeof s!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(s))}function Xt(s){return typeof s=="string"&&(s=he(s)),V(s),s}function ee(...s){let e=0;for(let n=0;n<s.length;n++){let o=s[n];V(o),e+=o.length}let t=new Uint8Array(e);for(let n=0,o=0;n<s.length;n++){let r=s[n];t.set(r,o),o+=r.length}return t}function zn(s){let e=n=>s().update(Xt(n)).digest(),t=s();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>s(),e}function Ye(s=32){if(be&&typeof be.getRandomValues=="function")return be.getRandomValues(new Uint8Array(s));if(be&&typeof be.randomBytes=="function")return Uint8Array.from(be.randomBytes(s));throw new Error("crypto.getRandomValues must be defined")}var Xn,fo,ue,ct,_e=se(()=>{$n();Xn=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",fo=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));ue={_0:48,_9:57,A:65,F:70,a:97,f:102};ct=class{}});function uo(s,e,t,n){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,n);let o=BigInt(32),r=BigInt(4294967295),a=Number(t>>o&r),d=Number(t&r),c=n?4:0,u=n?0:4;s.setUint32(e+c,a,n),s.setUint32(e+u,d,n)}var ut,W,Qn=se(()=>{_e();ut=class extends ct{constructor(e,t,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=dt(this.buffer)}update(e){Wt(this),e=Xt(e),V(e);let{view:t,buffer:n,blockLen:o}=this,r=e.length;for(let a=0;a<r;){let d=Math.min(o-this.pos,r-a);if(d===o){let c=dt(e);for(;o<=r-a;a+=o)this.process(c,a);continue}n.set(e.subarray(a,a+d),this.pos),this.pos+=d,a+=d,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Wt(this),Wn(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:r}=this,{pos:a}=this;t[a++]=128,qe(this.buffer.subarray(a)),this.padOffset>o-a&&(this.process(n,0),a=0);for(let h=a;h<o;h++)t[h]=0;uo(n,o-8,BigInt(this.length*8),r),this.process(n,0);let d=dt(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)d.setUint32(4*h,l[h],r)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:r,destroyed:a,pos:d}=this;return e.destroyed=a,e.finished=r,e.length=o,e.pos=d,o%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}},W=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209])});function lo(s,e=!1){return e?{h:Number(s&lt),l:Number(s>>jn&lt)}:{h:Number(s>>jn&lt)|0,l:Number(s&lt)|0}}function Jn(s,e=!1){let t=s.length,n=new Uint32Array(t),o=new Uint32Array(t);for(let r=0;r<t;r++){let{h:a,l:d}=lo(s[r],e);[n[r],o[r]]=[a,d]}return[n,o]}function de(s,e,t,n){let o=(e>>>0)+(n>>>0);return{h:s+t+(o/2**32|0)|0,l:o|0}}var lt,jn,zt,Qt,Te,ve,Ve,Ke,es,ts,ns,ss,os,rs,is=se(()=>{lt=BigInt(4294967295),jn=BigInt(32);zt=(s,e,t)=>s>>>t,Qt=(s,e,t)=>s<<32-t|e>>>t,Te=(s,e,t)=>s>>>t|e<<32-t,ve=(s,e,t)=>s<<32-t|e>>>t,Ve=(s,e,t)=>s<<64-t|e>>>t-32,Ke=(s,e,t)=>s>>>t-32|e<<64-t;es=(s,e,t)=>(s>>>0)+(e>>>0)+(t>>>0),ts=(s,e,t,n)=>e+t+n+(s/2**32|0)|0,ns=(s,e,t,n)=>(s>>>0)+(e>>>0)+(t>>>0)+(n>>>0),ss=(s,e,t,n,o)=>e+t+n+o+(s/2**32|0)|0,os=(s,e,t,n,o)=>(s>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(o>>>0),rs=(s,e,t,n,o,r)=>e+t+n+o+r+(s/2**32|0)|0});var as,mo,po,Ee,Ce,jt,Me,cs=se(()=>{Qn();is();_e();as=Jn(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))),mo=as[0],po=as[1],Ee=new Uint32Array(80),Ce=new Uint32Array(80),jt=class extends ut{constructor(e=64){super(128,e,16,!1),this.Ah=W[0]|0,this.Al=W[1]|0,this.Bh=W[2]|0,this.Bl=W[3]|0,this.Ch=W[4]|0,this.Cl=W[5]|0,this.Dh=W[6]|0,this.Dl=W[7]|0,this.Eh=W[8]|0,this.El=W[9]|0,this.Fh=W[10]|0,this.Fl=W[11]|0,this.Gh=W[12]|0,this.Gl=W[13]|0,this.Hh=W[14]|0,this.Hl=W[15]|0}get(){let{Ah:e,Al:t,Bh:n,Bl:o,Ch:r,Cl:a,Dh:d,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:m,Gl:p,Hh:B,Hl:C}=this;return[e,t,n,o,r,a,d,c,u,l,h,f,m,p,B,C]}set(e,t,n,o,r,a,d,c,u,l,h,f,m,p,B,C){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=o|0,this.Ch=r|0,this.Cl=a|0,this.Dh=d|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=m|0,this.Gl=p|0,this.Hh=B|0,this.Hl=C|0}process(e,t){for(let g=0;g<16;g++,t+=4)Ee[g]=e.getUint32(t),Ce[g]=e.getUint32(t+=4);for(let g=16;g<80;g++){let L=Ee[g-15]|0,M=Ce[g-15]|0,O=Te(L,M,1)^Te(L,M,8)^zt(L,M,7),H=ve(L,M,1)^ve(L,M,8)^Qt(L,M,7),D=Ee[g-2]|0,x=Ce[g-2]|0,b=Te(D,x,19)^Ve(D,x,61)^zt(D,x,6),_=ve(D,x,19)^Ke(D,x,61)^Qt(D,x,6),U=ns(H,_,Ce[g-7],Ce[g-16]),S=ss(U,O,b,Ee[g-7],Ee[g-16]);Ee[g]=S|0,Ce[g]=U|0}let{Ah:n,Al:o,Bh:r,Bl:a,Ch:d,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:m,Fl:p,Gh:B,Gl:C,Hh:y,Hl:R}=this;for(let g=0;g<80;g++){let L=Te(h,f,14)^Te(h,f,18)^Ve(h,f,41),M=ve(h,f,14)^ve(h,f,18)^Ke(h,f,41),O=h&m^~h&B,H=f&p^~f&C,D=os(R,M,H,po[g],Ce[g]),x=rs(D,y,L,O,mo[g],Ee[g]),b=D|0,_=Te(n,o,28)^Ve(n,o,34)^Ve(n,o,39),U=ve(n,o,28)^Ke(n,o,34)^Ke(n,o,39),S=n&r^n&d^r&d,v=o&a^o&c^a&c;y=B|0,R=C|0,B=m|0,C=p|0,m=h|0,p=f|0,{h,l:f}=de(u|0,l|0,x|0,b|0),u=d|0,l=c|0,d=r|0,c=a|0,r=n|0,a=o|0;let N=es(b,U,v);n=ts(N,x,_,S),o=N|0}({h:n,l:o}=de(this.Ah|0,this.Al|0,n|0,o|0)),{h:r,l:a}=de(this.Bh|0,this.Bl|0,r|0,a|0),{h:d,l:c}=de(this.Ch|0,this.Cl|0,d|0,c|0),{h:u,l}=de(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=de(this.Eh|0,this.El|0,h|0,f|0),{h:m,l:p}=de(this.Fh|0,this.Fl|0,m|0,p|0),{h:B,l:C}=de(this.Gh|0,this.Gl|0,B|0,C|0),{h:y,l:R}=de(this.Hh|0,this.Hl|0,y|0,R|0),this.set(n,o,r,a,d,c,u,l,h,f,m,p,B,C,y,R)}roundClean(){qe(Ee,Ce)}destroy(){qe(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Me=zn(()=>new jt)});function ht(s,e=""){if(typeof s!="boolean"){let t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof s)}return s}function Ge(s,e,t=""){let n=le(s),o=s?.length,r=e!==void 0;if(!n||r&&o!==e){let a=t&&`"${t}" `,d=r?` of length ${e}`:"",c=n?`length=${o}`:`type=${typeof s}`;throw new Error(a+"expected Uint8Array"+d+", got "+c)}return s}function ds(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?tn:BigInt("0x"+s)}function mt(s){return ds(Se(s))}function oe(s){return V(s),ds(Se(Uint8Array.from(s).reverse()))}function nn(s,e){return ft(s.toString(16).padStart(e*2,"0"))}function pt(s,e){return nn(s,e).reverse()}function K(s,e,t){let n;if(typeof e=="string")try{n=ft(e)}catch(r){throw new Error(s+" must be hex string or Uint8Array, cause: "+r)}else if(le(e))n=Uint8Array.from(e);else throw new Error(s+" must be hex string or Uint8Array");let o=n.length;if(typeof t=="number"&&o!==t)throw new Error(s+" of length "+t+" expected, got "+o);return n}function fs(s,e){if(s.length!==e.length)return!1;let t=0;for(let n=0;n<s.length;n++)t|=s[n]^e[n];return t===0}function sn(s){return Uint8Array.from(s)}function yo(s,e,t){return Jt(s)&&Jt(e)&&Jt(t)&&e<=s&&s<t}function De(s,e,t,n){if(!yo(e,t,n))throw new Error("expected valid "+s+": "+t+" <= n < "+n+", got "+e)}function us(s){let e;for(e=0;s>tn;s>>=en,e+=1);return e}function ls(s){return typeof s=="function"&&Number.isSafeInteger(s.outputLen)}function me(s,e,t={}){if(!s||typeof s!="object")throw new Error("expected valid options object");function n(o,r,a){let d=s[o];if(a&&d===void 0)return;let c=typeof d;if(c!==r||d===null)throw new Error(`param "${o}" is invalid: expected ${r}, got ${c}`)}Object.entries(e).forEach(([o,r])=>n(o,r,!1)),Object.entries(t).forEach(([o,r])=>n(o,r,!0))}function rn(s){let e=new WeakMap;return(t,...n)=>{let o=e.get(t);if(o!==void 0)return o;let r=s(t,...n);return e.set(t,r),r}}var tn,en,Jt,$e,on,Pe=se(()=>{_e();_e();tn=BigInt(0),en=BigInt(1);Jt=s=>typeof s=="bigint"&&tn<=s;$e=s=>(en<<BigInt(s))-en;on=()=>{throw new Error("not implemented")}});function k(s,e){let t=s%e;return t>=j?t:e+t}function re(s,e,t){let n=s;for(;e-- >j;)n*=n,n%=t;return n}function hs(s,e){if(s===j)throw new Error("invert: expected non-zero number");if(e<=j)throw new Error("invert: expected positive modulus, got "+e);let t=k(s,e),n=e,o=j,r=Q,a=Q,d=j;for(;t!==j;){let u=n/t,l=n%t,h=o-a*u,f=r-d*u;n=t,t=l,o=a,r=d,a=h,d=f}if(n!==Q)throw new Error("invert: does not exist");return k(o,e)}function an(s,e,t){if(!s.eql(s.sqr(e),t))throw new Error("Cannot find square root")}function Cs(s,e){let t=(s.ORDER+Q)/ys,n=s.pow(e,t);return an(s,n,e),n}function Eo(s,e){let t=(s.ORDER-ws)/gs,n=s.mul(e,Ie),o=s.pow(n,t),r=s.mul(e,o),a=s.mul(s.mul(r,Ie),o),d=s.mul(r,s.sub(a,s.ONE));return an(s,d,e),d}function Co(s){let e=ye(s),t=xs(s),n=t(e,e.neg(e.ONE)),o=t(e,n),r=t(e,e.neg(n)),a=(s+wo)/Es;return(d,c)=>{let u=d.pow(c,a),l=d.mul(u,n),h=d.mul(u,o),f=d.mul(u,r),m=d.eql(d.sqr(l),c),p=d.eql(d.sqr(h),c);u=d.cmov(u,l,m),l=d.cmov(f,h,p);let B=d.eql(d.sqr(l),c),C=d.cmov(u,l,B);return an(d,C,c),C}}function xs(s){if(s<ps)throw new Error("sqrt is not defined for small field");let e=s-Q,t=0;for(;e%Ie===j;)e/=Ie,t++;let n=Ie,o=ye(s);for(;ms(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return Cs;let r=o.pow(n,e),a=(e+Q)/Ie;return function(c,u){if(c.is0(u))return u;if(ms(c,u)!==1)throw new Error("Cannot find square root");let l=t,h=c.mul(c.ONE,r),f=c.pow(u,e),m=c.pow(u,a);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let p=1,B=c.sqr(f);for(;!c.eql(B,c.ONE);)if(p++,B=c.sqr(B),p===l)throw new Error("Cannot find square root");let C=Q<<BigInt(l-p-1),y=c.pow(h,C);l=p,h=c.sqr(y),f=c.mul(f,h),m=c.mul(m,y)}return m}}function xo(s){return s%ys===ps?Cs:s%gs===ws?Eo:s%Es===go?Co(s):xs(s)}function Bs(s){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=Bo.reduce((n,o)=>(n[o]="function",n),e);return me(s,t),s}function Ro(s,e,t){if(t<j)throw new Error("invalid exponent, negatives unsupported");if(t===j)return s.ONE;if(t===Q)return e;let n=s.ONE,o=e;for(;t>j;)t&Q&&(n=s.mul(n,o)),o=s.sqr(o),t>>=Q;return n}function Oe(s,e,t=!1){let n=new Array(e.length).fill(t?s.ZERO:void 0),o=e.reduce((a,d,c)=>s.is0(d)?a:(n[c]=a,s.mul(a,d)),s.ONE),r=s.inv(o);return e.reduceRight((a,d,c)=>s.is0(d)?a:(n[c]=s.mul(a,n[c]),s.mul(a,d)),r),n}function ms(s,e){let t=(s.ORDER-Q)/Ie,n=s.pow(e,t),o=s.eql(n,s.ONE),r=s.eql(n,s.ZERO),a=s.eql(n,s.neg(s.ONE));if(!o&&!r&&!a)throw new Error("invalid Legendre symbol result");return o?1:r?0:-1}function Rs(s,e){e!==void 0&&Zt(e);let t=e!==void 0?e:s.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function ye(s,e,t=!1,n={}){if(s<=j)throw new Error("invalid field: expected ORDER > 0, got "+s);let o,r,a=!1,d;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(o=f.BITS),f.sqrt&&(r=f.sqrt),typeof f.isLE=="boolean"&&(t=f.isLE),typeof f.modFromBytes=="boolean"&&(a=f.modFromBytes),d=f.allowedLengths}else typeof e=="number"&&(o=e),n.sqrt&&(r=n.sqrt);let{nBitLength:c,nByteLength:u}=Rs(s,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l,h=Object.freeze({ORDER:s,isLE:t,BITS:c,BYTES:u,MASK:$e(c),ZERO:j,ONE:Q,allowedLengths:d,create:f=>k(f,s),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return j<=f&&f<s},is0:f=>f===j,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Q)===Q,neg:f=>k(-f,s),eql:(f,m)=>f===m,sqr:f=>k(f*f,s),add:(f,m)=>k(f+m,s),sub:(f,m)=>k(f-m,s),mul:(f,m)=>k(f*m,s),pow:(f,m)=>Ro(h,f,m),div:(f,m)=>k(f*hs(m,s),s),sqrN:f=>f*f,addN:(f,m)=>f+m,subN:(f,m)=>f-m,mulN:(f,m)=>f*m,inv:f=>hs(f,s),sqrt:r||(f=>(l||(l=xo(s)),l(h,f))),toBytes:f=>t?pt(f,u):nn(f,u),fromBytes:(f,m=!0)=>{if(d){if(!d.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+d+" bytes, got "+f.length);let B=new Uint8Array(u);B.set(f,t?0:B.length-f.length),f=B}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let p=t?oe(f):mt(f);if(a&&(p=k(p,s)),!m&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>Oe(h,f),cmov:(f,m,p)=>p?m:f});return Object.freeze(h)}function bs(s,e){if(!s.isOdd)throw new Error("Field doesn't have isOdd");let t=s.sqrt(e);return s.isOdd(t)?s.neg(t):t}var j,Q,Ie,ps,ys,ws,wo,gs,go,Es,pe,Bo,Ue=se(()=>{Pe();j=BigInt(0),Q=BigInt(1),Ie=BigInt(2),ps=BigInt(3),ys=BigInt(4),ws=BigInt(5),wo=BigInt(7),gs=BigInt(8),go=BigInt(9),Es=BigInt(16);pe=(s,e)=>(k(s,e)&Q)===Q,Bo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"]});function Ss(s,e){let t=e.negate();return s?t:e}function Ze(s,e){let t=Oe(s.Fp,e.map(n=>n.Z));return e.map((n,o)=>s.fromAffine(n.toAffine(t[o])))}function Is(s,e){if(!Number.isSafeInteger(s)||s<=0||s>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+s)}function cn(s,e){Is(s,e);let t=Math.ceil(e/s)+1,n=2**(s-1),o=2**s,r=$e(s),a=BigInt(s);return{windows:t,windowSize:n,mask:r,maxNumber:o,shiftBy:a}}function Ts(s,e,t){let{windowSize:n,mask:o,maxNumber:r,shiftBy:a}=t,d=Number(s&o),c=s>>a;d>n&&(d-=r,c+=un);let u=e*n,l=u+Math.abs(d)-1,h=d===0,f=d<0,m=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:m,offsetF:u}}function bo(s,e){if(!Array.isArray(s))throw new Error("array expected");s.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function So(s,e){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}function fn(s){return Ls.get(s)||1}function vs(s){if(s!==yt)throw new Error("invalid wNAF")}function gt(s,e,t,n){bo(t,s),So(n,e);let o=t.length,r=n.length;if(o!==r)throw new Error("arrays of points and scalars must have equal length");let a=s.ZERO,d=us(BigInt(o)),c=1;d>12?c=d-3:d>4?c=d-2:d>0&&(c=2);let u=$e(c),l=new Array(Number(u)+1).fill(a),h=Math.floor((e.BITS-1)/c)*c,f=a;for(let m=h;m>=0;m-=c){l.fill(a);for(let B=0;B<r;B++){let C=n[B],y=Number(C>>BigInt(m)&u);l[y]=l[y].add(t[B])}let p=a;for(let B=l.length-1,C=a;B>0;B--)C=C.add(l[B]),p=p.add(C);if(f=f.add(p),m!==0)for(let B=0;B<c;B++)f=f.double()}return f}function Ps(s,e,t){if(e){if(e.ORDER!==s)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Bs(e),e}else return ye(s,{isLE:t})}function As(s,e,t={},n){if(n===void 0&&(n=s==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${s} CURVE object`);for(let c of["p","n","h"]){let u=e[c];if(!(typeof u=="bigint"&&u>yt))throw new Error(`CURVE.${c} must be positive bigint`)}let o=Ps(e.p,t.Fp,n),r=Ps(e.n,t.Fn,n),d=["Gx","Gy","a",s==="weierstrass"?"b":"d"];for(let c of d)if(!o.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:r}}var yt,un,dn,Ls,wt,ln=se(()=>{Pe();Ue();yt=BigInt(0),un=BigInt(1);dn=new WeakMap,Ls=new WeakMap;wt=class{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,n=this.ZERO){let o=e;for(;t>yt;)t&un&&(n=n.add(o)),o=o.double(),t>>=un;return n}precomputeWindow(e,t){let{windows:n,windowSize:o}=cn(t,this.bits),r=[],a=e,d=a;for(let c=0;c<n;c++){d=a,r.push(d);for(let u=1;u<o;u++)d=d.add(a),r.push(d);a=d.double()}return r}wNAF(e,t,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,r=this.BASE,a=cn(e,this.bits);for(let d=0;d<a.windows;d++){let{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:f,offsetF:m}=Ts(n,d,a);n=c,l?r=r.add(Ss(f,t[m])):o=o.add(Ss(h,t[u]))}return vs(n),{p:o,f:r}}wNAFUnsafe(e,t,n,o=this.ZERO){let r=cn(e,this.bits);for(let a=0;a<r.windows&&n!==yt;a++){let{nextN:d,offset:c,isZero:u,isNeg:l}=Ts(n,a,r);if(n=d,!u){let h=t[c];o=o.add(l?h.negate():h)}}return vs(n),o}getPrecomputes(e,t,n){let o=dn.get(t);return o||(o=this.precomputeWindow(t,e),e!==1&&(typeof n=="function"&&(o=n(o)),dn.set(t,o))),o}cached(e,t,n){let o=fn(e);return this.wNAF(o,this.getPrecomputes(o,e,n),t)}unsafe(e,t,n,o){let r=fn(e);return r===1?this._unsafeLadder(e,t,o):this.wNAFUnsafe(r,this.getPrecomputes(r,e,n),t,o)}createCache(e,t){Is(t,this.bits),Ls.set(e,t),dn.delete(e)}hasCache(e){return fn(e)!==1}}});function vo(s,e,t,n){let o=s.sqr(t),r=s.sqr(n),a=s.add(s.mul(e.a,o),r),d=s.add(s.ONE,s.mul(e.d,s.mul(o,r)));return s.eql(a,d)}function Po(s,e={}){let t=As("edwards",s,e,e.FpFnLE),{Fp:n,Fn:o}=t,r=t.CURVE,{h:a}=r;me(e,{},{uvRatio:"function"});let d=hn<<BigInt(o.BYTES*8)-G,c=C=>n.create(C),u=e.uvRatio||((C,y)=>{try{return{isValid:!0,value:n.sqrt(n.div(C,y))}}catch{return{isValid:!1,value:xe}}});if(!vo(n,r,r.Gx,r.Gy))throw new Error("bad curve params: generator point");function l(C,y,R=!1){let g=R?G:xe;return De("coordinate "+C,y,g,d),y}function h(C){if(!(C instanceof p))throw new Error("ExtendedPoint expected")}let f=rn((C,y)=>{let{X:R,Y:g,Z:L}=C,M=C.is0();y==null&&(y=M?To:n.inv(L));let O=c(R*y),H=c(g*y),D=n.mul(L,y);if(M)return{x:xe,y:G};if(D!==G)throw new Error("invZ was invalid");return{x:O,y:H}}),m=rn(C=>{let{a:y,d:R}=r;if(C.is0())throw new Error("bad point: ZERO");let{X:g,Y:L,Z:M,T:O}=C,H=c(g*g),D=c(L*L),x=c(M*M),b=c(x*x),_=c(H*y),U=c(x*c(_+D)),S=c(b+c(R*c(H*D)));if(U!==S)throw new Error("bad point: equation left != right (1)");let v=c(g*L),N=c(M*O);if(v!==N)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(y,R,g,L){this.X=l("x",y),this.Y=l("y",R),this.Z=l("z",g,!0),this.T=l("t",L),Object.freeze(this)}static CURVE(){return r}static fromAffine(y){if(y instanceof p)throw new Error("extended point not allowed");let{x:R,y:g}=y||{};return l("x",R),l("y",g),new p(R,g,G,c(R*g))}static fromBytes(y,R=!1){let g=n.BYTES,{a:L,d:M}=r;y=sn(Ge(y,g,"point")),ht(R,"zip215");let O=sn(y),H=y[g-1];O[g-1]=H&-129;let D=oe(O),x=R?d:n.ORDER;De("point.y",D,xe,x);let b=c(D*D),_=c(b-G),U=c(M*b-L),{isValid:S,value:v}=u(_,U);if(!S)throw new Error("bad point: invalid y coordinate");let N=(v&G)===G,Y=(H&128)!==0;if(!R&&v===xe&&Y)throw new Error("bad point: x=0 and x_0=1");return Y!==N&&(v=c(-v)),p.fromAffine({x:v,y:D})}static fromHex(y,R=!1){return p.fromBytes(K("point",y),R)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,R=!0){return B.createCache(this,y),R||this.multiply(hn),this}assertValidity(){m(this)}equals(y){h(y);let{X:R,Y:g,Z:L}=this,{X:M,Y:O,Z:H}=y,D=c(R*H),x=c(M*L),b=c(g*H),_=c(O*L);return D===x&&b===_}is0(){return this.equals(p.ZERO)}negate(){return new p(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:y}=r,{X:R,Y:g,Z:L}=this,M=c(R*R),O=c(g*g),H=c(hn*c(L*L)),D=c(y*M),x=R+g,b=c(c(x*x)-M-O),_=D+O,U=_-H,S=D-O,v=c(b*U),N=c(_*S),Y=c(b*S),$=c(U*_);return new p(v,N,$,Y)}add(y){h(y);let{a:R,d:g}=r,{X:L,Y:M,Z:O,T:H}=this,{X:D,Y:x,Z:b,T:_}=y,U=c(L*D),S=c(M*x),v=c(H*g*_),N=c(O*b),Y=c((L+M)*(D+x)-U-S),$=N-v,z=N+v,Z=c(S-R*U),te=c(Y*$),ie=c(z*Z),Fe=c(Y*Z),Ae=c($*z);return new p(te,ie,Ae,Fe)}subtract(y){return this.add(y.negate())}multiply(y){if(!o.isValidNot0(y))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:R,f:g}=B.cached(this,y,L=>Ze(p,L));return Ze(p,[R,g])[0]}multiplyUnsafe(y,R=p.ZERO){if(!o.isValid(y))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return y===xe?p.ZERO:this.is0()||y===G?this:B.unsafe(this,y,g=>Ze(p,g),R)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return B.unsafe(this,r.n).is0()}toAffine(y){return f(this,y)}clearCofactor(){return a===G?this:this.multiplyUnsafe(a)}toBytes(){let{x:y,y:R}=this.toAffine(),g=n.toBytes(R);return g[g.length-1]|=y&G?128:0,g}toHex(){return Se(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(y){return Ze(p,y)}static msm(y,R){return gt(p,o,y,R)}_setWindowSize(y){this.precompute(y)}toRawBytes(){return this.toBytes()}}p.BASE=new p(r.Gx,r.Gy,G,c(r.Gx*r.Gy)),p.ZERO=new p(xe,G,G,xe),p.Fp=n,p.Fn=o;let B=new wt(p,o.BITS);return p.BASE.precompute(8),p}function Io(s,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');me(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=t,{BASE:o,Fp:r,Fn:a}=s,d=t.randomBytes||Ye,c=t.adjustScalarBytes||(x=>x),u=t.domain||((x,b,_)=>{if(ht(_,"phflag"),b.length||_)throw new Error("Contexts/pre-hash are not supported");return x});function l(x){return a.create(oe(x))}function h(x){let b=g.secretKey;x=K("private key",x,b);let _=K("hashed private key",e(x),2*b),U=c(_.slice(0,b)),S=_.slice(b,2*b),v=l(U);return{head:U,prefix:S,scalar:v}}function f(x){let{head:b,prefix:_,scalar:U}=h(x),S=o.multiply(U),v=S.toBytes();return{head:b,prefix:_,scalar:U,point:S,pointBytes:v}}function m(x){return f(x).pointBytes}function p(x=Uint8Array.of(),...b){let _=ee(...b);return l(e(u(_,K("context",x),!!n)))}function B(x,b,_={}){x=K("message",x),n&&(x=n(x));let{prefix:U,scalar:S,pointBytes:v}=f(b),N=p(_.context,U,x),Y=o.multiply(N).toBytes(),$=p(_.context,Y,v,x),z=a.create(N+$*S);if(!a.isValid(z))throw new Error("sign failed: invalid s");let Z=ee(Y,a.toBytes(z));return Ge(Z,g.signature,"result")}let C={zip215:!0};function y(x,b,_,U=C){let{context:S,zip215:v}=U,N=g.signature;x=K("signature",x,N),b=K("message",b),_=K("publicKey",_,g.publicKey),v!==void 0&&ht(v,"zip215"),n&&(b=n(b));let Y=N/2,$=x.subarray(0,Y),z=oe(x.subarray(Y,N)),Z,te,ie;try{Z=s.fromBytes(_,v),te=s.fromBytes($,v),ie=o.multiplyUnsafe(z)}catch{return!1}if(!v&&Z.isSmallOrder())return!1;let Fe=p(S,te.toBytes(),Z.toBytes(),b);return te.add(Z.multiplyUnsafe(Fe)).subtract(ie).clearCofactor().is0()}let R=r.BYTES,g={secretKey:R,publicKey:R,signature:2*R,seed:R};function L(x=d(g.seed)){return Ge(x,g.seed,"seed")}function M(x){let b=D.randomSecretKey(x);return{secretKey:b,publicKey:m(b)}}function O(x){return le(x)&&x.length===a.BYTES}function H(x,b){try{return!!s.fromBytes(x,b)}catch{return!1}}let D={getExtendedPublicKey:f,randomSecretKey:L,isValidSecretKey:O,isValidPublicKey:H,toMontgomery(x){let{y:b}=s.fromBytes(x),_=g.publicKey,U=_===32;if(!U&&_!==57)throw new Error("only defined for 25519 and 448");let S=U?r.div(G+b,G-b):r.div(b-G,b+G);return r.toBytes(S)},toMontgomerySecret(x){let b=g.secretKey;Ge(x,b);let _=e(x.subarray(0,b));return c(_).subarray(0,b)},randomPrivateKey:L,precompute(x=8,b=s.BASE){return b.precompute(x,!1)}};return Object.freeze({keygen:M,getPublicKey:m,sign:B,verify:y,utils:D,Point:s,lengths:g})}function Lo(s){let e={a:s.a,d:s.d,p:s.Fp.ORDER,n:s.n,h:s.h,Gx:s.Gx,Gy:s.Gy},t=s.Fp,n=ye(e.n,s.nBitLength,!0),o={Fp:t,Fn:n,uvRatio:s.uvRatio},r={randomBytes:s.randomBytes,adjustScalarBytes:s.adjustScalarBytes,domain:s.domain,prehash:s.prehash,mapToCurve:s.mapToCurve};return{CURVE:e,curveOpts:o,hash:s.hash,eddsaOpts:r}}function Ao(s,e){let t=e.Point;return Object.assign({},e,{ExtendedPoint:t,CURVE:s,nBitLength:t.Fn.BITS,nByteLength:t.Fn.BYTES})}function Ct(s){let{CURVE:e,curveOpts:t,hash:n,eddsaOpts:o}=Lo(s),r=Po(e,t),a=Io(r,n,o);return Ao(s,a)}var xe,G,hn,To,Et,_s=se(()=>{Pe();ln();Ue();xe=BigInt(0),G=BigInt(1),hn=BigInt(2),To=BigInt(8);Et=class{constructor(e){this.ep=e}static fromBytes(e){on()}static fromHex(e){on()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(e){return this.ep.toAffine(e)}toHex(){return Se(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(e){return this.assertSame(e),this.init(this.ep.add(e.ep))}subtract(e){return this.assertSame(e),this.init(this.ep.subtract(e.ep))}multiply(e){return this.init(this.ep.multiply(e))}multiplyUnsafe(e){return this.init(this.ep.multiplyUnsafe(e))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(e,t){return this.init(this.ep.precompute(e,t))}toRawBytes(){return this.toBytes()}}});function Be(s,e){if(We(s),We(e),s<0||s>=1<<8*e)throw new Error("invalid I2OSP input: "+s);let t=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)t[n]=s&255,s>>>=8;return new Uint8Array(t)}function Mo(s,e){let t=new Uint8Array(s.length);for(let n=0;n<s.length;n++)t[n]=s[n]^e[n];return t}function We(s){if(!Number.isSafeInteger(s))throw new Error("number expected")}function Ms(s){if(!le(s)&&typeof s!="string")throw new Error("DST must be Uint8Array or string");return typeof s=="string"?he(s):s}function xt(s,e,t,n){V(s),We(t),e=Ms(e),e.length>255&&(e=n(ee(he("H2C-OVERSIZE-DST-"),e)));let{outputLen:o,blockLen:r}=n,a=Math.ceil(t/o);if(t>65535||a>255)throw new Error("expand_message_xmd: invalid lenInBytes");let d=ee(e,Be(e.length,1)),c=Be(0,r),u=Be(t,2),l=new Array(a),h=n(ee(c,s,u,Be(0,1),d));l[0]=n(ee(h,Be(1,1),d));for(let m=1;m<=a;m++){let p=[Mo(h,l[m-1]),Be(m+1,1),d];l[m]=n(ee(...p))}return ee(...l).slice(0,t)}function Do(s,e,t,n,o){if(V(s),We(t),e=Ms(e),e.length>255){let r=Math.ceil(2*n/8);e=o.create({dkLen:r}).update(he("H2C-OVERSIZE-DST-")).update(e).digest()}if(t>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return o.create({dkLen:t}).update(s).update(Be(t,2)).update(e).update(Be(e.length,1)).digest()}function mn(s,e,t){me(t,{p:"bigint",m:"number",k:"number",hash:"function"});let{p:n,k:o,m:r,hash:a,expand:d,DST:c}=t;if(!ls(t.hash))throw new Error("expected valid hash");V(s),We(e);let u=n.toString(2).length,l=Math.ceil((u+o)/8),h=e*r*l,f;if(d==="xmd")f=xt(s,c,h,a);else if(d==="xof")f=Do(s,c,h,o,a);else if(d==="_internal_pass")f=s;else throw new Error('expand must be "xmd" or "xof"');let m=new Array(e);for(let p=0;p<e;p++){let B=new Array(r);for(let C=0;C<r;C++){let y=l*(C+p*r),R=f.subarray(y,y+l);B[C]=k(_o(R),n)}m[p]=B}return m}function Ds(s,e,t){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function n(r){return s.fromAffine(e(r))}function o(r){let a=r.clearCofactor();return a.equals(s.ZERO)?s.ZERO:(a.assertValidity(),a)}return{defaults:t,hashToCurve(r,a){let d=Object.assign({},t,a),c=mn(r,2,d),u=n(c[0]),l=n(c[1]);return o(u.add(l))},encodeToCurve(r,a){let d=t.encodeDST?{DST:t.encodeDST}:{},c=Object.assign({},t,d,a),u=mn(r,1,c),l=n(u[0]);return o(l)},mapToCurve(r){if(!Array.isArray(r))throw new Error("expected array of bigints");for(let a of r)if(typeof a!="bigint")throw new Error("expected array of bigints");return o(n(r))},hashToScalar(r,a){let d=s.Fn.ORDER,c=Object.assign({},t,{p:d,m:1,DST:pn},a);return mn(r,1,c)[0][0]}}}var _o,pn,Os=se(()=>{Pe();Ue();_o=mt;pn=he("HashToScalar-")});function Oo(s){return me(s,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...s})}function Us(s){let e=Oo(s),{P:t,type:n,adjustScalarBytes:o,powPminus2:r,randomBytes:a}=e,d=n==="x25519";if(!d&&n!=="x448")throw new Error("invalid type");let c=a||Ye,u=d?255:448,l=d?32:56,h=BigInt(d?9:5),f=BigInt(d?121665:39081),m=d?Bt**BigInt(254):Bt**BigInt(447),p=d?BigInt(8)*Bt**BigInt(251)-Ne:BigInt(4)*Bt**BigInt(445)-Ne,B=m+p+Ne,C=S=>k(S,t),y=R(h);function R(S){return pt(C(S),l)}function g(S){let v=K("u coordinate",S,l);return d&&(v[31]&=127),C(oe(v))}function L(S){return oe(o(K("scalar",S,l)))}function M(S,v){let N=D(g(v),L(S));if(N===Xe)throw new Error("invalid private or public key received");return R(N)}function O(S){return M(S,y)}function H(S,v,N){let Y=C(S*(v-N));return v=C(v-Y),N=C(N+Y),{x_2:v,x_3:N}}function D(S,v){De("u",S,Xe,t),De("scalar",v,m,B);let N=v,Y=S,$=Ne,z=Xe,Z=S,te=Ne,ie=Xe;for(let Ae=BigInt(u-1);Ae>=Xe;Ae--){let kt=N>>Ae&Ne;ie^=kt,{x_2:$,x_3:Z}=H(ie,$,Z),{x_2:z,x_3:te}=H(ie,z,te),ie=kt;let Ft=$+z,qt=C(Ft*Ft),Yt=$-z,Hn=C(Yt*Yt),kn=qt-Hn,ro=Z+te,io=Z-te,Fn=C(io*Ft),qn=C(ro*Yt),Yn=Fn+qn,Vn=Fn-qn;Z=C(Yn*Yn),te=C(Y*C(Vn*Vn)),$=C(qt*Hn),z=C(kn*(qt+C(f*kn)))}({x_2:$,x_3:Z}=H(ie,$,Z)),{x_2:z,x_3:te}=H(ie,z,te);let Fe=r(z);return C($*Fe)}let x={secretKey:l,publicKey:l,seed:l},b=(S=c(l))=>(V(S,x.seed),S);function _(S){let v=b(S);return{secretKey:v,publicKey:O(v)}}return{keygen:_,getSharedSecret:(S,v)=>M(S,v),getPublicKey:S=>O(S),scalarMult:M,scalarMultBase:O,utils:{randomSecretKey:b,randomPrivateKey:b},GuBytes:y.slice(),lengths:x}}var Xe,Ne,Bt,Ns=se(()=>{Pe();Ue();Xe=BigInt(0),Ne=BigInt(1),Bt=BigInt(2)});var Xs={};co(Xs,{ED25519_TORSION_SUBGROUP:()=>Qo,RistrettoPoint:()=>er,ed25519:()=>ae,ed25519_hasher:()=>Bn,ed25519ctx:()=>No,ed25519ph:()=>Ho,edwardsToMontgomery:()=>jo,edwardsToMontgomeryPriv:()=>Jo,edwardsToMontgomeryPub:()=>Ws,encodeToCurve:()=>nr,hashToCurve:()=>tr,hashToRistretto255:()=>sr,hash_to_ristretto255:()=>or,ristretto255:()=>zo,ristretto255_hasher:()=>Rn,x25519:()=>ko});function Vs(s){let e=BigInt(10),t=BigInt(20),n=BigInt(40),o=BigInt(80),r=we,d=s*s%r*s%r,c=re(d,Rt,r)*d%r,u=re(c,fe,r)*s%r,l=re(u,Ys,r)*u%r,h=re(l,e,r)*l%r,f=re(h,t,r)*h%r,m=re(f,n,r)*f%r,p=re(m,o,r)*m%r,B=re(p,o,r)*m%r,C=re(B,e,r)*l%r;return{pow_p_5_8:re(C,Rt,r)*s%r,b2:d}}function Ks(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}function Cn(s,e){let t=we,n=k(e*e*e,t),o=k(n*n*e,t),r=Vs(s*o).pow_p_5_8,a=k(s*n*r,t),d=k(e*a*a,t),c=a,u=k(a*yn,t),l=d===s,h=d===k(-s,t),f=d===k(-s*yn,t);return l&&(a=c),(h||f)&&(a=u),pe(a,t)&&(a=k(-a,t)),{isValid:l||h,value:a}}function $s(s,e,t){if(e.length>255)throw new Error("Context is too big");return ee(he("SigEd25519 no Ed25519 collisions"),new Uint8Array([t?1:0,e.length]),e,s)}function Yo(s){let e=(we-Ys)/En,t=BigInt(486662),n=E.sqr(s);n=E.mul(n,Rt);let o=E.add(n,E.ONE),r=E.neg(t),a=E.sqr(o),d=E.mul(a,o),c=E.mul(n,t);c=E.mul(c,r),c=E.add(c,a),c=E.mul(c,r);let u=E.sqr(d);a=E.sqr(u),u=E.mul(u,d),u=E.mul(u,c),a=E.mul(a,u);let l=E.pow(a,e);l=E.mul(l,u);let h=E.mul(l,Hs);a=E.sqr(l),a=E.mul(a,d);let f=E.eql(a,c),m=E.cmov(h,l,f),p=E.mul(r,n),B=E.mul(l,s);B=E.mul(B,qo);let C=E.mul(B,Hs),y=E.mul(c,n);a=E.sqr(B),a=E.mul(a,d);let R=E.eql(a,y),g=E.cmov(C,B,R);a=E.sqr(m),a=E.mul(a,d);let L=E.eql(a,c),M=E.cmov(p,r,L),O=E.cmov(g,m,L),H=E.isOdd(O);return O=E.cmov(O,E.neg(O),L!==H),{xMn:M,xMd:o,yMn:O,yMd:fe}}function Ko(s){let{xMn:e,xMd:t,yMn:n,yMd:o}=Yo(s),r=E.mul(e,o);r=E.mul(r,Vo);let a=E.mul(t,n),d=E.sub(e,t),c=E.add(e,t),u=E.mul(a,c),l=E.eql(u,E.ZERO);r=E.cmov(r,E.ZERO,l),a=E.cmov(a,E.ONE,l),d=E.cmov(d,E.ONE,l),c=E.cmov(c,E.ONE,l);let[h,f]=Oe(E,[a,c],!0);return{x:E.mul(r,h),y:E.mul(d,f)}}function Fs(s){let{d:e}=ze,t=we,n=y=>E.create(y),o=n(wn*s*s),r=n((o+fe)*Zo),a=BigInt(-1),d=n((a-e*o)*n(o+e)),{isValid:c,value:u}=Cn(r,d),l=n(u*s);pe(l,t)||(l=n(-l)),c||(u=l),c||(a=o);let h=n(a*(o-fe)*Wo-d),f=u*u,m=n((u+u)*d),p=n(h*Go),B=n(fe-f),C=n(fe+f);return new ae.Point(n(m*C),n(B*p),n(p*C),n(m*B))}function Zs(s){V(s,64);let e=gn(s.subarray(0,32)),t=Fs(e),n=gn(s.subarray(32,64)),o=Fs(n);return new ce(t.add(o))}function Ws(s){return ae.utils.toMontgomery(K("pub",s))}function Jo(s){return ae.utils.toMontgomerySecret(K("pub",s))}var Uo,fe,Rt,qs,Ys,En,we,ze,yn,E,Gs,xn,ae,No,Ho,ko,Fo,qo,Hs,Vo,Bn,wn,Go,$o,Zo,Wo,ks,Xo,gn,ce,zo,Rn,Qo,jo,er,tr,nr,sr,or,zs=se(()=>{cs();_e();ln();_s();Os();Ue();Ns();Pe();Uo=BigInt(0),fe=BigInt(1),Rt=BigInt(2),qs=BigInt(3),Ys=BigInt(5),En=BigInt(8),we=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),ze={p:we,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:En,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};yn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");E=ye(ze.p,{isLE:!0}),Gs=ye(ze.n,{isLE:!0}),xn={...ze,Fp:E,hash:Me,adjustScalarBytes:Ks,uvRatio:Cn},ae=Ct(xn);No=Ct({...xn,domain:$s}),Ho=Ct(Object.assign({},xn,{domain:$s,prehash:Me})),ko=(()=>{let s=E.ORDER;return Us({P:s,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:n}=Vs(e);return k(re(t,qs,s)*n,s)},adjustScalarBytes:Ks})})(),Fo=(we+qs)/En,qo=E.pow(Rt,Fo),Hs=E.sqrt(E.neg(E.ONE));Vo=bs(E,E.neg(BigInt(486664)));Bn=Ds(ae.Point,s=>Ko(s[0]),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:we,m:1,k:128,expand:"xmd",hash:Me}),wn=yn,Go=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),$o=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Zo=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Wo=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),ks=s=>Cn(fe,s),Xo=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),gn=s=>ae.Point.Fp.create(oe(s)&Xo);ce=class s extends Et{constructor(e){super(e)}static fromAffine(e){return new s(ae.Point.fromAffine(e))}assertSame(e){if(!(e instanceof s))throw new Error("RistrettoPoint expected")}init(e){return new s(e)}static hashToCurve(e){return Zs(K("ristrettoHash",e,64))}static fromBytes(e){V(e,32);let{a:t,d:n}=ze,o=we,r=L=>E.create(L),a=gn(e);if(!fs(E.toBytes(a),e)||pe(a,o))throw new Error("invalid ristretto255 encoding 1");let d=r(a*a),c=r(fe+t*d),u=r(fe-t*d),l=r(c*c),h=r(u*u),f=r(t*n*l-h),{isValid:m,value:p}=ks(r(f*h)),B=r(p*u),C=r(p*B*f),y=r((a+a)*B);pe(y,o)&&(y=r(-y));let R=r(c*C),g=r(y*R);if(!m||pe(g,o)||R===Uo)throw new Error("invalid ristretto255 encoding 2");return new s(new ae.Point(y,R,fe,g))}static fromHex(e){return s.fromBytes(K("ristrettoHex",e,32))}static msm(e,t){return gt(s,ae.Point.Fn,e,t)}toBytes(){let{X:e,Y:t,Z:n,T:o}=this.ep,r=we,a=C=>E.create(C),d=a(a(n+t)*a(n-t)),c=a(e*t),u=a(c*c),{value:l}=ks(a(d*u)),h=a(l*d),f=a(l*c),m=a(h*f*o),p;if(pe(o*m,r)){let C=a(t*wn),y=a(e*wn);e=C,t=y,p=a(h*$o)}else p=f;pe(e*m,r)&&(t=a(-t));let B=a((n-t)*p);return pe(B,r)&&(B=a(-B)),E.toBytes(B)}equals(e){this.assertSame(e);let{X:t,Y:n}=this.ep,{X:o,Y:r}=e.ep,a=u=>E.create(u),d=a(t*r)===a(n*o),c=a(n*r)===a(t*o);return d||c}is0(){return this.equals(s.ZERO)}};ce.BASE=new ce(ae.Point.BASE);ce.ZERO=new ce(ae.Point.ZERO);ce.Fp=E;ce.Fn=Gs;zo={Point:ce},Rn={hashToCurve(s,e){let t=e?.DST||"ristretto255_XMD:SHA-512_R255MAP_RO_",n=xt(s,t,64,Me);return Zs(n)},hashToScalar(s,e={DST:pn}){let t=xt(s,e.DST,64,Me);return Gs.create(oe(t))}},Qo=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];jo=Ws;er=ce,tr=Bn.hashToCurve,nr=Bn.encodeToCurve,sr=Rn.hashToCurve,or=Rn.hashToCurve});var Vt=class{constructor(){this.buffer=[]}toBytes(){return new Uint8Array(this.buffer)}writeBytes(e){this.buffer=[...this.buffer,...e]}writeByte(e){this.writeBytes([e])}writeUInt16LE(e){let t=new Uint8Array(2);new DataView(t.buffer).setUint16(0,e,!0),this.writeBytes(t)}writeUInt32LE(e){let t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,e,!0),this.writeBytes(t)}writeInt32LE(e){let t=new Uint8Array(4);new DataView(t.buffer).setInt32(0,e,!0),this.writeBytes(t)}writeString(e){this.writeBytes(new TextEncoder().encode(e))}writeCString(e,t){let n=new Uint8Array(new ArrayBuffer(t)),o=new TextEncoder().encode(e);for(var r=0;r<t&&r<o.length;r++)n[r]=o[r];n[n.length-1]=0,this.writeBytes(n)}},I=Vt;var Kt=class{constructor(e){this.pointer=0,this.buffer=new Uint8Array(e)}getRemainingBytesCount(){return this.buffer.length-this.pointer}readByte(){return this.readBytes(1)[0]}readBytes(e){let t=this.buffer.slice(this.pointer,this.pointer+e);return this.pointer+=e,t}readRemainingBytes(){return this.readBytes(this.getRemainingBytesCount())}readString(){return new TextDecoder().decode(this.readRemainingBytes())}readCString(e){let t=[],n=this.readBytes(e);for(let o of n){if(o===0)return new TextDecoder().decode(new Uint8Array(t));t.push(o)}}readInt8(){let e=this.readBytes(1);return new DataView(e.buffer).getInt8(0)}readUInt8(){let e=this.readBytes(1);return new DataView(e.buffer).getUint8(0)}readUInt16LE(){let e=this.readBytes(2);return new DataView(e.buffer).getUint16(0,!0)}readUInt16BE(){let e=this.readBytes(2);return new DataView(e.buffer).getUint16(0,!1)}readUInt32LE(){let e=this.readBytes(4);return new DataView(e.buffer).getUint32(0,!0)}readUInt32BE(){let e=this.readBytes(4);return new DataView(e.buffer).getUint32(0,!1)}readInt16LE(){let e=this.readBytes(2);return new DataView(e.buffer).getInt16(0,!0)}readInt16BE(){let e=this.readBytes(2);return new DataView(e.buffer).getInt16(0,!1)}readInt32LE(){let e=this.readBytes(4);return new DataView(e.buffer).getInt32(0,!0)}readInt24BE(){var e=this.readByte()<<16|this.readByte()<<8|this.readByte();return e&8388608&&(e-=16777216),e}},q=Kt;var J=class{};P(J,"SupportedCompanionProtocolVersion",1),P(J,"SerialFrameTypes",{Incoming:62,Outgoing:60}),P(J,"Ble",{ServiceUuid:"6E400001-B5A3-F393-E0A9-E50E24DCCA9E",CharacteristicUuidRx:"6E400002-B5A3-F393-E0A9-E50E24DCCA9E",CharacteristicUuidTx:"6E400003-B5A3-F393-E0A9-E50E24DCCA9E"}),P(J,"CommandCodes",{AppStart:1,SendTxtMsg:2,SendChannelTxtMsg:3,GetContacts:4,GetDeviceTime:5,SetDeviceTime:6,SendSelfAdvert:7,SetAdvertName:8,AddUpdateContact:9,SyncNextMessage:10,SetRadioParams:11,SetTxPower:12,ResetPath:13,SetAdvertLatLon:14,RemoveContact:15,ShareContact:16,ExportContact:17,ImportContact:18,Reboot:19,GetBatteryVoltage:20,SetTuningParams:21,DeviceQuery:22,ExportPrivateKey:23,ImportPrivateKey:24,SendRawData:25,SendLogin:26,SendStatusReq:27,GetChannel:31,SetChannel:32,SignStart:33,SignData:34,SignFinish:35,SendTracePath:36,SetOtherParams:38,SendTelemetryReq:39,SendBinaryReq:50}),P(J,"ResponseCodes",{Ok:0,Err:1,ContactsStart:2,Contact:3,EndOfContacts:4,SelfInfo:5,Sent:6,ContactMsgRecv:7,ChannelMsgRecv:8,CurrTime:9,NoMoreMessages:10,ExportContact:11,BatteryVoltage:12,DeviceInfo:13,PrivateKey:14,Disabled:15,ChannelInfo:18,SignStart:19,Signature:20}),P(J,"PushCodes",{Advert:128,PathUpdated:129,SendConfirmed:130,MsgWaiting:131,RawData:132,LoginSuccess:133,LoginFail:134,StatusResponse:135,LogRxData:136,TraceData:137,NewAdvert:138,TelemetryResponse:139,BinaryResponse:140}),P(J,"ErrorCodes",{UnsupportedCmd:1,NotFound:2,TableFull:3,BadState:4,FileIoError:5,IllegalArg:6}),P(J,"AdvType",{None:0,Chat:1,Repeater:2,Room:3}),P(J,"SelfAdvertTypes",{ZeroHop:0,Flood:1}),P(J,"TxtTypes",{Plain:0,CliData:1,SignedPlain:2}),P(J,"BinaryRequestTypes",{GetTelemetryData:3,GetAvgMinMax:4,GetAccessList:5,GetNeighbours:6});var i=J;var Gt=class{constructor(){this.eventListenersMap=new Map}on(e,t){this.eventListenersMap.has(e)||this.eventListenersMap.set(e,[]),this.eventListenersMap.get(e).push(t)}off(e,t){if(this.eventListenersMap.has(e)){let n=this.eventListenersMap.get(e).filter(o=>o!==t);this.eventListenersMap.set(e,n)}}once(e,t){let n=(...o)=>{this.off(e,n),setTimeout(()=>t(...o),0)};this.on(e,n)}emit(e,...t){if(this.eventListenersMap.has(e))for(let n of this.eventListenersMap.get(e))setTimeout(()=>n(...t),0)}},Gn=Gt;var $t=class{static bytesToHex(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}static hexToBytes(e){return Uint8Array.from(e.match(/.{1,2}/g).map(t=>parseInt(t,16)))}static base64ToBytes(e){return Uint8Array.from(atob(e),t=>t.charCodeAt(0))}static areBuffersEqual(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},ge=$t;var X=class X{constructor(e,t,n,o){this.publicKey=e,this.timestamp=t,this.signature=n,this.appData=o,this.parsed=this.parseAppData()}static fromBytes(e){let t=new q(e),n=t.readBytes(32),o=t.readUInt32LE(),r=t.readBytes(64),a=t.readRemainingBytes();return new X(n,o,r,a)}getFlags(){return this.appData[0]}getType(){return this.getFlags()&15}getTypeString(){let e=this.getType();return e===X.ADV_TYPE_NONE?"NONE":e===X.ADV_TYPE_CHAT?"CHAT":e===X.ADV_TYPE_REPEATER?"REPEATER":e===X.ADV_TYPE_ROOM?"ROOM":null}async isVerified(){let{ed25519:e}=await Promise.resolve().then(()=>(zs(),Xs)),t=new I;return t.writeBytes(this.publicKey),t.writeUInt32LE(this.timestamp),t.writeBytes(this.appData),e.verify(this.signature,t.toBytes(),this.publicKey)}parseAppData(){let e=new q(this.appData),t=e.readByte();var n=null,o=null;t&X.ADV_LATLON_MASK&&(n=e.readInt32LE(),o=e.readInt32LE());var r=null;return t&X.ADV_NAME_MASK&&(r=e.readString()),{type:this.getTypeString(),lat:n,lon:o,name:r}}};P(X,"ADV_TYPE_NONE",0),P(X,"ADV_TYPE_CHAT",1),P(X,"ADV_TYPE_REPEATER",2),P(X,"ADV_TYPE_ROOM",3),P(X,"ADV_LATLON_MASK",16),P(X,"ADV_BATTERY_MASK",32),P(X,"ADV_TEMPERATURE_MASK",64),P(X,"ADV_NAME_MASK",128);var bn=X,Sn=bn;var T=class T{constructor(e,t,n){this.header=e,this.path=t,this.payload=n,this.route_type=this.getRouteType(),this.route_type_string=this.getRouteTypeString(),this.payload_type=this.getPayloadType(),this.payload_type_string=this.getPayloadTypeString(),this.payload_version=this.getPayloadVer(),this.is_marked_do_not_retransmit=this.isMarkedDoNotRetransmit()}static fromBytes(e){let t=new q(e),n=t.readByte(),o=t.readInt8(),r=t.readBytes(o),a=t.readRemainingBytes();return new T(n,r,a)}getRouteType(){return this.header&T.PH_ROUTE_MASK}getRouteTypeString(){switch(this.getRouteType()){case T.ROUTE_TYPE_FLOOD:return"FLOOD";case T.ROUTE_TYPE_DIRECT:return"DIRECT";default:return null}}isRouteFlood(){return this.getRouteType()===T.ROUTE_TYPE_FLOOD}isRouteDirect(){return this.getRouteType()===T.ROUTE_TYPE_DIRECT}getPayloadType(){return this.header>>T.PH_TYPE_SHIFT&T.PH_TYPE_MASK}getPayloadTypeString(){switch(this.getPayloadType()){case T.PAYLOAD_TYPE_REQ:return"REQ";case T.PAYLOAD_TYPE_RESPONSE:return"RESPONSE";case T.PAYLOAD_TYPE_TXT_MSG:return"TXT_MSG";case T.PAYLOAD_TYPE_ACK:return"ACK";case T.PAYLOAD_TYPE_ADVERT:return"ADVERT";case T.PAYLOAD_TYPE_GRP_TXT:return"GRP_TXT";case T.PAYLOAD_TYPE_GRP_DATA:return"GRP_DATA";case T.PAYLOAD_TYPE_ANON_REQ:return"ANON_REQ";case T.PAYLOAD_TYPE_PATH:return"PATH";case T.PAYLOAD_TYPE_TRACE:return"TRACE";case T.PAYLOAD_TYPE_RAW_CUSTOM:return"RAW_CUSTOM";default:return null}}getPayloadVer(){return this.header>>T.PH_VER_SHIFT&T.PH_VER_MASK}markDoNotRetransmit(){this.header=255}isMarkedDoNotRetransmit(){return this.header===255}parsePayload(){switch(this.getPayloadType()){case T.PAYLOAD_TYPE_PATH:return this.parsePayloadTypePath();case T.PAYLOAD_TYPE_REQ:return this.parsePayloadTypeReq();case T.PAYLOAD_TYPE_RESPONSE:return this.parsePayloadTypeResponse();case T.PAYLOAD_TYPE_TXT_MSG:return this.parsePayloadTypeTxtMsg();case T.PAYLOAD_TYPE_ACK:return this.parsePayloadTypeAck();case T.PAYLOAD_TYPE_ADVERT:return this.parsePayloadTypeAdvert();case T.PAYLOAD_TYPE_ANON_REQ:return this.parsePayloadTypeAnonReq();default:return null}}parsePayloadTypePath(){let e=new q(this.payload),t=e.readByte();return{src:e.readByte(),dest:t}}parsePayloadTypeReq(){let e=new q(this.payload),t=e.readByte(),n=e.readByte(),o=e.readRemainingBytes();return{src:n,dest:t,encrypted:o}}parsePayloadTypeResponse(){let e=new q(this.payload),t=e.readByte();return{src:e.readByte(),dest:t}}parsePayloadTypeTxtMsg(){let e=new q(this.payload),t=e.readByte();return{src:e.readByte(),dest:t}}parsePayloadTypeAck(){return{ack_code:this.payload}}parsePayloadTypeAdvert(){let e=Sn.fromBytes(this.payload);return{public_key:e.publicKey,timestamp:e.timestamp,app_data:e.parseAppData()}}parsePayloadTypeAnonReq(){let e=new q(this.payload),t=e.readByte();return{src:e.readBytes(32),dest:t}}};P(T,"PH_ROUTE_MASK",3),P(T,"PH_TYPE_SHIFT",2),P(T,"PH_TYPE_MASK",15),P(T,"PH_VER_SHIFT",6),P(T,"PH_VER_MASK",3),P(T,"ROUTE_TYPE_RESERVED1",0),P(T,"ROUTE_TYPE_FLOOD",1),P(T,"ROUTE_TYPE_DIRECT",2),P(T,"ROUTE_TYPE_RESERVED2",3),P(T,"PAYLOAD_TYPE_REQ",0),P(T,"PAYLOAD_TYPE_RESPONSE",1),P(T,"PAYLOAD_TYPE_TXT_MSG",2),P(T,"PAYLOAD_TYPE_ACK",3),P(T,"PAYLOAD_TYPE_ADVERT",4),P(T,"PAYLOAD_TYPE_GRP_TXT",5),P(T,"PAYLOAD_TYPE_GRP_DATA",6),P(T,"PAYLOAD_TYPE_ANON_REQ",7),P(T,"PAYLOAD_TYPE_PATH",8),P(T,"PAYLOAD_TYPE_TRACE",9),P(T,"PAYLOAD_TYPE_RAW_CUSTOM",15);var Tn=T,bt=Tn;var vn=class{static getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}},Pn=vn;var In=class extends Gn{async onConnected(){try{await this.deviceQuery(i.SupportedCompanionProtocolVersion)}catch{}this.emit("connected")}onDisconnected(){this.emit("disconnected")}async close(){throw new Error("This method must be implemented by the subclass.")}async sendToRadioFrame(e){throw new Error("This method must be implemented by the subclass.")}async sendCommandAppStart(){let e=new I;e.writeByte(i.CommandCodes.AppStart),e.writeByte(1),e.writeBytes(new Uint8Array(6)),e.writeString("test"),await this.sendToRadioFrame(e.toBytes())}async sendCommandSendTxtMsg(e,t,n,o,r){let a=new I;a.writeByte(i.CommandCodes.SendTxtMsg),a.writeByte(e),a.writeByte(t),a.writeUInt32LE(n),a.writeBytes(o.slice(0,6)),a.writeString(r),await this.sendToRadioFrame(a.toBytes())}async sendCommandSendChannelTxtMsg(e,t,n,o){let r=new I;r.writeByte(i.CommandCodes.SendChannelTxtMsg),r.writeByte(e),r.writeByte(t),r.writeUInt32LE(n),r.writeString(o),await this.sendToRadioFrame(r.toBytes())}async sendCommandGetContacts(e){let t=new I;t.writeByte(i.CommandCodes.GetContacts),e&&t.writeUInt32LE(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandGetDeviceTime(){let e=new I;e.writeByte(i.CommandCodes.GetDeviceTime),await this.sendToRadioFrame(e.toBytes())}async sendCommandSetDeviceTime(e){let t=new I;t.writeByte(i.CommandCodes.SetDeviceTime),t.writeUInt32LE(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendSelfAdvert(e){let t=new I;t.writeByte(i.CommandCodes.SendSelfAdvert),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSetAdvertName(e){let t=new I;t.writeByte(i.CommandCodes.SetAdvertName),t.writeString(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandAddUpdateContact(e,t,n,o,r,a,d,c,u){let l=new I;l.writeByte(i.CommandCodes.AddUpdateContact),l.writeBytes(e),l.writeByte(t),l.writeByte(n),l.writeByte(o),l.writeBytes(r),l.writeCString(a,32),l.writeUInt32LE(d),l.writeUInt32LE(c),l.writeUInt32LE(u),await this.sendToRadioFrame(l.toBytes())}async sendCommandSyncNextMessage(){let e=new I;e.writeByte(i.CommandCodes.SyncNextMessage),await this.sendToRadioFrame(e.toBytes())}async sendCommandSetRadioParams(e,t,n,o){let r=new I;r.writeByte(i.CommandCodes.SetRadioParams),r.writeUInt32LE(e),r.writeUInt32LE(t),r.writeByte(n),r.writeByte(o),await this.sendToRadioFrame(r.toBytes())}async sendCommandSetTxPower(e){let t=new I;t.writeByte(i.CommandCodes.SetTxPower),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandResetPath(e){let t=new I;t.writeByte(i.CommandCodes.ResetPath),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSetAdvertLatLon(e,t){let n=new I;n.writeByte(i.CommandCodes.SetAdvertLatLon),n.writeInt32LE(e),n.writeInt32LE(t),await this.sendToRadioFrame(n.toBytes())}async sendCommandRemoveContact(e){let t=new I;t.writeByte(i.CommandCodes.RemoveContact),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandShareContact(e){let t=new I;t.writeByte(i.CommandCodes.ShareContact),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandExportContact(e=null){let t=new I;t.writeByte(i.CommandCodes.ExportContact),e&&t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandImportContact(e){let t=new I;t.writeByte(i.CommandCodes.ImportContact),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandReboot(){let e=new I;e.writeByte(i.CommandCodes.Reboot),e.writeString("reboot"),await this.sendToRadioFrame(e.toBytes())}async sendCommandGetBatteryVoltage(){let e=new I;e.writeByte(i.CommandCodes.GetBatteryVoltage),await this.sendToRadioFrame(e.toBytes())}async sendCommandDeviceQuery(e){let t=new I;t.writeByte(i.CommandCodes.DeviceQuery),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandExportPrivateKey(){let e=new I;e.writeByte(i.CommandCodes.ExportPrivateKey),await this.sendToRadioFrame(e.toBytes())}async sendCommandImportPrivateKey(e){let t=new I;t.writeByte(i.CommandCodes.ImportPrivateKey),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendRawData(e,t){let n=new I;n.writeByte(i.CommandCodes.SendRawData),n.writeByte(e.length),n.writeBytes(e),n.writeBytes(t),await this.sendToRadioFrame(n.toBytes())}async sendCommandSendLogin(e,t){let n=new I;n.writeByte(i.CommandCodes.SendLogin),n.writeBytes(e),n.writeString(t),await this.sendToRadioFrame(n.toBytes())}async sendCommandSendStatusReq(e){let t=new I;t.writeByte(i.CommandCodes.SendStatusReq),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendTelemetryReq(e){let t=new I;t.writeByte(i.CommandCodes.SendTelemetryReq),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSendBinaryReq(e,t){let n=new I;n.writeByte(i.CommandCodes.SendBinaryReq),n.writeBytes(e),n.writeBytes(t),await this.sendToRadioFrame(n.toBytes())}async sendCommandGetChannel(e){let t=new I;t.writeByte(i.CommandCodes.GetChannel),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSetChannel(e,t,n){let o=new I;o.writeByte(i.CommandCodes.SetChannel),o.writeByte(e),o.writeCString(t,32),o.writeBytes(n),await this.sendToRadioFrame(o.toBytes())}async sendCommandSignStart(){let e=new I;e.writeByte(i.CommandCodes.SignStart),await this.sendToRadioFrame(e.toBytes())}async sendCommandSignData(e){let t=new I;t.writeByte(i.CommandCodes.SignData),t.writeBytes(e),await this.sendToRadioFrame(t.toBytes())}async sendCommandSignFinish(){let e=new I;e.writeByte(i.CommandCodes.SignFinish),await this.sendToRadioFrame(e.toBytes())}async sendCommandSendTracePath(e,t,n){let o=new I;o.writeByte(i.CommandCodes.SendTracePath),o.writeUInt32LE(e),o.writeUInt32LE(t),o.writeByte(0),o.writeBytes(n),await this.sendToRadioFrame(o.toBytes())}async sendCommandSetOtherParams(e){let t=new I;t.writeByte(i.CommandCodes.SetOtherParams),t.writeByte(e),await this.sendToRadioFrame(t.toBytes())}onFrameReceived(e){this.emit("rx",e);let t=new q(e),n=t.readByte();n===i.ResponseCodes.Ok?this.onOkResponse(t):n===i.ResponseCodes.Err?this.onErrResponse(t):n===i.ResponseCodes.SelfInfo?this.onSelfInfoResponse(t):n===i.ResponseCodes.CurrTime?this.onCurrTimeResponse(t):n===i.ResponseCodes.NoMoreMessages?this.onNoMoreMessagesResponse(t):n===i.ResponseCodes.ContactMsgRecv?this.onContactMsgRecvResponse(t):n===i.ResponseCodes.ChannelMsgRecv?this.onChannelMsgRecvResponse(t):n===i.ResponseCodes.ContactsStart?this.onContactsStartResponse(t):n===i.ResponseCodes.Contact?this.onContactResponse(t):n===i.ResponseCodes.EndOfContacts?this.onEndOfContactsResponse(t):n===i.ResponseCodes.Sent?this.onSentResponse(t):n===i.ResponseCodes.ExportContact?this.onExportContactResponse(t):n===i.ResponseCodes.BatteryVoltage?this.onBatteryVoltageResponse(t):n===i.ResponseCodes.DeviceInfo?this.onDeviceInfoResponse(t):n===i.ResponseCodes.PrivateKey?this.onPrivateKeyResponse(t):n===i.ResponseCodes.Disabled?this.onDisabledResponse(t):n===i.ResponseCodes.ChannelInfo?this.onChannelInfoResponse(t):n===i.ResponseCodes.SignStart?this.onSignStartResponse(t):n===i.ResponseCodes.Signature?this.onSignatureResponse(t):n===i.PushCodes.Advert?this.onAdvertPush(t):n===i.PushCodes.PathUpdated?this.onPathUpdatedPush(t):n===i.PushCodes.SendConfirmed?this.onSendConfirmedPush(t):n===i.PushCodes.MsgWaiting?this.onMsgWaitingPush(t):n===i.PushCodes.RawData?this.onRawDataPush(t):n===i.PushCodes.LoginSuccess?this.onLoginSuccessPush(t):n===i.PushCodes.StatusResponse?this.onStatusResponsePush(t):n===i.PushCodes.LogRxData?this.onLogRxDataPush(t):n===i.PushCodes.TelemetryResponse?this.onTelemetryResponsePush(t):n===i.PushCodes.TraceData?this.onTraceDataPush(t):n===i.PushCodes.NewAdvert?this.onNewAdvertPush(t):n===i.PushCodes.BinaryResponse?this.onBinaryResponsePush(t):console.log(`unhandled frame: code=${n}`,e)}onAdvertPush(e){this.emit(i.PushCodes.Advert,{publicKey:e.readBytes(32)})}onPathUpdatedPush(e){this.emit(i.PushCodes.PathUpdated,{publicKey:e.readBytes(32)})}onSendConfirmedPush(e){this.emit(i.PushCodes.SendConfirmed,{ackCode:e.readUInt32LE(),roundTrip:e.readUInt32LE()})}onMsgWaitingPush(e){this.emit(i.PushCodes.MsgWaiting,{})}onRawDataPush(e){this.emit(i.PushCodes.RawData,{lastSnr:e.readInt8()/4,lastRssi:e.readInt8(),reserved:e.readByte(),payload:e.readRemainingBytes()})}onLoginSuccessPush(e){this.emit(i.PushCodes.LoginSuccess,{reserved:e.readByte(),pubKeyPrefix:e.readBytes(6)})}onStatusResponsePush(e){this.emit(i.PushCodes.StatusResponse,{reserved:e.readByte(),pubKeyPrefix:e.readBytes(6),statusData:e.readRemainingBytes()})}onLogRxDataPush(e){this.emit(i.PushCodes.LogRxData,{lastSnr:e.readInt8()/4,lastRssi:e.readInt8(),raw:e.readRemainingBytes()})}onTelemetryResponsePush(e){this.emit(i.PushCodes.TelemetryResponse,{reserved:e.readByte(),pubKeyPrefix:e.readBytes(6),lppSensorData:e.readRemainingBytes()})}onBinaryResponsePush(e){this.emit(i.PushCodes.BinaryResponse,{reserved:e.readByte(),tag:e.readUInt32LE(),responseData:e.readRemainingBytes()})}onTraceDataPush(e){let t=e.readByte(),n=e.readUInt8();this.emit(i.PushCodes.TraceData,{reserved:t,pathLen:n,flags:e.readUInt8(),tag:e.readUInt32LE(),authCode:e.readUInt32LE(),pathHashes:e.readBytes(n),pathSnrs:e.readBytes(n),lastSnr:e.readInt8()/4})}onNewAdvertPush(e){this.emit(i.PushCodes.NewAdvert,{publicKey:e.readBytes(32),type:e.readByte(),flags:e.readByte(),outPathLen:e.readInt8(),outPath:e.readBytes(64),advName:e.readCString(32),lastAdvert:e.readUInt32LE(),advLat:e.readUInt32LE(),advLon:e.readUInt32LE(),lastMod:e.readUInt32LE()})}onOkResponse(e){this.emit(i.ResponseCodes.Ok,{})}onErrResponse(e){let t=e.getRemainingBytesCount()>0?e.readByte():null;this.emit(i.ResponseCodes.Err,{errCode:t})}onContactsStartResponse(e){this.emit(i.ResponseCodes.ContactsStart,{count:e.readUInt32LE()})}onContactResponse(e){this.emit(i.ResponseCodes.Contact,{publicKey:e.readBytes(32),type:e.readByte(),flags:e.readByte(),outPathLen:e.readInt8(),outPath:e.readBytes(64),advName:e.readCString(32),lastAdvert:e.readUInt32LE(),advLat:e.readUInt32LE(),advLon:e.readUInt32LE(),lastMod:e.readUInt32LE()})}onEndOfContactsResponse(e){this.emit(i.ResponseCodes.EndOfContacts,{mostRecentLastmod:e.readUInt32LE()})}onSentResponse(e){this.emit(i.ResponseCodes.Sent,{result:e.readInt8(),expectedAckCrc:e.readUInt32LE(),estTimeout:e.readUInt32LE()})}onExportContactResponse(e){this.emit(i.ResponseCodes.ExportContact,{advertPacketBytes:e.readRemainingBytes()})}onBatteryVoltageResponse(e){this.emit(i.ResponseCodes.BatteryVoltage,{batteryMilliVolts:e.readUInt16LE()})}onDeviceInfoResponse(e){this.emit(i.ResponseCodes.DeviceInfo,{firmwareVer:e.readInt8(),reserved:e.readBytes(6),firmware_build_date:e.readCString(12),manufacturerModel:e.readString()})}onPrivateKeyResponse(e){this.emit(i.ResponseCodes.PrivateKey,{privateKey:e.readBytes(64)})}onDisabledResponse(e){this.emit(i.ResponseCodes.Disabled,{})}onChannelInfoResponse(e){let t=e.readUInt8(),n=e.readCString(32),o=e.getRemainingBytesCount();o===16?this.emit(i.ResponseCodes.ChannelInfo,{channelIdx:t,name:n,secret:e.readBytes(o)}):console.log(`ChannelInfo has unexpected key length: ${o}`)}onSignStartResponse(e){this.emit(i.ResponseCodes.SignStart,{reserved:e.readByte(),maxSignDataLen:e.readUInt32LE()})}onSignatureResponse(e){this.emit(i.ResponseCodes.Signature,{signature:e.readBytes(64)})}onSelfInfoResponse(e){this.emit(i.ResponseCodes.SelfInfo,{type:e.readByte(),txPower:e.readByte(),maxTxPower:e.readByte(),publicKey:e.readBytes(32),advLat:e.readInt32LE(),advLon:e.readInt32LE(),reserved:e.readBytes(3),manualAddContacts:e.readByte(),radioFreq:e.readUInt32LE(),radioBw:e.readUInt32LE(),radioSf:e.readByte(),radioCr:e.readByte(),name:e.readString()})}onCurrTimeResponse(e){this.emit(i.ResponseCodes.CurrTime,{epochSecs:e.readUInt32LE()})}onNoMoreMessagesResponse(e){this.emit(i.ResponseCodes.NoMoreMessages,{})}onContactMsgRecvResponse(e){this.emit(i.ResponseCodes.ContactMsgRecv,{pubKeyPrefix:e.readBytes(6),pathLen:e.readByte(),txtType:e.readByte(),senderTimestamp:e.readUInt32LE(),text:e.readString()})}onChannelMsgRecvResponse(e){this.emit(i.ResponseCodes.ChannelMsgRecv,{channelIdx:e.readInt8(),pathLen:e.readByte(),txtType:e.readByte(),senderTimestamp:e.readUInt32LE(),text:e.readString()})}getSelfInfo(e=null){return new Promise(async(t,n)=>{this.once(i.ResponseCodes.SelfInfo,o=>{t(o)}),e!=null&&setTimeout(n,e),await this.sendCommandAppStart()})}async sendAdvert(e){return new Promise(async(t,n)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSendSelfAdvert(e)}catch(o){n(o)}})}async sendFloodAdvert(){return await this.sendAdvert(i.SelfAdvertTypes.Flood)}async sendZeroHopAdvert(){return await this.sendAdvert(i.SelfAdvertTypes.ZeroHop)}setAdvertName(e){return new Promise(async(t,n)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetAdvertName(e)}catch(o){n(o)}})}setAdvertLatLong(e,t){return new Promise(async(n,o)=>{try{let r=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),n()},a=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),o()};this.once(i.ResponseCodes.Ok,r),this.once(i.ResponseCodes.Err,a),await this.sendCommandSetAdvertLatLon(e,t)}catch(r){o(r)}})}setTxPower(e){return new Promise(async(t,n)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetTxPower(e)}catch(o){n(o)}})}setRadioParams(e,t,n,o){return new Promise(async(r,a)=>{try{let d=()=>{this.off(i.ResponseCodes.Ok,d),this.off(i.ResponseCodes.Err,c),r()},c=()=>{this.off(i.ResponseCodes.Ok,d),this.off(i.ResponseCodes.Err,c),a()};this.once(i.ResponseCodes.Ok,d),this.once(i.ResponseCodes.Err,c),await this.sendCommandSetRadioParams(e,t,n,o)}catch(d){a(d)}})}getContacts(){return new Promise(async(e,t)=>{let n=[],o=r=>{n.push(r)};this.on(i.ResponseCodes.Contact,o),this.once(i.ResponseCodes.EndOfContacts,()=>{this.off(i.ResponseCodes.Contact,o),e(n)}),await this.sendCommandGetContacts()})}async findContactByName(e){return(await this.getContacts()).find(n=>n.advName===e)}async findContactByPublicKeyPrefix(e){return(await this.getContacts()).find(n=>{let o=n.publicKey.subarray(0,e.length);return ge.areBuffersEqual(e,o)})}sendTextMessage(e,t,n){return new Promise(async(o,r)=>{try{let a=h=>{this.off(i.ResponseCodes.Sent,a),this.off(i.ResponseCodes.Err,d),o(h)},d=()=>{this.off(i.ResponseCodes.Sent,a),this.off(i.ResponseCodes.Err,d),r()};this.once(i.ResponseCodes.Sent,a),this.once(i.ResponseCodes.Err,d);let c=n??i.TxtTypes.Plain,u=0,l=Math.floor(Date.now()/1e3);await this.sendCommandSendTxtMsg(c,u,l,e,t)}catch(a){r(a)}})}sendChannelTextMessage(e,t){return new Promise(async(n,o)=>{try{let r=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),n()},a=()=>{this.off(i.ResponseCodes.Ok,r),this.off(i.ResponseCodes.Err,a),o()};this.once(i.ResponseCodes.Ok,r),this.once(i.ResponseCodes.Err,a);let d=i.TxtTypes.Plain,c=Math.floor(Date.now()/1e3);await this.sendCommandSendChannelTxtMsg(d,e,c,t)}catch(r){o(r)}})}syncNextMessage(){return new Promise(async(e,t)=>{let n=a=>{this.off(i.ResponseCodes.ContactMsgRecv,n),this.off(i.ResponseCodes.ChannelMsgRecv,o),this.off(i.ResponseCodes.NoMoreMessages,r),e({contactMessage:a})},o=a=>{this.off(i.ResponseCodes.ContactMsgRecv,n),this.off(i.ResponseCodes.ChannelMsgRecv,o),this.off(i.ResponseCodes.NoMoreMessages,r),e({channelMessage:a})},r=()=>{this.off(i.ResponseCodes.ContactMsgRecv,n),this.off(i.ResponseCodes.ChannelMsgRecv,o),this.off(i.ResponseCodes.NoMoreMessages,r),e(null)};this.once(i.ResponseCodes.ContactMsgRecv,n),this.once(i.ResponseCodes.ChannelMsgRecv,o),this.once(i.ResponseCodes.NoMoreMessages,r),await this.sendCommandSyncNextMessage()})}async getWaitingMessages(){let e=[];for(;;){let t=await this.syncNextMessage();if(!t)break;e.push(t)}return e}getDeviceTime(){return new Promise(async(e,t)=>{try{let n=r=>{this.off(i.ResponseCodes.CurrTime,n),this.off(i.ResponseCodes.Err,o),e(r)},o=()=>{this.off(i.ResponseCodes.CurrTime,n),this.off(i.ResponseCodes.Err,o),t()};this.once(i.ResponseCodes.CurrTime,n),this.once(i.ResponseCodes.Err,o),await this.sendCommandGetDeviceTime()}catch(n){t(n)}})}setDeviceTime(e){return new Promise(async(t,n)=>{try{let o=a=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetDeviceTime(e)}catch(o){n(o)}})}async syncDeviceTime(){await this.setDeviceTime(Math.floor(Date.now()/1e3))}importContact(e){return new Promise(async(t,n)=>{try{let o=a=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandImportContact(e)}catch(o){n(o)}})}exportContact(e=null){return new Promise(async(t,n)=>{try{let o=a=>{this.off(i.ResponseCodes.ExportContact,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.ExportContact,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.ExportContact,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandExportContact(e)}catch(o){n(o)}})}shareContact(e){return new Promise(async(t,n)=>{try{let o=a=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandShareContact(e)}catch(o){n(o)}})}removeContact(e){return new Promise(async(t,n)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandRemoveContact(e)}catch(o){n(o)}})}addOrUpdateContact(e,t,n,o,r,a,d,c,u){return new Promise(async(l,h)=>{try{let f=()=>{this.off(i.ResponseCodes.Ok,f),this.off(i.ResponseCodes.Err,m),l()},m=()=>{this.off(i.ResponseCodes.Ok,f),this.off(i.ResponseCodes.Err,m),h()};this.once(i.ResponseCodes.Ok,f),this.once(i.ResponseCodes.Err,m),await this.sendCommandAddUpdateContact(e,t,n,o,r,a,d,c,u)}catch(f){h(f)}})}setContactPath(e,t){return new Promise(async(n,o)=>{try{let d=new Uint8Array(64);for(var r=0;r<t.length&&r<64;r++)d[r]=t[r];return e.outPathLen=t.length,e.outPath=d,await this.addOrUpdateContact(e.publicKey,e.type,e.flags,e.outPathLen,e.outPath,e.advName,e.lastAdvert,e.advLat,e.advLon)}catch(a){o(a)}})}resetPath(e){return new Promise(async(t,n)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandResetPath(e)}catch(o){n(o)}})}reboot(){return new Promise(async(e,t)=>{try{let n=()=>{this.off(i.ResponseCodes.Err,n),t()};setTimeout(()=>{this.off(i.ResponseCodes.Err,n),e()},1e3),this.once(i.ResponseCodes.Err,n),await this.sendCommandReboot()}catch(n){t(n)}})}getBatteryVoltage(){return new Promise(async(e,t)=>{try{let n=r=>{this.off(i.ResponseCodes.BatteryVoltage,n),this.off(i.ResponseCodes.Err,o),e(r)},o=()=>{this.off(i.ResponseCodes.BatteryVoltage,n),this.off(i.ResponseCodes.Err,o),t()};this.once(i.ResponseCodes.BatteryVoltage,n),this.once(i.ResponseCodes.Err,o),await this.sendCommandGetBatteryVoltage()}catch(n){t(n)}})}deviceQuery(e){return new Promise(async(t,n)=>{try{let o=a=>{this.off(i.ResponseCodes.DeviceInfo,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.DeviceInfo,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.DeviceInfo,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandDeviceQuery(e)}catch(o){n(o)}})}exportPrivateKey(){return new Promise(async(e,t)=>{try{let n=a=>{this.off(i.ResponseCodes.PrivateKey,n),this.off(i.ResponseCodes.Err,o),this.off(i.ResponseCodes.Disabled,r),e(a)},o=()=>{this.off(i.ResponseCodes.PrivateKey,n),this.off(i.ResponseCodes.Err,o),this.off(i.ResponseCodes.Disabled,r),t()},r=()=>{this.off(i.ResponseCodes.PrivateKey,n),this.off(i.ResponseCodes.Err,o),this.off(i.ResponseCodes.Disabled,r),t("disabled")};this.once(i.ResponseCodes.PrivateKey,n),this.once(i.ResponseCodes.Err,o),this.once(i.ResponseCodes.Disabled,r),await this.sendCommandExportPrivateKey()}catch(n){t(n)}})}importPrivateKey(e){return new Promise(async(t,n)=>{try{let o=d=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),this.off(i.ResponseCodes.Disabled,a),t(d)},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),this.off(i.ResponseCodes.Disabled,a),n()},a=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),this.off(i.ResponseCodes.Disabled,a),n("disabled")};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),this.once(i.ResponseCodes.Disabled,a),await this.sendCommandImportPrivateKey(e)}catch(o){n(o)}})}login(e,t,n=1e3){return new Promise(async(o,r)=>{try{let d=e.subarray(0,6);var a=null;let c=h=>{this.off(i.ResponseCodes.Err,l);let f=h.estTimeout+n;a=setTimeout(()=>{this.off(i.ResponseCodes.Err,l),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.LoginSuccess,u),r("timeout")},f)},u=h=>{if(!ge.areBuffersEqual(d,h.pubKeyPrefix)){console.log("onLoginSuccess is not for this login request, ignoring...");return}clearTimeout(a),this.off(i.ResponseCodes.Err,l),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.LoginSuccess,u),o(h)},l=()=>{clearTimeout(a),this.off(i.ResponseCodes.Err,l),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.LoginSuccess,u),r()};this.once(i.ResponseCodes.Err,l),this.once(i.ResponseCodes.Sent,c),this.once(i.PushCodes.LoginSuccess,u),await this.sendCommandSendLogin(e,t)}catch(d){r(d)}})}getStatus(e,t=1e3){return new Promise(async(n,o)=>{try{let a=e.subarray(0,6);var r=null;let d=l=>{this.off(i.ResponseCodes.Err,u);let h=l.estTimeout+t;r=setTimeout(()=>{this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.StatusResponse,c),o("timeout")},h)},c=l=>{if(!ge.areBuffersEqual(a,l.pubKeyPrefix)){console.log("onStatusResponsePush is not for this status request, ignoring...");return}clearTimeout(r),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.StatusResponse,c);let h=new q(l.statusData),f={batt_milli_volts:h.readUInt16LE(),curr_tx_queue_len:h.readUInt16LE(),noise_floor:h.readInt16LE(),last_rssi:h.readInt16LE(),n_packets_recv:h.readUInt32LE(),n_packets_sent:h.readUInt32LE(),total_air_time_secs:h.readUInt32LE(),total_up_time_secs:h.readUInt32LE(),n_sent_flood:h.readUInt32LE(),n_sent_direct:h.readUInt32LE(),n_recv_flood:h.readUInt32LE(),n_recv_direct:h.readUInt32LE(),err_events:h.readUInt16LE(),last_snr:h.readInt16LE(),n_direct_dups:h.readUInt16LE(),n_flood_dups:h.readUInt16LE()};n(f)},u=()=>{clearTimeout(r),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.StatusResponse,c),o()};this.once(i.ResponseCodes.Err,u),this.once(i.ResponseCodes.Sent,d),this.once(i.PushCodes.StatusResponse,c),await this.sendCommandSendStatusReq(e)}catch(a){o(a)}})}getTelemetry(e,t=1e3){return new Promise(async(n,o)=>{try{let a=e.subarray(0,6);var r=null;let d=l=>{this.off(i.ResponseCodes.Err,u);let h=l.estTimeout+t;r=setTimeout(()=>{this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TelemetryResponse,c),o("timeout")},h)},c=l=>{if(!ge.areBuffersEqual(a,l.pubKeyPrefix)){console.log("onTelemetryResponsePush is not for this telemetry request, ignoring...");return}clearTimeout(r),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TelemetryResponse,c),n(l)},u=()=>{clearTimeout(r),this.off(i.ResponseCodes.Err,u),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TelemetryResponse,c),o()};this.once(i.ResponseCodes.Err,u),this.once(i.ResponseCodes.Sent,d),this.once(i.PushCodes.TelemetryResponse,c),await this.sendCommandSendTelemetryReq(e)}catch(a){o(a)}})}sendBinaryRequest(e,t,n=1e3){return new Promise(async(o,r)=>{try{var a=null,d=null;let c=h=>{a=h.expectedAckCrc,this.off(i.ResponseCodes.Err,l);let f=h.estTimeout+n;d=setTimeout(()=>{this.off(i.ResponseCodes.Err,l),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.BinaryResponse,u),r("timeout")},f)},u=h=>{if(a!==h.tag){console.log("onBinaryResponse is not for this request tag, ignoring...");return}clearTimeout(d),this.off(i.ResponseCodes.Err,l),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.BinaryResponse,u),o(h.responseData)},l=()=>{clearTimeout(d),this.off(i.ResponseCodes.Err,l),this.off(i.ResponseCodes.Sent,c),this.off(i.PushCodes.BinaryResponse,u),r()};this.once(i.ResponseCodes.Err,l),this.once(i.ResponseCodes.Sent,c),this.once(i.PushCodes.BinaryResponse,u),await this.sendCommandSendBinaryReq(e,t)}catch(c){r(c)}})}pingRepeaterZeroHop(e,t){return new Promise(async(n,o)=>{try{let a=new I;a.writeUInt32LE(Date.now()),a.writeBytes([112,105,110,103]),a.writeBytes(e.subarray(0,2));let d=a.toBytes();var r=Date.now();let c=l=>{let f=Date.now()-r,m=bt.fromBytes(l.raw);m.payload_type===bt.PAYLOAD_TYPE_RAW_CUSTOM&&ge.areBuffersEqual(m.payload,d)&&(this.off(i.ResponseCodes.Err,u),this.off(i.PushCodes.LogRxData,c),n({rtt:f,snr:l.lastSnr,rssi:l.lastRssi}))},u=()=>{this.off(i.ResponseCodes.Err,u),this.off(i.PushCodes.LogRxData,c),o()};this.once(i.ResponseCodes.Err,u),this.on(i.PushCodes.LogRxData,c),t!=null&&setTimeout(()=>{this.off(i.ResponseCodes.Err,u),this.off(i.PushCodes.LogRxData,c),o("timeout")},t),await this.sendCommandSendRawData([e.subarray(0,1)],d)}catch(a){o(a)}})}getChannel(e){return new Promise(async(t,n)=>{try{let o=a=>{this.off(i.ResponseCodes.ChannelInfo,o),this.off(i.ResponseCodes.Err,r),t(a)},r=()=>{this.off(i.ResponseCodes.ChannelInfo,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.ChannelInfo,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandGetChannel(e)}catch(o){n(o)}})}setChannel(e,t,n){return new Promise(async(o,r)=>{try{let a=()=>{this.off(i.ResponseCodes.Ok,a),this.off(i.ResponseCodes.Err,d),o()},d=()=>{this.off(i.ResponseCodes.Ok,a),this.off(i.ResponseCodes.Err,d),r()};this.once(i.ResponseCodes.Ok,a),this.once(i.ResponseCodes.Err,d),await this.sendCommandSetChannel(e,t,n)}catch(a){r(a)}})}async deleteChannel(e){return await this.setChannel(e,"",new Uint8Array(16))}getChannels(){return new Promise(async(e,t)=>{var n=0;let o=[];for(;;){try{let r=await this.getChannel(n);o.push(r)}catch{break}n++}return e(o)})}async findChannelByName(e){return(await this.getChannels()).find(n=>n.name===e)}async findChannelBySecret(e){return(await this.getChannels()).find(n=>ge.areBuffersEqual(e,n.secret))}async sign(e){return new Promise(async(t,n)=>{try{let r=new q(e),a=async()=>{var h;r.getRemainingBytesCount()>=128?h=r.readBytes(128):h=r.readRemainingBytes(),await this.sendCommandSignData(h)},d=async h=>{if(r.getRemainingBytesCount()>0){await a();return}await this.sendCommandSignFinish()},c=async h=>{if(this.off(i.ResponseCodes.SignStart,c),r.getRemainingBytesCount()>h.maxSignDataLen){this.off(i.ResponseCodes.ok,d),this.off(i.ResponseCodes.err,l),this.off(i.ResponseCodes.SignStart,c),this.off(i.ResponseCodes.Signature,u),n("data_too_long");return}await a()},u=h=>{this.off(i.ResponseCodes.ok,d),this.off(i.ResponseCodes.err,l),this.off(i.ResponseCodes.SignStart,c),this.off(i.ResponseCodes.Signature,u),t(h.signature)},l=h=>{this.off(i.ResponseCodes.ok,d),this.off(i.ResponseCodes.err,l),this.off(i.ResponseCodes.SignStart,c),this.off(i.ResponseCodes.Signature,u),n(h)};this.on(i.ResponseCodes.Ok,d),this.on(i.ResponseCodes.SignStart,c),this.on(i.ResponseCodes.Signature,u),this.once(i.ResponseCodes.Err,l),await this.sendCommandSignStart()}catch(o){n(o)}})}tracePath(e,t=0){return new Promise(async(n,o)=>{try{let a=Pn.getRandomInt(0,4294967295);var r=null;let d=l=>{this.off(i.ResponseCodes.Err,u);let h=l.estTimeout+t;r=setTimeout(()=>{this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TraceData,c),this.off(i.ResponseCodes.Err,u),o("timeout")},h)},c=l=>{if(l.tag!==a){console.log("ignoring trace data for a different trace request");return}clearTimeout(r),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TraceData,c),this.off(i.ResponseCodes.Err,u),n(l)},u=()=>{clearTimeout(r),this.off(i.ResponseCodes.Sent,d),this.off(i.PushCodes.TraceData,c),this.off(i.ResponseCodes.Err,u),o()};this.once(i.ResponseCodes.Sent,d),this.on(i.PushCodes.TraceData,c),this.once(i.ResponseCodes.Err,u),await this.sendCommandSendTracePath(a,0,e)}catch(a){o(a)}})}setOtherParams(e){return new Promise(async(t,n)=>{try{let o=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),t()},r=()=>{this.off(i.ResponseCodes.Ok,o),this.off(i.ResponseCodes.Err,r),n()};this.once(i.ResponseCodes.Ok,o),this.once(i.ResponseCodes.Err,r),await this.sendCommandSetOtherParams(e)}catch(o){n(o)}})}async setAutoAddContacts(){return await this.setOtherParams(!1)}async setManualAddContacts(){return await this.setOtherParams(!0)}async getNeighbours(e,t=10,n=0,o=0,r=8){let a=new I;a.writeByte(i.BinaryRequestTypes.GetNeighbours),a.writeByte(0),a.writeByte(t),a.writeUInt16LE(n),a.writeByte(o),a.writeByte(r),a.writeUInt32LE(Pn.getRandomInt(0,4294967295));let d=await this.sendBinaryRequest(e,a.toBytes()),c=new q(d),u=c.readUInt16LE(),l=c.readUInt16LE(),h=[];for(var f=0;f<l;f++){let m=c.readBytes(r),p=c.readUInt32LE(),B=c.readInt8()/4;h.push({publicKeyPrefix:m,heardSecondsAgo:p,snr:B})}return{totalNeighboursCount:u,neighbours:h}}},Qe=In;var Ln=class s extends Qe{constructor(){if(super(),this.readBuffer=[],this.constructor===s)throw new Error("SerialConnection is an abstract class and can't be instantiated.")}async write(e){throw new Error("Not Implemented: write must be implemented by SerialConnection sub class.")}async writeFrame(e,t){let n=new I;n.writeByte(e),n.writeUInt16LE(t.length),n.writeBytes(t),await this.write(n.toBytes())}async sendToRadioFrame(e){this.emit("tx",e),await this.writeFrame(60,e)}async onDataReceived(e){this.readBuffer=[...this.readBuffer,...e];let t=3;for(;this.readBuffer.length>=t;)try{let n=new q(this.readBuffer.slice(0,t)),o=n.readByte();if(o!==i.SerialFrameTypes.Incoming&&o!==i.SerialFrameTypes.Outgoing){this.readBuffer=this.readBuffer.slice(1);continue}let r=n.readUInt16LE();if(!r){this.readBuffer=this.readBuffer.slice(1);continue}let a=t+r;if(this.readBuffer.length<a)break;let d=this.readBuffer.slice(t,a);this.readBuffer=this.readBuffer.slice(a),this.onFrameReceived(d)}catch(n){console.error("Failed to process frame",n);break}}},St=Ln;var An=class s extends St{constructor(e){super(),this.serialPort=e,this.reader=e.readable.getReader(),this.writable=e.writable,this.readLoop(),this.serialPort.addEventListener("disconnect",()=>{this.onDisconnected()}),setTimeout(async()=>{await this.onConnected()},0)}static async open(){if(!navigator.serial)return alert("Web Serial is not supported in this browser"),null;let e=await navigator.serial.requestPort({filters:[]});return await e.open({baudRate:115200}),new s(e)}async close(){try{this.reader.releaseLock()}catch{}try{await this.serialPort.close()}catch{}}async write(e){let t=this.writable.getWriter();try{await t.write(new Uint8Array(e))}finally{t.releaseLock()}}async readLoop(){try{for(;;){let{value:e,done:t}=await this.reader.read();if(t)break;await this.onDataReceived(e)}}catch(e){if(e instanceof TypeError)return;console.error("Error reading from serial port: ",e)}finally{this.reader.releaseLock()}}},_n=An;var ke,Je,je,et,tt,nt,Tt,Pt,It,Le,eo,Lt,At,st,ot,rt,it,at,to,Re,Qs,js,_t,no,so,On,Un,Mt,Dt,Ot,Ut,Nt,Ht,A=null,Mn=null,ne=new Set;function rr(s){return/^[0-9a-fA-F]*$/.test(s)}function ir(s){let e=new Uint8Array(s.length/2);for(let t=0;t<e.length;t++)e[t]=parseInt(s.substr(t*2,2),16);return e}function Js(s){return Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join("")}function w(s,e="info"){let t=new Date().toLocaleTimeString("en-US",{hour12:!1}),n=document.createElement("div");n.className=`log-${e}`,n.textContent=`[${t}] ${s}`,Tt.appendChild(n),Tt.scrollTop=Tt.scrollHeight}function He(s){je.className=`connection-status ${s}`;let e=s==="connected";switch(s){case"disconnected":je.textContent="Disconnected",ke.disabled=!1,Je.disabled=!0,et.disabled=!0,tt.disabled=!0,nt.disabled=!0;break;case"connecting":je.textContent="Connecting...",ke.disabled=!0,Je.disabled=!0,et.disabled=!0,tt.disabled=!0,nt.disabled=!0;break;case"connected":je.textContent="Connected",ke.disabled=!0,Je.disabled=!1,et.disabled=!e,tt.disabled=!e,nt.disabled=!e;break}}var ar=21,cr=37,dr=38;function fr(s){let e=s[0]||0,t=s[1]||0,n=s[2]||0;return{multiAcks:e,advertLocPolicy:t,telemetryModeBase:n&3,telemetryModeLoc:n>>2&3,telemetryModeEnv:n>>4&3}}async function Dn(s,e){await s.sendToRadioFrame(e)}function vt(s,e,t=5e3){return new Promise(n=>{let o=setTimeout(()=>{s.off(e,r),n(null)},t),r=a=>{clearTimeout(o),s.off(e,r),n(a)};s.on(e,r)})}async function ur(){try{if(He("connecting"),w("Opening serial connection..."),A=await _n.open(),!A){w("Connection cancelled or failed","error"),He("disconnected");return}A.on("disconnected",()=>{w("Disconnected from radio","warn"),He("disconnected"),A=null}),await new Promise((s,e)=>{let t=setTimeout(()=>e(new Error("Connection timeout")),1e4);A.on("connected",()=>{clearTimeout(t),w("Connected to radio","success"),He("connected"),s()})})}catch(s){let e=s instanceof Error?s.message:String(s);if(w(`Connection error: ${e}`,"error"),He("disconnected"),A){try{A.close()}catch{}A=null}}}function lr(){A&&(A.close(),A=null),w("Disconnected"),He("disconnected")}async function hr(){if(!A){w("Not connected","error");return}w("Loading configuration from radio...","info");try{w("Requesting self info...");let s=vt(A,i.ResponseCodes.SelfInfo,5e3);await A.sendCommandAppStart();let e=await s;if(e){Pt.value=e.name||"",w(`Name: ${e.name||"(not set)"}`),It.value=String(e.type),w(`Node type: ${["None","Chat","Repeater","Room"][e.type]||e.type}`),eo.value=Js(e.publicKey),at.value=String(e.txPower),to.value=String(e.maxTxPower),w(`TX Power: ${e.txPower} dBm (max: ${e.maxTxPower})`),_t.checked=e.manualAddContacts===1,w(`Manual add contacts: ${e.manualAddContacts===1?"Yes":"No"}`);let u=fr(e.reserved);Mt.value=String(u.multiAcks),w(`Multi acks: ${u.multiAcks}`),Dt.value=String(u.advertLocPolicy),w(`Advert loc policy: ${["Never","Always","Contacts Only"][u.advertLocPolicy]||u.advertLocPolicy}`),Ot.value=String(u.telemetryModeBase),Ut.value=String(u.telemetryModeLoc),Nt.value=String(u.telemetryModeEnv);let h=["Off","Local","On Request","Always"];w(`Telemetry: base=${h[u.telemetryModeBase]}, loc=${h[u.telemetryModeLoc]}, env=${h[u.telemetryModeEnv]}`);let f=e.advLat/1e6,m=e.advLon/1e6;Lt.value=f!==0?f.toFixed(6):"",At.value=m!==0?m.toFixed(6):"",w(`Location: ${f.toFixed(6)}, ${m.toFixed(6)}`);let p=e.radioFreq/1e3,B=e.radioBw/1e3;st.value=p.toFixed(3),ot.value=B.toFixed(3),rt.value=String(e.radioSf),it.value=String(e.radioCr),w(`Radio: ${p} MHz, BW ${B} kHz, SF${e.radioSf}, CR${e.radioCr}`),w("Self info loaded","success")}else w("Failed to get self info (timeout)","error");w("Requesting device time...");let t=vt(A,i.ResponseCodes.CurrTime,5e3);await A.sendCommandGetDeviceTime();let n=await t;if(n){Re.value=String(n.epochSecs);let c=new Date(n.epochSecs*1e3);w(`Device time: ${n.epochSecs} (${c.toISOString()})`),Nn()}else w("Failed to get device time (timeout)","warn");w("Requesting private key...");let o=new Promise(c=>{let u=setTimeout(()=>{A.off(i.ResponseCodes.PrivateKey,l),A.off(i.ResponseCodes.Disabled,h),c(null)},5e3),l=f=>{clearTimeout(u),A.off(i.ResponseCodes.PrivateKey,l),A.off(i.ResponseCodes.Disabled,h),c({type:"key",data:f})},h=()=>{clearTimeout(u),A.off(i.ResponseCodes.PrivateKey,l),A.off(i.ResponseCodes.Disabled,h),c({type:"disabled"})};A.on(i.ResponseCodes.PrivateKey,l),A.on(i.ResponseCodes.Disabled,h)});await A.sendCommandExportPrivateKey();let r=await o;if(r?.type==="key"){let c=Js(r.data.privateKey);Le.value=c,w(`Private key: ${c.substring(0,16)}...`)}else r?.type==="disabled"?(Le.value="",Le.placeholder="Export disabled on device",w("Private key export is disabled on this device","warn")):w("Failed to get private key (timeout)","warn");w("Requesting device info...");let a=vt(A,i.ResponseCodes.DeviceInfo,5e3);await A.sendCommandDeviceQuery(1);let d=await a;d?(no.textContent=`v${d.firmwareVer} (${d.firmware_build_date})`,so.textContent=d.manufacturerModel||"-",w(`Device: ${d.manufacturerModel}, firmware v${d.firmwareVer}`)):w("Failed to get device info (timeout)","warn"),oo(),w("Configuration loaded successfully","success")}catch(s){let e=s instanceof Error?s.message:String(s);w(`Error loading configuration: ${e}`,"error")}}async function mr(){if(!A){w("Not connected","error");return}if(ne.size===0){w("No fields modified, nothing to write","info");return}w("Writing modified configuration to radio...","info");try{let s=async(e=3e3)=>await vt(A,i.ResponseCodes.Ok,e)!==null;if(ne.has("name")){let e=Pt.value.trim();e&&(w(`Setting name to: ${e}`),await A.sendCommandSetAdvertName(e),await s()?w("Name set","success"):w("Failed to set name (no response)","error"))}if(ne.has("nodeType")){let e=parseInt(It.value);w(`Setting node type to: ${["None","Chat","Repeater","Room"][e]}`),await A.sendCommandSendSelfAdvert(e),await s()?w("Node type set","success"):w("Failed to set node type (no response)","error")}if(ne.has("otherParams")){let e=_t.checked?1:0,t=parseInt(Mt.value)||0,n=parseInt(Dt.value)||0,o=parseInt(Ot.value)||0,r=parseInt(Ut.value)||0,a=parseInt(Nt.value)||0,d=o&3|(r&3)<<2|(a&3)<<4;w(`Setting other params: manual_add=${e}, multi_acks=${t}, advert_loc_policy=${n}, telemetry=${d}`);let c=new Uint8Array(5);c[0]=dr,c[1]=e,c[2]=d,c[3]=n,c[4]=t,await Dn(A,c),await s()?w("Other params set","success"):w("Failed to set other params (no response)","error")}if(ne.has("privateKey")){let e=Le.value.trim().toLowerCase();if(e)if(e.length!==128)w(`Private key must be 64 bytes (128 hex chars), got ${e.length}`,"error");else if(!rr(e))w("Private key contains invalid hex characters","error");else{w("Setting private key...");let t=ir(e);await A.sendCommandImportPrivateKey(t),await s()?w("Private key set","success"):w("Failed to set private key (no response or error)","error")}}if(ne.has("radio")){let e=parseFloat(st.value),t=parseFloat(ot.value),n=parseInt(rt.value),o=parseInt(it.value);!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&!isNaN(o)&&(w(`Setting radio params: ${e} MHz, BW ${t} kHz, SF${n}, CR${o}`),await A.sendCommandSetRadioParams(Math.round(e*1e3),Math.round(t*1e3),n,o),await s()?w("Radio params set","success"):w("Failed to set radio params (no response)","error"))}if(ne.has("txPower")){let e=parseInt(at.value);isNaN(e)||(w(`Setting TX power to: ${e} dBm`),await A.sendCommandSetTxPower(e),await s()?w("TX power set","success"):w("Failed to set TX power (no response)","error"))}if(ne.has("location")){let e=parseFloat(Lt.value),t=parseFloat(At.value);!isNaN(e)&&!isNaN(t)&&(w(`Setting location to: ${e.toFixed(6)}, ${t.toFixed(6)}`),await A.sendCommandSetAdvertLatLon(Math.round(e*1e6),Math.round(t*1e6)),await s()?w("Location set","success"):w("Failed to set location (no response)","error"))}if(ne.has("time")){let e=parseInt(Re.value);isNaN(e)||(w(`Setting device time to: ${e}`),await A.sendCommandSetDeviceTime(e),await s()?w("Device time set","success"):w("Failed to set device time (no response)","error"))}if(ne.has("tuning")){let e=parseInt(On.value),t=parseInt(Un.value);if(!isNaN(e)&&!isNaN(t)){w(`Setting tuning: RX delay ${e}ms, advert interval ${t}s`);let n=new Uint8Array(11);n[0]=ar,n[1]=e&255,n[2]=e>>8&255,n[3]=e>>16&255,n[4]=e>>24&255,n[5]=t&255,n[6]=t>>8&255,n[7]=t>>16&255,n[8]=t>>24&255,await Dn(A,n),await s()?w("Tuning params set","success"):w("Failed to set tuning params (no response)","error")}}if(ne.has("blePin")){let e=parseInt(Ht.value);if(!isNaN(e)&&e>=0&&e<=999999){w(`Setting BLE PIN to: ${e}`);let t=new Uint8Array(5);t[0]=cr,t[1]=e&255,t[2]=e>>8&255,t[3]=e>>16&255,t[4]=e>>24&255,await Dn(A,t),await s()?w("BLE PIN set","success"):w("Failed to set BLE PIN (no response)","error")}else Ht.value.trim()!==""&&w("Invalid BLE PIN (must be 0-999999)","warn")}oo(),w("Configuration written successfully","success")}catch(s){let e=s instanceof Error?s.message:String(s);w(`Error writing configuration: ${e}`,"error")}}async function pr(){if(!A){w("Not connected","error");return}w("Rebooting radio...","warn");try{await A.sendCommandReboot(),w("Reboot command sent. Radio will disconnect.","success")}catch(s){let e=s instanceof Error?s.message:String(s);w(`Error sending reboot command: ${e}`,"error")}}function Nn(){Mn!==null&&clearInterval(Mn),Mn=window.setInterval(()=>{let s=parseInt(Re.value);isNaN(s)||(Re.value=String(s+1))},1e3)}function oo(){ne.clear()}function F(s){ne.add(s)}function yr(){let s=Math.floor(Date.now()/1e3);Re.value=String(s),w(`Set time to current: ${s} (${new Date().toISOString()})`),F("time"),Nn()}function wr(){st.value="910.525",ot.value="62.5",rt.value="7",it.value="5",at.value="22",F("radio"),F("txPower"),w("Applied USA preset: 910.525 MHz, BW 62.5 kHz, SF7, CR5, 22 dBm")}function gr(s){let e=s.target,t=e.value.replace(/[^0-9a-fA-F]/g,"").toLowerCase();t!==e.value&&(e.value=t)}document.addEventListener("DOMContentLoaded",()=>{ke=document.getElementById("connect-btn"),Je=document.getElementById("disconnect-btn"),je=document.getElementById("connection-status"),et=document.getElementById("load-btn"),tt=document.getElementById("write-btn"),nt=document.getElementById("reboot-btn"),Tt=document.getElementById("status-log"),Pt=document.getElementById("radio-name"),It=document.getElementById("node-type"),Le=document.getElementById("private-key"),eo=document.getElementById("public-key"),Lt=document.getElementById("latitude"),At=document.getElementById("longitude"),st=document.getElementById("frequency"),ot=document.getElementById("bandwidth"),rt=document.getElementById("spreading-factor"),it=document.getElementById("coding-rate"),at=document.getElementById("tx-power"),to=document.getElementById("max-tx-power"),Re=document.getElementById("device-time"),Qs=document.getElementById("sync-time-btn"),js=document.getElementById("usa-preset-btn"),_t=document.getElementById("manual-add-contacts"),no=document.getElementById("firmware-info"),so=document.getElementById("model-info"),On=document.getElementById("rx-delay"),Un=document.getElementById("advert-interval"),Mt=document.getElementById("multi-acks"),Dt=document.getElementById("advert-loc-policy"),Ot=document.getElementById("telemetry-base"),Ut=document.getElementById("telemetry-loc"),Nt=document.getElementById("telemetry-env"),Ht=document.getElementById("ble-pin");let s=document.getElementById("serial-not-supported");if(!navigator.serial){s.style.display="block",ke.disabled=!0,w("Web Serial API not supported in this browser","error");return}ke.addEventListener("click",ur),Je.addEventListener("click",lr),et.addEventListener("click",hr),tt.addEventListener("click",mr),nt.addEventListener("click",pr),Qs.addEventListener("click",yr),Le.addEventListener("input",gr),js.addEventListener("click",wr),Pt.addEventListener("input",()=>F("name")),It.addEventListener("change",()=>F("nodeType")),Le.addEventListener("input",()=>F("privateKey")),Lt.addEventListener("input",()=>F("location")),At.addEventListener("input",()=>F("location")),st.addEventListener("input",()=>F("radio")),ot.addEventListener("input",()=>F("radio")),rt.addEventListener("input",()=>F("radio")),it.addEventListener("input",()=>F("radio")),at.addEventListener("input",()=>F("txPower")),_t.addEventListener("change",()=>F("otherParams")),Re.addEventListener("input",()=>F("time")),On.addEventListener("input",()=>F("tuning")),Un.addEventListener("input",()=>F("tuning")),Mt.addEventListener("input",()=>F("otherParams")),Dt.addEventListener("change",()=>F("otherParams")),Ot.addEventListener("change",()=>F("otherParams")),Ut.addEventListener("change",()=>F("otherParams")),Nt.addEventListener("change",()=>F("otherParams")),Ht.addEventListener("input",()=>F("blePin"));let e=Math.floor(Date.now()/1e3);Re.value=String(e),Nn(),w("Ready. Connect to a radio to begin.")});})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=radio-config-bundle.js.map
